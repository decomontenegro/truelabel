import{r as e,j as a,aU as t,K as l,J as s,aV as r,aq as i,o as d,f as c,n,au as o,a3 as m,aW as h,z as x,ay as u}from"./react-core-XCdXHkeW.js";import{v as p,r as N}from"./validationService-Ds-ci427.js";import{p as b}from"./productService-CHIPryK1.js";import{V as g}from"./ValidationQueue-CEF2hYqY.js";import{b as v}from"./react-router-G9IXNjIc.js";import"./vendor-BcMaAnXF.js";import"./state-QrSTFgAv.js";import"./react-dom-BslC4xag.js";import"./index-D7IercYq.js";import"./utils-BtzqxagS.js";import"./forms-Bk6aQ3xQ.js";import"./fallbackService-QR578FZI.js";import"./qrService-BwD7nkbO.js";const y=()=>{const[N,b]=e.useState([]),[y,w]=e.useState(!0),[A,R]=e.useState("all"),[E,P]=e.useState(!1),[T,D]=e.useState("list"),[I,O]=e.useState([]),[C,k]=e.useState(null),S=v(),j=async()=>{try{w(!0);const e={limit:100};"all"!==A&&(e.status=A);const a=await p.getValidations(e);b(a.data)}catch(e){u.error("Erro ao carregar valida\xe7\xf5es")}finally{w(!1)}},V=async()=>{try{const e=await p.getValidationQueue();O(e.data||[])}catch(e){}};e.useEffect((()=>{j(),V(),(async()=>{try{const e=await p.getValidationMetrics();k(e.data)}catch(e){}})()}),[A]),e.useEffect((()=>{const e=setInterval((()=>{"queue"===T&&V()}),3e4);return()=>clearInterval(e)}),[T]);const L=e=>{switch(e){case"APPROVED":return a.jsx(n,{className:"w-5 h-5 text-green-500"});case"REJECTED":return a.jsx(o,{className:"w-5 h-5 text-red-500"});case"PARTIAL":return a.jsx(m,{className:"w-5 h-5 text-orange-500"});case"IN_PROGRESS":return a.jsx(c,{className:"w-5 h-5 text-blue-500 animate-spin"});default:return a.jsx(d,{className:"w-5 h-5 text-yellow-500"})}},M=e=>{switch(e){case"APPROVED":return"bg-green-100 text-green-800";case"REJECTED":return"bg-red-100 text-red-800";case"PARTIAL":return"bg-orange-100 text-orange-800";case"IN_PROGRESS":return"bg-blue-100 text-blue-800";default:return"bg-yellow-100 text-yellow-800"}};return y?a.jsx("div",{className:"flex items-center justify-center min-h-screen",children:a.jsx("div",{className:"loading-spinner w-8 h-8"})}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Valida\xe7\xf5es"}),a.jsx("p",{className:"text-gray-600",children:"Gerencie valida\xe7\xf5es de produtos"})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("button",{onClick:()=>S("/admin/validations/queue"),className:"btn btn-secondary",children:[a.jsx(t,{className:"w-4 h-4 mr-2"}),"Fila"]}),a.jsxs("button",{onClick:()=>P(!0),className:"btn btn-primary",children:[a.jsx(l,{className:"w-4 h-4 mr-2"}),"Nova Valida\xe7\xe3o"]})]})]}),a.jsx("div",{className:"border-b border-gray-200",children:a.jsxs("nav",{className:"-mb-px flex space-x-8",children:[a.jsxs("button",{onClick:()=>D("list"),className:"py-2 px-1 border-b-2 font-medium text-sm "+("list"===T?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[a.jsx(s,{className:"w-4 h-4 inline-block mr-2"}),"Lista de Valida\xe7\xf5es"]}),a.jsxs("button",{onClick:()=>D("queue"),className:"py-2 px-1 border-b-2 font-medium text-sm "+("queue"===T?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[a.jsx(t,{className:"w-4 h-4 inline-block mr-2"}),"Fila de Processamento",I.filter((e=>"QUEUED"===e.status||"PROCESSING"===e.status)).length>0&&a.jsx("span",{className:"ml-2 inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:I.filter((e=>"QUEUED"===e.status||"PROCESSING"===e.status)).length})]}),a.jsxs("button",{onClick:()=>D("metrics"),className:"py-2 px-1 border-b-2 font-medium text-sm "+("metrics"===T?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[a.jsx(r,{className:"w-4 h-4 inline-block mr-2"}),"M\xe9tricas e An\xe1lises"]})]})}),"list"===T&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border",children:a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx(i,{className:"w-4 h-4 text-gray-400"}),a.jsxs("select",{value:A,onChange:e=>R(e.target.value),className:"input w-48",children:[a.jsx("option",{value:"all",children:"Todos os status"}),a.jsx("option",{value:"PENDING",children:"Pendentes"}),a.jsx("option",{value:"IN_PROGRESS",children:"Em Processamento"}),a.jsx("option",{value:"APPROVED",children:"Aprovados"}),a.jsx("option",{value:"REJECTED",children:"Rejeitados"}),a.jsx("option",{value:"PARTIAL",children:"Parciais"})]})]})}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-6",children:[a.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(d,{className:"w-8 h-8 text-yellow-600 mr-3"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Pendentes"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:N.filter((e=>"PENDING"===e.status)).length})]})]})}),a.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(c,{className:"w-8 h-8 text-blue-600 mr-3"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Processando"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:N.filter((e=>"IN_PROGRESS"===e.status)).length})]})]})}),a.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(n,{className:"w-8 h-8 text-green-600 mr-3"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Aprovados"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:N.filter((e=>"APPROVED"===e.status)).length})]})]})}),a.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(o,{className:"w-8 h-8 text-red-600 mr-3"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Rejeitados"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:N.filter((e=>"REJECTED"===e.status)).length})]})]})}),a.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(m,{className:"w-8 h-8 text-orange-600 mr-3"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Parciais"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:N.filter((e=>"PARTIAL"===e.status)).length})]})]})})]}),a.jsx("div",{className:"bg-white rounded-lg shadow-sm border overflow-hidden",children:a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Produto"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tipo"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Confian\xe7a"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Validador"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"A\xe7\xf5es"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:N.map((e=>{var t,l,s,r,i;return a.jsxs("tr",{className:"hover:bg-gray-50",children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium text-gray-900",children:null==(t=e.product)?void 0:t.name}),a.jsxs("div",{className:"text-sm text-gray-500",children:[null==(l=e.product)?void 0:l.brand," \u2022 ",null==(s=e.product)?void 0:s.sku]})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"flex items-center",children:["AUTOMATED"===e.type&&a.jsx(h,{className:"w-4 h-4 text-blue-600 mr-2"}),a.jsxs("span",{className:"text-sm text-gray-900",children:["AUTOMATED"===e.type&&"Automatizada","MANUAL"===e.type&&"Manual","LABORATORY"===e.type&&"Laboratorial","HYBRID"===e.type&&"H\xedbrida"]})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"flex items-center",children:[L(e.status),a.jsxs("span",{className:`ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${M(e.status)}`,children:["APPROVED"===e.status&&"Aprovado","REJECTED"===e.status&&"Rejeitado","PARTIAL"===e.status&&"Parcial","PENDING"===e.status&&"Pendente","IN_PROGRESS"===e.status&&"Processando"]})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:void 0!==e.confidence&&a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2 mr-2",children:a.jsx("div",{className:"h-2 rounded-full "+(e.confidence>=80?"bg-green-600":e.confidence>=60?"bg-yellow-600":"bg-red-600"),style:{width:`${e.confidence}%`}})}),a.jsxs("span",{className:"text-sm text-gray-600",children:[e.confidence,"%"]})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(null==(r=e.user)?void 0:r.name)||"Sistema"}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(i=e.createdAt,new Date(i).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}))}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:a.jsx("button",{onClick:()=>S(`/admin/validations/${e.id}/review`),className:"text-blue-600 hover:text-blue-900",title:"Ver detalhes",children:a.jsx(x,{className:"w-4 h-4"})})})]},e.id)}))})]})})}),0===N.length&&!y&&a.jsxs("div",{className:"text-center py-12",children:[a.jsx(n,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nenhuma valida\xe7\xe3o encontrada"}),a.jsx("p",{className:"text-gray-600 mb-4",children:"all"!==A?"Tente ajustar os filtros de busca":"Comece criando a primeira valida\xe7\xe3o"}),"all"===A&&a.jsxs("button",{onClick:()=>P(!0),className:"btn btn-primary",children:[a.jsx(l,{className:"w-4 h-4 mr-2"}),"Nova Valida\xe7\xe3o"]})]})]}),"queue"===T&&a.jsx(g,{queue:I,onRefresh:V}),"metrics"===T&&C&&a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"M\xe9tricas de Automa\xe7\xe3o"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Taxa de Automa\xe7\xe3o"}),a.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[C.automatedPercentage.toFixed(1),"%"]})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Tempo M\xe9dio de Processamento"}),a.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[(C.averageProcessingTime/1e3).toFixed(1),"s"]})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Taxa de Precis\xe3o"}),a.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[C.accuracyRate.toFixed(1),"%"]})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Taxa de Revalida\xe7\xe3o"}),a.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[C.revalidationRate.toFixed(1),"%"]})]})]})]}),a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Distribui\xe7\xe3o por Tipo"}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Object.entries(C.byType).map((([e,t])=>a.jsxs("div",{className:"text-center",children:[a.jsxs("p",{className:"text-sm text-gray-600",children:["AUTOMATED"===e&&"Automatizada","MANUAL"===e&&"Manual","LABORATORY"===e&&"Laboratorial","HYBRID"===e&&"H\xedbrida"]}),a.jsx("p",{className:"text-xl font-bold text-gray-900",children:t})]},e)))})]}),a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Tend\xeancia dos \xdaltimos 30 Dias"}),a.jsx("div",{className:"space-y-2",children:C.trendsLast30Days.map(((e,t)=>a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:e.date}),a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("span",{className:"text-sm",children:[a.jsx(h,{className:"w-4 h-4 inline text-blue-600 mr-1"}),e.automated]}),a.jsxs("span",{className:"text-sm",children:[a.jsx(s,{className:"w-4 h-4 inline text-gray-600 mr-1"}),e.manual]}),a.jsxs("span",{className:"text-sm font-medium",children:["Total: ",e.total]})]})]},t)))})]})]}),E&&a.jsx(f,{onClose:()=>P(!1),onSuccess:()=>{P(!1),j()}})]})},f=({onClose:t,onSuccess:l})=>{const[s,r]=e.useState({productId:"",reportId:"",type:"MANUAL",status:"APPROVED",claimsValidated:{},summary:"",notes:"",useAutomation:!1}),[i,d]=e.useState([]),[c,n]=e.useState([]),[o,m]=e.useState(!1);return e.useEffect((()=>{(async()=>{try{const[e,a]=await Promise.all([b.getProducts({limit:100}),N.getReports({limit:100})]);d(e.data),n(a.data)}catch(e){}})()}),[]),a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[a.jsx("h2",{className:"text-xl font-bold mb-4",children:"Nova Valida\xe7\xe3o"}),a.jsxs("form",{onSubmit:async e=>{var a,t,r,i;e.preventDefault(),m(!0);try{const e={...s,claimsValidated:s.claimsValidated||{}};await p.createValidation(e),u.success("Valida\xe7\xe3o criada com sucesso!"),l()}catch(d){const e=(null==(t=null==(a=d.response)?void 0:a.data)?void 0:t.error)||(null==(i=null==(r=d.response)?void 0:r.data)?void 0:i.message)||"Erro ao criar valida\xe7\xe3o";u.error(e)}finally{m(!1)}},className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Produto *"}),a.jsxs("select",{value:s.productId,onChange:e=>r((a=>({...a,productId:e.target.value}))),className:"input w-full",required:!0,children:[a.jsx("option",{value:"",children:"Selecione um produto"}),i.map((e=>a.jsxs("option",{value:e.id,children:[e.name," - ",e.brand]},e.id)))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Valida\xe7\xe3o *"}),a.jsxs("select",{value:s.type,onChange:e=>r((a=>({...a,type:e.target.value,reportId:"MANUAL"===e.target.value?"":a.reportId}))),className:"input w-full",required:!0,children:[a.jsx("option",{value:"MANUAL",children:"Manual (sem relat\xf3rio)"}),a.jsx("option",{value:"LABORATORY",children:"Laboratorial (com relat\xf3rio)"}),a.jsx("option",{value:"AUTOMATED",children:"Automatizada (IA)"}),a.jsx("option",{value:"HYBRID",children:"H\xedbrida (IA + Revis\xe3o)"})]})]}),("AUTOMATED"===s.type||"HYBRID"===s.type)&&a.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start",children:[a.jsx(h,{className:"w-5 h-5 text-blue-600 mr-2 mt-0.5"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm font-medium text-blue-900",children:"Valida\xe7\xe3o Automatizada"}),a.jsxs("p",{className:"text-sm text-blue-700 mt-1",children:["O sistema ir\xe1 analisar automaticamente o relat\xf3rio usando IA para extrair e validar os dados.","HYBRID"===s.type&&" Os resultados ser\xe3o revisados antes da aprova\xe7\xe3o final."]})]})]})}),("LABORATORY"===s.type||"AUTOMATED"===s.type||"HYBRID"===s.type)&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Relat\xf3rio *"}),a.jsxs("select",{value:s.reportId,onChange:e=>r((a=>({...a,reportId:e.target.value}))),className:"input w-full",required:"MANUAL"!==s.type,children:[a.jsx("option",{value:"",children:"Selecione um relat\xf3rio"}),c.map((e=>{var t;return a.jsxs("option",{value:e.id,children:[e.originalName," - ",null==(t=e.laboratory)?void 0:t.name]},e.id)}))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status *"}),a.jsxs("select",{value:s.status,onChange:e=>r((a=>({...a,status:e.target.value}))),className:"input w-full",required:!0,children:[a.jsx("option",{value:"PENDING",children:"Pendente"}),a.jsx("option",{value:"APPROVED",children:"Aprovado"}),a.jsx("option",{value:"REJECTED",children:"Rejeitado"}),a.jsx("option",{value:"PARTIAL",children:"Parcial"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Resumo"}),a.jsx("textarea",{value:s.summary,onChange:e=>r((a=>({...a,summary:e.target.value}))),className:"input w-full",rows:3,placeholder:"Resumo da valida\xe7\xe3o..."})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Observa\xe7\xf5es"}),a.jsx("textarea",{value:s.notes,onChange:e=>r((a=>({...a,notes:e.target.value}))),className:"input w-full",rows:3,placeholder:"Observa\xe7\xf5es adicionais..."})]}),a.jsxs("div",{className:"flex space-x-3 pt-4",children:[a.jsx("button",{type:"button",onClick:t,className:"btn btn-secondary flex-1",disabled:o,children:"Cancelar"}),a.jsx("button",{type:"submit",className:"btn btn-primary flex-1",disabled:o,children:o?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"loading-spinner w-4 h-4 mr-2"}),"Criando..."]}):"Criar Valida\xe7\xe3o"})]})]})]})})};export{y as ValidationsPage,y as default};
