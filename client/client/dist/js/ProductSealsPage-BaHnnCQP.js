import{r as e,V as a,j as r,n as s,a3 as t,K as l,a9 as i,X as c,ae as d,F as n,at as o,aw as m,w as u,ax as h,l as x,o as p,ay as g,P as b,e as N}from"./react-core-XCdXHkeW.js";import{p as y}from"./productService-CHIPryK1.js";import{s as f,S as v}from"./sealService-DAr2tClY.js";import{L as w}from"./index-D7IercYq.js";import{d as S,b as C}from"./react-router-G9IXNjIc.js";import"./vendor-BcMaAnXF.js";import"./state-QrSTFgAv.js";import"./react-dom-BslC4xag.js";import"./utils-BtzqxagS.js";import"./forms-Bk6aQ3xQ.js";const j=({product:m,onUpdate:u})=>{const[h,x]=e.useState([]),[g,b]=e.useState([]),[N,y]=e.useState(!0),[v,S]=e.useState(!1),[C,j]=e.useState(null),[k,D]=e.useState(null);e.useEffect((()=>{L()}),[m.id]);const L=async()=>{try{y(!0);const a=await f.getSeals({isActive:!0}),r=(null==a?void 0:a.seals)||[];b(r);try{const e=await f.getProductSeals({productId:m.id}),a=(null==e?void 0:e.productSeals)||[];x(a);const s=a.map((e=>e.sealId)),t=r.filter((e=>e.isRequired&&!s.includes(e.id))),l=a.filter((e=>e.expiryDate&&f.isSealExpired(e.expiryDate))),i=a.filter((e=>!("VERIFIED"!==e.status||e.expiryDate&&f.isSealExpired(e.expiryDate)))),c=0===t.length&&0===l.length;D({isCompliant:c,missingRequiredSeals:t,expiredSeals:l,validSeals:i,warnings:c?[]:["Produto n\xe3o est\xe1 em conformidade com todos os requisitos"]})}catch(e){x([]),D({isCompliant:!1,missingRequiredSeals:r.filter((e=>e.isRequired)),expiredSeals:[],validSeals:[],warnings:["Erro ao carregar selos do produto. Usando dados locais."]})}}catch(e){a.error("Erro ao carregar selos")}finally{y(!1)}};return N?r.jsx("div",{className:"flex justify-center items-center h-32",children:r.jsx(w,{size:"lg"})}):r.jsxs("div",{className:"space-y-6",children:[k&&r.jsxs("div",{className:"p-4 rounded-lg border "+(k.isCompliant?"bg-green-50 border-green-200":"bg-red-50 border-red-200"),children:[r.jsxs("div",{className:"flex items-center mb-2",children:[k.isCompliant?r.jsx(s,{className:"w-5 h-5 text-green-600 mr-2"}):r.jsx(t,{className:"w-5 h-5 text-red-600 mr-2"}),r.jsx("h3",{className:"font-semibold "+(k.isCompliant?"text-green-800":"text-red-800"),children:k.isCompliant?"Produto em Conformidade":"Produto N\xe3o Conforme"})]}),k.missingRequiredSeals.length>0&&r.jsxs("div",{className:"mb-2",children:[r.jsx("p",{className:"text-sm text-red-700 font-medium",children:"Selos obrigat\xf3rios faltantes:"}),r.jsx("ul",{className:"text-sm text-red-600 ml-4",children:k.missingRequiredSeals.map((e=>r.jsxs("li",{children:["\u2022 ",e.name]},e.id)))})]}),k.expiredSeals.length>0&&r.jsxs("div",{className:"mb-2",children:[r.jsx("p",{className:"text-sm text-red-700 font-medium",children:"Selos expirados:"}),r.jsx("ul",{className:"text-sm text-red-600 ml-4",children:k.expiredSeals.map((e=>r.jsxs("li",{children:["\u2022 ",e.seal.name]},e.id)))})]}),k.warnings.length>0&&r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-yellow-700 font-medium",children:"Avisos:"}),r.jsx("ul",{className:"text-sm text-yellow-600 ml-4",children:k.warnings.map(((e,a)=>r.jsxs("li",{children:["\u2022 ",e]},a)))})]})]}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Selos do Produto (",h.length,")"]}),r.jsxs("button",{onClick:()=>S(!0),className:"btn btn-primary flex items-center",children:[r.jsx(l,{className:"w-4 h-4 mr-2"}),"Adicionar Selo"]})]}),0===h.length?r.jsxs("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:[r.jsx(i,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),r.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nenhum selo adicionado"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"Adicione selos para validar as claims do produto"}),r.jsx("button",{onClick:()=>S(!0),className:"btn btn-primary",children:"Adicionar Primeiro Selo"})]}):r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:h.map((e=>{const l=E(e.seal.category),i=(e=>{switch(e){case"VERIFIED":return s;case"PENDING":default:return p;case"EXPIRED":return t;case"INVALID":return c}})(e.status),m=I(e.seal.category),h=f.getSealStatusColor(e.status);return r.jsxs("div",{className:"bg-white border rounded-lg p-4",children:[r.jsxs("div",{className:"flex items-start justify-between mb-3",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:`p-2 rounded-lg bg-${m}-100 mr-3`,children:r.jsx(l,{className:`w-5 h-5 text-${m}-600`})}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-semibold text-gray-900",children:e.seal.name}),r.jsx("p",{className:"text-sm text-gray-600",children:e.seal.purpose})]})]}),r.jsx("button",{onClick:()=>(async e=>{var r;if(confirm("Tem certeza que deseja remover este selo?"))try{await f.removeProductSeal(e),await L(),a.success("Selo removido com sucesso!"),null==u||u()}catch(s){404===(null==(r=s.response)?void 0:r.status)?a.error("Selo n\xe3o encontrado"):a.error("Erro ao remover selo. Tente novamente.")}})(e.id),className:"text-gray-400 hover:text-red-600 transition-colors",children:r.jsx(c,{className:"w-4 h-4"})})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-sm text-gray-600",children:"Status:"}),r.jsxs("div",{className:"flex items-center",children:[r.jsx(i,{className:`w-4 h-4 text-${h}-600 mr-1`}),r.jsx("span",{className:`text-sm font-medium text-${h}-600`,children:f.getSealStatusLabel(e.status)})]})]}),e.certificateNumber&&r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-sm text-gray-600",children:"Certificado:"}),r.jsx("span",{className:"text-sm font-mono text-gray-900",children:e.certificateNumber})]}),e.expiryDate&&r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-sm text-gray-600",children:"Expira em:"}),r.jsxs("div",{className:"flex items-center",children:[r.jsx(d,{className:"w-4 h-4 text-gray-400 mr-1"}),r.jsx("span",{className:"text-sm "+(f.isSealExpired(e.expiryDate)?"text-red-600 font-medium":"text-gray-900"),children:f.formatExpiryDate(e.expiryDate)})]})]}),e.validatingLaboratory&&r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-sm text-gray-600",children:"Laborat\xf3rio:"}),r.jsx("span",{className:"text-sm text-gray-900",children:e.validatingLaboratory})]}),e.documentUrl&&r.jsx("div",{className:"pt-2",children:r.jsxs("a",{href:e.documentUrl,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center text-sm text-primary-600 hover:text-primary-700",children:[r.jsx(n,{className:"w-4 h-4 mr-1"}),"Ver Documento",r.jsx(o,{className:"w-3 h-3 ml-1"})]})})]})]},e.id)}))})]}),v&&r.jsx(A,{availableSeals:g,productSeals:h,onClose:()=>{S(!1),j(null)},onSelectSeal:j,onAddSeal:async e=>{var r,s;try{if(!C)return void a.error("Nenhum selo selecionado");const r={productId:m.id,sealId:C.id,certificateNumber:e.certificateNumber||void 0,issuedDate:e.issuedDate||void 0,expiryDate:e.expiryDate||void 0,validatingLaboratory:e.validatingLaboratory||void 0,documentUrl:e.documentUrl||void 0,notes:e.notes||void 0};await f.addProductSeal(r),await L(),S(!1),j(null),a.success("Selo adicionado com sucesso!"),null==u||u()}catch(t){400===(null==(r=t.response)?void 0:r.status)?a.error(t.response.data.error||"Dados inv\xe1lidos"):404===(null==(s=t.response)?void 0:s.status)?a.error("Produto ou selo n\xe3o encontrado"):a.error("Erro ao adicionar selo. Tente novamente.")}},selectedSeal:C})]})},A=({availableSeals:a,productSeals:s,onClose:t,onSelectSeal:l,onAddSeal:i,selectedSeal:d})=>{const[n,o]=e.useState({certificateNumber:"",issuedDate:"",expiryDate:"",validatingLaboratory:"",documentUrl:"",notes:""}),m=s.map((e=>e.sealId)),u=a.filter((e=>!m.includes(e.id)));return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:r.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Adicionar Selo"}),r.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600",children:r.jsx(c,{className:"w-5 h-5"})})]}),d?r.jsxs("form",{onSubmit:e=>{e.preventDefault(),d&&i(n)},className:"space-y-4",children:[r.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[r.jsx("h4",{className:"font-medium text-gray-900",children:d.name}),r.jsx("p",{className:"text-sm text-gray-600",children:d.description})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"N\xfamero do Certificado"}),r.jsx("input",{type:"text",value:n.certificateNumber,onChange:e=>o({...n,certificateNumber:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Ex: ABC123456"})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data de Emiss\xe3o"}),r.jsx("input",{type:"date",value:n.issuedDate,onChange:e=>o({...n,issuedDate:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data de Expira\xe7\xe3o"}),r.jsx("input",{type:"date",value:n.expiryDate,onChange:e=>o({...n,expiryDate:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Laborat\xf3rio Validador"}),r.jsx("input",{type:"text",value:n.validatingLaboratory,onChange:e=>o({...n,validatingLaboratory:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Nome do laborat\xf3rio"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"URL do Documento"}),r.jsx("input",{type:"url",value:n.documentUrl,onChange:e=>o({...n,documentUrl:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"https://..."})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Observa\xe7\xf5es"}),r.jsx("textarea",{value:n.notes,onChange:e=>o({...n,notes:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Observa\xe7\xf5es adicionais..."})]}),r.jsxs("div",{className:"flex space-x-3 pt-4",children:[r.jsx("button",{type:"submit",className:"flex-1 btn btn-primary",children:"Adicionar Selo"}),r.jsx("button",{type:"button",onClick:()=>l(null),className:"btn btn-outline",children:"Voltar"})]})]}):r.jsxs("div",{className:"space-y-3",children:[r.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Selecione um selo para adicionar ao produto:"}),0===u.length?r.jsxs("div",{className:"text-center py-8",children:[r.jsx("p",{className:"text-gray-500",children:"Nenhum selo dispon\xedvel para adicionar"}),r.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:["Total de selos: ",a.length," | Filtrados: ",u.length]})]}):null,u.map((e=>{const a=E(e.category),s=I(e.category);return r.jsx("button",{onClick:()=>l(e),className:"w-full text-left p-3 border rounded-lg hover:bg-gray-50 transition-colors",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:`p-2 rounded-lg bg-${s}-100 mr-3`,children:r.jsx(a,{className:`w-4 h-4 text-${s}-600`})}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-900",children:e.name}),r.jsx("p",{className:"text-sm text-gray-600",children:e.purpose}),e.isRequired&&r.jsx("span",{className:"inline-block px-2 py-1 text-xs bg-red-100 text-red-800 rounded mt-1",children:"Obrigat\xf3rio"})]})]})},e.id)}))]})]})})},E=e=>{switch(e){case"REGULATORY":default:return i;case"QUALITY":return x;case"ORGANIC":return h;case"ETHICAL":return u;case"ENVIRONMENTAL":return m}},I=e=>{const a=v.find((a=>a.id===e));return(null==a?void 0:a.color)||"gray"},k=()=>{const{productId:a}=S(),s=C(),[t,l]=e.useState(null),[c,d]=e.useState(!0);e.useEffect((()=>{a&&n()}),[a]);const n=async()=>{if(a)try{d(!0);const e=await y.getProduct(a);l(e.product)}catch(e){g.error("Erro ao carregar produto"),s("/dashboard/products")}finally{d(!1)}};return c?r.jsx("div",{className:"flex justify-center items-center h-64",children:r.jsx(w,{size:"lg"})}):t?r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsx("button",{onClick:()=>s("/dashboard/products"),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:r.jsx(N,{className:"w-5 h-5"})}),r.jsx("div",{className:"flex-1",children:r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx(i,{className:"w-8 h-8 text-blue-600"}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Selos e Certifica\xe7\xf5es"}),r.jsxs("p",{className:"text-gray-600",children:[t.name," - ",t.brand]})]})]})})]}),r.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:r.jsxs("div",{className:"flex items-start space-x-4",children:[t.imageUrl&&r.jsx("img",{src:t.imageUrl,alt:t.name,className:"w-20 h-20 rounded-lg object-cover"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:t.name}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[r.jsxs("div",{children:[r.jsx("span",{className:"text-gray-600",children:"Marca:"}),r.jsx("span",{className:"ml-2 font-medium text-gray-900",children:t.brand})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-gray-600",children:"Categoria:"}),r.jsx("span",{className:"ml-2 font-medium text-gray-900",children:t.category})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-gray-600",children:"SKU:"}),r.jsx("span",{className:"ml-2 font-mono text-gray-900",children:t.sku})]})]}),t.description&&r.jsx("p",{className:"mt-3 text-gray-600",children:t.description}),(()=>{const e=(a=t.claims)?Array.isArray(a)?a:"string"==typeof a?a.split(",").map((e=>e.trim())).filter((e=>e.length>0)):[]:[];var a;return e.length>0&&r.jsxs("div",{className:"mt-3",children:[r.jsx("span",{className:"text-gray-600",children:"Claims:"}),r.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:e.map(((e,a)=>r.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:e},a)))})]})})()]})]})}),r.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:r.jsx(j,{product:t,onUpdate:n})}),r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(i,{className:"w-6 h-6 text-blue-600 mr-3 mt-0.5"}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-2",children:"Sobre Selos e Certifica\xe7\xf5es"}),r.jsxs("div",{className:"text-blue-800 space-y-2",children:[r.jsxs("p",{children:[r.jsx("strong",{children:"Selos Obrigat\xf3rios:"})," S\xe3o exigidos por lei para comercializa\xe7\xe3o do produto (ex: ANVISA, SIF)."]}),r.jsxs("p",{children:[r.jsx("strong",{children:"Selos de Qualidade:"})," Certificam processos e padr\xf5es de qualidade (ex: ISO 22000, HACCP)."]}),r.jsxs("p",{children:[r.jsx("strong",{children:"Selos Org\xe2nicos:"})," Validam produ\xe7\xe3o org\xe2nica e natural (ex: Org\xe2nico Brasil, IBD)."]}),r.jsxs("p",{children:[r.jsx("strong",{children:"Selos \xc9ticos:"})," Garantem pr\xe1ticas \xe9ticas e respons\xe1veis (ex: Vegano, Fair Trade)."]}),r.jsxs("p",{children:[r.jsx("strong",{children:"Selos Ambientais:"})," Certificam sustentabilidade e responsabilidade ambiental (ex: Eureciclo, Carbono Neutro)."]})]})]})]})})]}):r.jsxs("div",{className:"text-center py-12",children:[r.jsx(b,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Produto n\xe3o encontrado"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"O produto solicitado n\xe3o foi encontrado."}),r.jsx("button",{onClick:()=>s("/dashboard/products"),className:"btn btn-primary",children:"Voltar para Produtos"})]})};export{k as default};
