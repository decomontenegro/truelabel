import{r as e,j as a,Y as t,bg as r,bh as s,P as l,b7 as i,bi as c,bj as n,b9 as d,bk as m,ae as o,o as h,bl as g,C as p,au as u,n as x,F as y,aP as N,a9 as b,bm as f,bn as v,ax as w,aM as C,aN as S,l as E,aR as I,b0 as T,bo as A,b8 as R,b1 as k,b2 as D,at as M,bp as $,K as O,af as j,k as P,J as L,an as B,ay as F}from"./react-core-XCdXHkeW.js";import{L as G,b as U,D as V}from"./index-D7IercYq.js";import{f as H,c as K}from"./utils-BtzqxagS.js";import{p as _}from"./productService-CHIPryK1.js";import{u as Y}from"./useAsyncAction-DPqA4CQG.js";import{d as X,b as q}from"./react-router-G9IXNjIc.js";import"./vendor-BcMaAnXF.js";import"./state-QrSTFgAv.js";import"./react-dom-BslC4xag.js";import"./forms-Bk6aQ3xQ.js";const z=({route:m,height:o="500px",showDetails:h=!0})=>{const g=e.useRef(null),[p,u]=e.useState(null),[x,y]=e.useState(!0),N={SHIP:s,TRUCK:d,RAIL:n,AIR:c,MIXED:l},b={ORIGIN:t,PROCESSING:i,WAREHOUSE:l,PORT:s,DESTINATION:r};e.useEffect((()=>{const e=setTimeout((()=>{y(!1)}),1e3);return()=>clearTimeout(e)}),[]);const f=e=>{const t=N[e]||l;return a.jsx(t,{className:"w-4 h-4"})},v=e=>{const r=b[e]||t;return a.jsx(r,{className:"w-5 h-5"})},w=e=>e?`${e.toLocaleString()} km`:"N/A",C=e=>{if(!e)return"N/A";const a=Math.floor(e/24),t=e%24;return a>0?`${a}d ${t}h`:`${t}h`};return x?a.jsx("div",{className:"flex items-center justify-center",style:{height:o},children:a.jsx(G,{})}):a.jsxs("div",{className:"supply-chain-map space-y-4",children:[a.jsxs("div",{ref:g,className:"relative bg-gray-100 rounded-lg overflow-hidden shadow-inner",style:{height:o},children:[a.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:a.jsxs("div",{className:"text-center text-gray-500",children:[a.jsx(t,{className:"w-12 h-12 mx-auto mb-2"}),a.jsx("p",{children:"Interactive map will be displayed here"}),a.jsx("p",{className:"text-sm",children:"Integrate with mapping service (Google Maps, Mapbox, etc.)"})]})}),h&&a.jsxs("div",{className:"absolute top-4 left-4 bg-white rounded-lg shadow-lg p-4 max-w-xs",children:[a.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Route Overview"}),a.jsxs("div",{className:"space-y-1 text-sm",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-gray-500",children:"Total Distance:"}),a.jsx("span",{className:"font-medium",children:w(m.totalDistance)})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-gray-500",children:"Total Duration:"}),a.jsx("span",{className:"font-medium",children:C(m.totalDuration)})]}),m.carbonFootprint&&a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-gray-500",children:"Carbon Footprint:"}),a.jsxs("span",{className:"font-medium",children:[m.carbonFootprint.toFixed(2)," kg CO\u2082"]})]})]})]})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Supply Chain Journey"}),a.jsx("div",{className:"space-y-4",children:m.routes.map(((e,t)=>a.jsxs("div",{className:"relative",children:[t<m.routes.length-1&&a.jsx("div",{className:"absolute left-6 top-12 bottom-0 w-0.5 bg-gray-300"}),a.jsxs("div",{className:"border rounded-lg p-4 cursor-pointer transition-all "+(p===e?"border-blue-500 shadow-md bg-blue-50":"border-gray-200 hover:border-gray-300"),onClick:()=>u(e===p?null:e),children:[a.jsxs("div",{className:"flex items-start gap-4",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx("div",{className:"p-2 bg-gray-100 rounded-full text-gray-600",children:v(e.from.type)}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900",children:e.from.name}),a.jsx("p",{className:"text-sm text-gray-500",children:e.from.facility||e.from.address})]})]}),a.jsx("p",{className:"text-sm text-gray-500 ml-12",children:new Date(e.startDate).toLocaleDateString()})]}),a.jsxs("div",{className:"flex items-center gap-2 px-4",children:[a.jsx("div",{className:"p-2 bg-blue-100 rounded-full text-blue-600",children:f(e.transportMode)}),a.jsxs("div",{className:"text-sm",children:[a.jsx("p",{className:"font-medium text-gray-700",children:e.transportMode}),e.carrier&&a.jsx("p",{className:"text-gray-500",children:e.carrier})]})]}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx("div",{className:"p-2 bg-gray-100 rounded-full text-gray-600",children:v(e.to.type)}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900",children:e.to.name}),a.jsx("p",{className:"text-sm text-gray-500",children:e.to.facility||e.to.address})]})]}),a.jsx("p",{className:"text-sm text-gray-500 ml-12",children:e.endDate?new Date(e.endDate).toLocaleDateString():"In transit"})]})]}),p===e&&a.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-gray-500",children:"Distance"}),a.jsx("p",{className:"font-medium",children:w(e.distance)})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-gray-500",children:"Duration"}),a.jsx("p",{className:"font-medium",children:C(e.duration)})]}),e.trackingNumber&&a.jsxs("div",{children:[a.jsx("p",{className:"text-gray-500",children:"Tracking #"}),a.jsx("p",{className:"font-medium font-mono text-xs",children:e.trackingNumber})]}),e.temperature&&e.temperature.length>0&&a.jsxs("div",{children:[a.jsx("p",{className:"text-gray-500",children:"Avg Temperature"}),a.jsxs("p",{className:"font-medium",children:[(e.temperature.reduce(((e,a)=>e+a.temperature),0)/e.temperature.length).toFixed(1),"\xb0",e.temperature[0].unit]})]})]})})]})]},t)))})]})]})},J=({batches:t,onBatchSelect:r,selectedBatchId:s})=>{const[i,c]=e.useState(null),n=e=>{switch(e){case"ACTIVE":return a.jsx(x,{className:"w-5 h-5 text-green-500"});case"RECALLED":return a.jsx(u,{className:"w-5 h-5 text-red-500"});case"EXPIRED":return a.jsx(p,{className:"w-5 h-5 text-yellow-500"});case"CONSUMED":return a.jsx(h,{className:"w-5 h-5 text-gray-500"});default:return a.jsx(l,{className:"w-5 h-5 text-blue-500"})}},d=e=>{switch(e){case"ACTIVE":return"bg-green-50 text-green-800 border-green-200";case"RECALLED":return"bg-red-50 text-red-800 border-red-200";case"EXPIRED":return"bg-yellow-50 text-yellow-800 border-yellow-200";case"CONSUMED":return"bg-gray-50 text-gray-800 border-gray-200";default:return"bg-blue-50 text-blue-800 border-blue-200"}},y=e=>{switch(e){case"PASS":return"text-green-600 bg-green-50";case"FAIL":return"text-red-600 bg-red-50";case"PENDING":return"text-yellow-600 bg-yellow-50";default:return"text-gray-600 bg-gray-50"}};return a.jsxs("div",{className:"space-y-4",children:[t.map((e=>{const t=i===e.id,l=s===e.id,p=!!(u=e.expiryDate)&&new Date(u)<new Date;var u;return a.jsxs("div",{className:`bg-white rounded-lg shadow-sm border-2 transition-all ${l?"border-blue-500":"border-gray-200"} ${"RECALLED"===e.status?"border-red-300":""}`,children:[a.jsx("div",{className:"p-4 cursor-pointer hover:bg-gray-50 transition-colors "+(p?"bg-red-50":""),onClick:()=>(e=>{r&&r(e),c(i===e.id?null:e.id)})(e),children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[n(e.status),a.jsxs("div",{children:[a.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[a.jsx(m,{className:"w-4 h-4 text-gray-400"}),e.batchNumber]}),a.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm text-gray-500",children:[a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(o,{className:"w-3 h-3"}),"Produced: ",H(new Date(e.productionDate),"MMM dd, yyyy")]}),e.expiryDate&&a.jsxs("span",{className:"flex items-center gap-1 "+(p?"text-red-600 font-medium":""),children:[a.jsx(h,{className:"w-3 h-3"}),"Expires: ",H(new Date(e.expiryDate),"MMM dd, yyyy")]})]})]})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("div",{className:"text-right",children:[a.jsx("p",{className:"text-sm text-gray-500",children:"Quantity"}),a.jsxs("p",{className:"font-semibold",children:[e.quantity," ",e.unit]})]}),a.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium border ${d(e.status)}`,children:e.status})]})]})}),t&&a.jsxs("div",{className:"px-4 pb-4 space-y-4 border-t border-gray-200",children:[(e.parentBatchId||e.childBatchIds&&e.childBatchIds.length>0)&&a.jsxs("div",{className:"mt-4",children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Batch Relationships"}),a.jsxs("div",{className:"space-y-2",children:[e.parentBatchId&&a.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[a.jsx(g,{className:"w-4 h-4 text-gray-400"}),a.jsx("span",{className:"text-gray-500",children:"Parent Batch:"}),a.jsx("span",{className:"font-medium text-blue-600",children:e.parentBatchId})]}),e.childBatchIds&&e.childBatchIds.length>0&&a.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[a.jsx(g,{className:"w-4 h-4 text-gray-400 mt-0.5"}),a.jsx("span",{className:"text-gray-500",children:"Child Batches:"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:e.childBatchIds.map((e=>a.jsx("span",{className:"font-medium text-blue-600",children:e},e)))})]})]})]}),e.qualityTests&&e.qualityTests.length>0&&a.jsxs("div",{className:"mt-4",children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Quality Tests"}),a.jsx("div",{className:"space-y-2",children:e.qualityTests.map((e=>a.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-medium text-gray-900",children:e.testType}),a.jsx("p",{className:"text-sm text-gray-500",children:H(new Date(e.date),"MMM dd, yyyy")})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${y(e.result)}`,children:e.result}),e.certificateUrl&&a.jsx("a",{href:e.certificateUrl,target:"_blank",rel:"noopener noreferrer",className:"block mt-1 text-xs text-blue-600 hover:underline",children:"View Certificate"})]})]},e.id)))})]}),e.events&&e.events.length>0&&a.jsxs("div",{className:"mt-4",children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Recent Events"}),a.jsxs("div",{className:"space-y-2",children:[e.events.slice(0,3).map((e=>a.jsxs("div",{className:"flex items-start gap-3 text-sm",children:[a.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full mt-1.5"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-gray-900",children:e.title}),a.jsxs("p",{className:"text-gray-500",children:[e.location," \u2022 ",H(new Date(e.timestamp),"MMM dd, yyyy")]})]})]},e.id))),e.events.length>3&&a.jsxs("p",{className:"text-sm text-blue-600 ml-5 cursor-pointer hover:underline",children:["View all ",e.events.length," events"]})]})]})]})]},e.id)})),0===t.length&&a.jsxs("div",{className:"text-center py-8 text-gray-500",children:[a.jsx(l,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),a.jsx("p",{children:"No batches found"})]})]})},Q=({claims:r,onVerify:s,onAddEvidence:l})=>{const[i,c]=e.useState(null),[n,d]=e.useState(!1),m=e=>{switch(e){case"GPS":return a.jsx(t,{className:"w-4 h-4"});case"BLOCKCHAIN":return a.jsx(f,{className:"w-4 h-4"});case"CERTIFICATE":return a.jsx(y,{className:"w-4 h-4"});case"AUDIT":return a.jsx(b,{className:"w-4 h-4"});default:return a.jsx(p,{className:"w-4 h-4"})}},o=e=>{switch(e){case"DOCUMENT":default:return a.jsx(y,{className:"w-4 h-4"});case"IMAGE":return a.jsx(v,{className:"w-4 h-4"});case"GPS_LOG":return a.jsx(t,{className:"w-4 h-4"});case"BLOCKCHAIN_HASH":return a.jsx(f,{className:"w-4 h-4"})}},h=e=>{switch(e){case"COUNTRY":return"Country of Origin";case"REGION":return"Regional Origin";case"FARM":return"Farm Origin";case"FACILITY":return"Processing Facility";default:return"Origin"}};return a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Origin Claims & Verification"}),a.jsx("div",{className:"space-y-4",children:r.map((e=>{return a.jsxs("div",{className:"border rounded-lg p-4 transition-all cursor-pointer "+((null==i?void 0:i.id)===e.id?"border-blue-500 bg-blue-50":e.verified?"border-green-200 bg-green-50":"border-gray-200 hover:border-gray-300"),onClick:()=>c(e),children:[a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"p-2 rounded-full "+(e.verified?"bg-green-100":"bg-gray-100"),children:(l=e.claimType,"COUNTRY"===l?a.jsx(N,{className:"w-4 h-4"}):a.jsx(t,{className:"w-4 h-4"}))}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("h4",{className:"font-medium text-gray-900",children:h(e.claimType)}),(r=e.verified,r?a.jsx(x,{className:"w-5 h-5 text-green-500"}):a.jsx(u,{className:"w-5 h-5 text-gray-400"}))]}),a.jsx("p",{className:"text-lg font-semibold text-gray-800 mt-1",children:e.location}),e.coordinates&&a.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Coordinates: ",e.coordinates.lat.toFixed(6),", ",e.coordinates.lng.toFixed(6)]}),e.verificationDate&&a.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Verified on ",H(new Date(e.verificationDate),"MMM dd, yyyy")]})]})]}),e.verificationMethod&&a.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 bg-white rounded-full border border-gray-200",children:[m(e.verificationMethod),a.jsx("span",{className:"text-sm font-medium text-gray-700",children:e.verificationMethod})]})]}),e.evidence&&e.evidence.length>0&&a.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[a.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-2",children:"Supporting Evidence"}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:e.evidence.map(((e,t)=>a.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded border border-gray-200",children:[o(e.type),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"text-xs font-medium text-gray-900 truncate",children:e.description||e.type}),a.jsx("p",{className:"text-xs text-gray-500",children:H(new Date(e.timestamp),"MMM dd, yyyy")})]}),e.url&&a.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800",onClick:e=>e.stopPropagation(),children:a.jsx(y,{className:"w-4 h-4"})})]},t)))})]}),!e.verified&&a.jsxs("div",{className:"mt-4 flex gap-2",children:[a.jsx("button",{onClick:e=>{e.stopPropagation(),d(!0)},className:"px-3 py-1 text-sm font-medium text-blue-600 bg-blue-50 rounded-md hover:bg-blue-100 transition-colors",children:"Add Evidence"}),e.evidence&&e.evidence.length>0&&s&&a.jsx("button",{onClick:a=>{a.stopPropagation(),s(e.id,e.evidence)},className:"px-3 py-1 text-sm font-medium text-green-600 bg-green-50 rounded-md hover:bg-green-100 transition-colors",children:"Verify Claim"})]})]},e.id);var r,l}))}),0===r.length&&a.jsxs("div",{className:"text-center py-8 text-gray-500",children:[a.jsx(t,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),a.jsx("p",{children:"No origin claims found"})]})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Verification Summary"}),a.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-2xl font-bold text-gray-900",children:r.length}),a.jsx("p",{className:"text-xs text-gray-500",children:"Total Claims"})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-2xl font-bold text-green-600",children:r.filter((e=>e.verified)).length}),a.jsx("p",{className:"text-xs text-gray-500",children:"Verified"})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:r.filter((e=>!e.verified)).length}),a.jsx("p",{className:"text-xs text-gray-500",children:"Pending"})]})]})]}),i&&i.coordinates&&a.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Location Map"}),a.jsx("div",{className:"bg-gray-100 rounded-lg h-64 flex items-center justify-center",children:a.jsxs("div",{className:"text-center text-gray-500",children:[a.jsx(t,{className:"w-12 h-12 mx-auto mb-2"}),a.jsxs("p",{children:["Map integration for ",i.location]}),a.jsxs("p",{className:"text-sm mt-1",children:[i.coordinates.lat.toFixed(4),", ",i.coordinates.lng.toFixed(4)]})]})})]})]})},W=({supplier:e,onClick:r,showDetails:s=!0})=>{return a.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 transition-all "+(r?"cursor-pointer hover:shadow-md hover:border-gray-300":""),onClick:()=>null==r?void 0:r(e),children:[a.jsxs("div",{className:"flex items-start justify-between mb-3",children:[a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:`p-2 rounded-lg ${(e=>{switch(e){case"FARMER":return"bg-green-100 text-green-700";case"PROCESSOR":return"bg-blue-100 text-blue-700";case"MANUFACTURER":return"bg-purple-100 text-purple-700";case"DISTRIBUTOR":return"bg-orange-100 text-orange-700";case"RETAILER":return"bg-pink-100 text-pink-700";default:return"bg-gray-100 text-gray-700"}})(e.type)}`,children:(l=e.type,"FARMER"===l?a.jsx(w,{className:"w-5 h-5"}):a.jsx(I,{className:"w-5 h-5"}))}),a.jsxs("div",{children:[a.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[e.name,e.verified&&a.jsx(x,{className:"w-4 h-4 text-green-500"})]}),a.jsx("p",{className:"text-sm text-gray-500 capitalize",children:e.type.toLowerCase()})]})]}),e.sustainabilityScore&&a.jsxs("div",{className:"text-right",children:[a.jsxs("div",{className:"flex items-center gap-1 text-green-600",children:[a.jsx(w,{className:"w-4 h-4"}),a.jsxs("span",{className:"font-semibold",children:[e.sustainabilityScore,"%"]})]}),a.jsx("p",{className:"text-xs text-gray-500",children:"Sustainability"})]})]}),a.jsxs("div",{className:"flex items-start gap-2 mb-3",children:[a.jsx(t,{className:"w-4 h-4 text-gray-400 mt-0.5"}),a.jsxs("div",{className:"text-sm",children:[a.jsxs("p",{className:"text-gray-700",children:[e.region?`${e.region}, `:"",e.country]}),e.address&&a.jsx("p",{className:"text-gray-500",children:e.address})]})]}),e.rating&&a.jsx("div",{className:"mb-3",children:(e=>{if(!e)return null;const t=[],r=Math.floor(e),s=e%1>=.5;for(let l=0;l<5;l++)l<r?t.push(a.jsx(T,{className:"w-4 h-4 text-yellow-400 fill-current"},l)):l===r&&s?t.push(a.jsx(T,{className:"w-4 h-4 text-yellow-400 fill-current opacity-50"},l)):t.push(a.jsx(T,{className:"w-4 h-4 text-gray-300"},l));return a.jsxs("div",{className:"flex items-center gap-1",children:[t,a.jsxs("span",{className:"text-sm text-gray-600 ml-1",children:["(",e.toFixed(1),")"]})]})})(e.rating)}),s&&e.contact&&a.jsxs("div",{className:"space-y-2 mb-3 text-sm",children:[a.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[a.jsx(C,{className:"w-4 h-4"}),a.jsx("span",{children:e.contact.email})]}),a.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[a.jsx(S,{className:"w-4 h-4"}),a.jsx("span",{children:e.contact.phone})]})]}),e.certifications&&e.certifications.length>0&&a.jsxs("div",{className:"mb-3",children:[a.jsx("h4",{className:"text-xs font-medium text-gray-700 mb-2",children:"Certifications"}),a.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.certifications.slice(0,3).map(((e,t)=>a.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-blue-50 text-blue-700 rounded-full text-xs",children:[a.jsx(E,{className:"w-3 h-3"}),a.jsx("span",{children:e.name})]},t))),e.certifications.length>3&&a.jsxs("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 rounded-full text-xs",children:["+",e.certifications.length-3," more"]})]})]}),a.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-100",children:[a.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[a.jsx(o,{className:"w-3 h-3"}),a.jsxs("span",{children:["Partner since ",H(new Date(e.since),"yyyy")]})]}),e.fairTradeVerified&&a.jsxs("div",{className:"flex items-center gap-1 text-xs text-green-600 font-medium",children:[a.jsx(x,{className:"w-3 h-3"}),a.jsx("span",{children:"Fair Trade"})]})]})]});var l},Z=({events:s,showFilters:c=!0,compactMode:n=!1})=>{const[m,h]=e.useState(new Set),[g,u]=e.useState("ALL"),x={HARVEST:w,PROCESSING:i,PACKAGING:l,SHIPPING:d,STORAGE:l,DISTRIBUTION:d,RETAIL:r,CUSTOM:p},N={HARVEST:"bg-green-100 text-green-700 border-green-200",PROCESSING:"bg-blue-100 text-blue-700 border-blue-200",PACKAGING:"bg-purple-100 text-purple-700 border-purple-200",SHIPPING:"bg-orange-100 text-orange-700 border-orange-200",STORAGE:"bg-gray-100 text-gray-700 border-gray-200",DISTRIBUTION:"bg-yellow-100 text-yellow-700 border-yellow-200",RETAIL:"bg-pink-100 text-pink-700 border-pink-200",CUSTOM:"bg-red-100 text-red-700 border-red-200"},f=e=>{const t=x[e]||p;return a.jsx(t,{className:"w-5 h-5"})},v="ALL"===g?s:s.filter((e=>e.type===g)),C=Array.from(new Set(s.map((e=>e.type))));return a.jsxs("div",{className:"space-y-4",children:[c&&a.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Filter by Event Type"}),a.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.jsxs("button",{onClick:()=>u("ALL"),className:"px-3 py-1 rounded-full text-sm font-medium transition-colors "+("ALL"===g?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:["All Events (",s.length,")"]}),C.map((e=>a.jsxs("button",{onClick:()=>u(e),className:"px-3 py-1 rounded-full text-sm font-medium transition-colors flex items-center gap-1 "+(g===e?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[f(e),a.jsxs("span",{children:[e," (",s.filter((a=>a.type===e)).length,")"]})]},e)))]})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Supply Chain Timeline"}),a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute left-6 top-0 bottom-0 w-0.5 bg-gray-200"}),a.jsx("div",{className:"space-y-6",children:v.map(((e,r)=>{const s=m.has(e.id),l=x[e.type]||p;return a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute left-4 w-4 h-4 bg-white border-4 border-blue-500 rounded-full z-10"}),a.jsx("div",{className:"ml-12",children:a.jsxs("div",{className:"bg-white border rounded-lg p-4 cursor-pointer transition-all "+(s?"border-blue-500 shadow-md":"border-gray-200 hover:border-gray-300"),onClick:()=>(e=>{const a=new Set(m);a.has(e)?a.delete(e):a.add(e),h(a)})(e.id),children:[a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:`p-2 rounded-lg ${N[e.type]}`,children:a.jsx(l,{className:"w-5 h-5"})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:"font-semibold text-gray-900",children:e.title}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:e.description}),a.jsxs("div",{className:"flex flex-wrap gap-4 mt-2 text-sm text-gray-500",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(t,{className:"w-3 h-3"}),a.jsx("span",{children:e.location})]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(o,{className:"w-3 h-3"}),a.jsx("span",{children:H(new Date(e.timestamp),"MMM dd, yyyy HH:mm")})]}),!n&&a.jsx("span",{className:"text-gray-400",children:K(new Date(e.timestamp),{addSuffix:!0})})]}),(void 0!==e.temperature||void 0!==e.humidity)&&a.jsxs("div",{className:"flex gap-4 mt-2",children:[void 0!==e.temperature&&a.jsxs("div",{className:"flex items-center gap-1 text-sm text-blue-600",children:[a.jsx(A,{className:"w-3 h-3"}),a.jsxs("span",{children:[e.temperature,"\xb0C"]})]}),void 0!==e.humidity&&a.jsxs("div",{className:"flex items-center gap-1 text-sm text-cyan-600",children:[a.jsx(R,{className:"w-3 h-3"}),a.jsxs("span",{children:[e.humidity,"%"]})]})]})]})]}),a.jsx("button",{className:"text-gray-400 hover:text-gray-600",children:s?a.jsx(k,{className:"w-5 h-5"}):a.jsx(D,{className:"w-5 h-5"})})]}),s&&a.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 space-y-4",children:[e.documents&&e.documents.length>0&&a.jsxs("div",{children:[a.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-2",children:"Documents"}),a.jsx("div",{className:"grid grid-cols-2 gap-2",children:e.documents.map(((e,t)=>a.jsxs("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 p-2 bg-gray-50 rounded hover:bg-gray-100 transition-colors",onClick:e=>e.stopPropagation(),children:[a.jsx(y,{className:"w-4 h-4 text-gray-500"}),a.jsx("span",{className:"text-sm text-gray-700 truncate",children:e.name}),a.jsx(M,{className:"w-3 h-3 text-gray-400 ml-auto"})]},t)))})]}),e.images&&e.images.length>0&&a.jsxs("div",{children:[a.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-2",children:"Images"}),a.jsx("div",{className:"grid grid-cols-3 gap-2",children:e.images.map(((e,t)=>a.jsxs("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"relative aspect-square bg-gray-100 rounded overflow-hidden hover:opacity-90 transition-opacity",onClick:e=>e.stopPropagation(),children:[a.jsx("img",{src:e,alt:`Event image ${t+1}`,className:"w-full h-full object-cover"}),a.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-0 hover:bg-opacity-20 transition-all",children:a.jsx($,{className:"w-6 h-6 text-white opacity-0 hover:opacity-100"})})]},t)))})]}),e.certifications&&e.certifications.length>0&&a.jsxs("div",{children:[a.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-2",children:"Certifications"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:e.certifications.map(((e,t)=>a.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-green-50 text-green-700 rounded-full text-xs",children:[a.jsx(b,{className:"w-3 h-3"}),a.jsx("span",{children:e})]},t)))})]}),e.verificationHash&&a.jsx("div",{className:"bg-blue-50 rounded p-3",children:a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx(b,{className:"w-4 h-4 text-blue-600 mt-0.5"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm font-medium text-blue-900",children:"Verified Event"}),a.jsxs("p",{className:"text-xs text-blue-700 font-mono mt-1 break-all",children:["Hash: ",e.verificationHash]})]})]})}),e.metadata&&Object.keys(e.metadata).length>0&&a.jsxs("div",{children:[a.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-2",children:"Additional Information"}),a.jsx("div",{className:"space-y-1",children:Object.entries(e.metadata).map((([e,t])=>a.jsxs("div",{className:"flex justify-between text-sm",children:[a.jsxs("span",{className:"text-gray-500",children:[e,":"]}),a.jsx("span",{className:"text-gray-700 font-medium",children:String(t)})]},e)))})]})]})]})})]},e.id)}))})]}),0===v.length&&a.jsxs("div",{className:"text-center py-8 text-gray-500",children:[a.jsx(o,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),a.jsx("p",{children:"No events found"})]})]})]})},ee=new class{async getSupplyChainEvents(e){return(await U.get(`/traceability/products/${e}/events`)).data}async createSupplyChainEvent(e){return(await U.post("/traceability/events",e)).data}async updateSupplyChainEvent(e,a){return(await U.put(`/traceability/events/${e}`,a)).data}async deleteSupplyChainEvent(e){await U.delete(`/traceability/events/${e}`)}async getBatchInfo(e){return(await U.get(`/traceability/batches/${e}`)).data}async createBatch(e){return(await U.post("/traceability/batches",e)).data}async updateBatch(e,a){return(await U.put(`/traceability/batches/${e}`,a)).data}async getBatchesByProduct(e){return(await U.get(`/traceability/products/${e}/batches`)).data}async splitBatch(e,a){return(await U.post(`/traceability/batches/${e}/split`,{quantities:a})).data}async mergeBatches(e){return(await U.post("/traceability/batches/merge",{batchIds:e})).data}async getSuppliers(e){const a=e?`/traceability/products/${e}/suppliers`:"/traceability/suppliers";return(await U.get(a)).data}async getSupplier(e){return(await U.get(`/traceability/suppliers/${e}`)).data}async createSupplier(e){return(await U.post("/traceability/suppliers",e)).data}async updateSupplier(e,a){return(await U.put(`/traceability/suppliers/${e}`,a)).data}async linkSupplierToProduct(e,a,t){await U.post(`/traceability/products/${e}/suppliers/${a}`,{role:t})}async unlinkSupplierFromProduct(e,a){await U.delete(`/traceability/products/${e}/suppliers/${a}`)}async getOriginClaims(e){return(await U.get(`/traceability/products/${e}/origins`)).data}async verifyOrigin(e,a){return(await U.post(`/traceability/origins/${e}/verify`,{evidence:a})).data}async createOriginClaim(e){return(await U.post("/traceability/origins",e)).data}async getSupplyChainRoute(e,a){const t=a?{batchId:a}:{};return(await U.get(`/traceability/products/${e}/route`,{params:t})).data}async calculateCarbonFootprint(e){return(await U.get(`/traceability/products/${e}/carbon-footprint`)).data}async generateTraceabilityReport(e,a){return(await U.post(`/traceability/products/${e}/reports`,{reportType:a})).data}async getTraceabilityReports(e){return(await U.get(`/traceability/products/${e}/reports`)).data}async downloadTraceabilityReport(e){return(await U.get(`/traceability/reports/${e}/download`,{responseType:"blob"})).data}async searchSupplyChainEvents(e){return(await U.get("/traceability/events/search",{params:e})).data}async getSupplyChainSummary(e){return(await U.get(`/traceability/products/${e}/summary`)).data}async getTraceabilityAnalytics(e){return(await U.get(`/traceability/products/${e}/analytics`)).data}async uploadTraceabilityDocument(e,a,t){const r=new FormData;return r.append("document",t),r.append("productId",e),r.append("eventId",a),(await U.post("/traceability/documents/upload",r,{headers:{"Content-Type":"multipart/form-data"}})).data.url}async verifyDocument(e){return(await U.get(`/traceability/documents/${e}/verify`)).data}async recordOnBlockchain(e){return(await U.post(`/traceability/events/${e}/blockchain`)).data}async verifyBlockchainRecord(e){return(await U.get(`/traceability/events/${e}/blockchain/verify`)).data}},ae=()=>{const{productId:r}=X();q();const[s,i]=e.useState("timeline"),[c,n]=e.useState(null),[d,m]=e.useState([]),[h,g]=e.useState([]),[p,u]=e.useState([]),[x,y]=e.useState([]),[b,f]=e.useState(null),[v,w]=e.useState(null),[C,S]=e.useState(null),[E,I]=e.useState(""),[T,A]=e.useState(!1),{execute:R,loading:k}=Y((async()=>{if(!r)return;const e=await _.getProduct(r);n(e);const[a,t,s,l,i,c]=await Promise.all([ee.getSupplyChainEvents(r),ee.getBatchesByProduct(r),ee.getSuppliers(r),ee.getOriginClaims(r),ee.getSupplyChainRoute(r),ee.getSupplyChainSummary(r)]);m(a),g(t),u(s),y(l),f(i),w(c)}));e.useEffect((()=>{R()}),[r]);const D=e=>{};return k?a.jsx(V,{children:a.jsx("div",{className:"flex items-center justify-center h-96",children:a.jsx(G,{})})}):c?a.jsx(V,{children:a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Supply Chain Traceability"}),a.jsxs("div",{className:"mt-2 flex items-center gap-4 text-sm text-gray-600",children:[a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(l,{className:"w-4 h-4"}),c.name]}),a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"font-medium",children:"SKU:"})," ",c.sku]}),c.batchNumber&&a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"font-medium",children:"Batch:"})," ",c.batchNumber]})]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("button",{onClick:()=>A(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[a.jsx(O,{className:"w-4 h-4"}),"Add Event"]}),a.jsxs("button",{onClick:async()=>{try{const e=await ee.generateTraceabilityReport(r,"FULL"),a=await ee.downloadTraceabilityReport(e.id),t=window.URL.createObjectURL(a),s=document.createElement("a");s.href=t,s.download=`traceability-report-${null==c?void 0:c.sku}-${(new Date).toISOString().split("T")[0]}.pdf`,document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(t),document.body.removeChild(s),F.success("Report downloaded successfully")}catch(e){F.error("Failed to generate report")}},className:"flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:[a.jsx(j,{className:"w-4 h-4"}),"Export Report"]})]})]}),v&&a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6",children:[a.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-500",children:"Total Events"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:v.totalEvents})]}),a.jsx(o,{className:"w-8 h-8 text-gray-400"})]})}),a.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-500",children:"Locations"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:v.uniqueLocations})]}),a.jsx(t,{className:"w-8 h-8 text-gray-400"})]})}),a.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-500",children:"Compliance"}),a.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[v.complianceScore,"%"]})]}),a.jsx(P,{className:"w-8 h-8 text-gray-400"})]})}),a.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-500",children:"Distance"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:v.totalDistance?`${(v.totalDistance/1e3).toFixed(0)}k km`:"N/A"})]}),a.jsx(N,{className:"w-8 h-8 text-gray-400"})]})})]})]}),a.jsx("div",{className:"bg-white rounded-lg shadow-sm p-1",children:a.jsx("nav",{className:"flex space-x-1",children:[{id:"timeline",label:"Timeline",icon:o},{id:"map",label:"Supply Chain Map",icon:t},{id:"batches",label:"Batch Tracking",icon:l},{id:"suppliers",label:"Suppliers",icon:L},{id:"origins",label:"Origin Verification",icon:N}].map((e=>{const t=e.icon;return a.jsxs("button",{onClick:()=>i(e.id),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors "+(s===e.id?"bg-blue-50 text-blue-600":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"),children:[a.jsx(t,{className:"w-4 h-4"}),a.jsx("span",{className:"hidden sm:inline",children:e.label})]},e.id)}))})}),a.jsxs("div",{className:"space-y-4",children:["timeline"===s&&a.jsx(Z,{events:C?d.filter((e=>{var a;return(null==(a=e.metadata)?void 0:a.batchId)===C.id})):d,showFilters:!0}),"map"===s&&b&&a.jsx(z,{route:b,height:"600px",showDetails:!0}),"batches"===s&&a.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Batch Tracking"}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsxs("div",{className:"relative",children:[a.jsx(B,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),a.jsx("input",{type:"text",placeholder:"Search batches...",value:E,onChange:e=>I(e.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})})]}),a.jsx(J,{batches:h.filter((e=>""===E||e.batchNumber.toLowerCase().includes(E.toLowerCase()))),onBatchSelect:e=>{S(e),i("timeline")},selectedBatchId:null==C?void 0:C.id})]}),"suppliers"===s&&a.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Supply Chain Partners"}),a.jsxs("span",{className:"text-sm text-gray-500",children:[p.length," suppliers"]})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:p.map((e=>a.jsx(W,{supplier:e,onClick:D},e.id)))})]}),"origins"===s&&a.jsx(Q,{claims:x,onVerify:async(e,a)=>{try{await ee.verifyOrigin(e,a),F.success("Origin claim verified"),R()}catch(t){F.error("Failed to verify origin")}}})]})]})}):a.jsx(V,{children:a.jsx("div",{className:"text-center py-12",children:a.jsx("p",{className:"text-gray-500",children:"Product not found"})})})};export{ae as default};
