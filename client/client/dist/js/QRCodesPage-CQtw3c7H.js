import{r as e,j as a,P as t,Q as r,k as s,af as l,a_ as d,a5 as i,z as o,ay as n}from"./react-core-XCdXHkeW.js";import{p as c}from"./productService-CHIPryK1.js";import{q as m}from"./qrService-BwD7nkbO.js";import{u as h}from"./qrStore-DYdzASqr.js";import{b as x}from"./react-router-G9IXNjIc.js";import"./vendor-BcMaAnXF.js";import"./state-QrSTFgAv.js";import"./react-dom-BslC4xag.js";import"./index-D7IercYq.js";import"./utils-BtzqxagS.js";import"./forms-Bk6aQ3xQ.js";const p=()=>{const p=x(),[g,N]=e.useState([]),[u,b]=e.useState(!0),[y,v]=e.useState(null),{getQRCode:f,lastUpdate:w}=h(),C=async()=>{try{b(!0);const e=(await c.getProducts({limit:100})).data.map((e=>{const a=!!e.qrCode,t=f(e.id);let r=null;if(t)r=t;else if(a){const a=`${window.location.origin}/validation/${e.qrCode}`;r={qrCode:e.qrCode,validationUrl:a,qrCodeImage:`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(a)}`,product:{id:e.id,name:e.name,brand:e.brand,sku:e.sku}}}return{...e,hasQRCode:a||!!t,qrCodeData:r}}));N(e)}catch(e){n.error("Erro ao carregar produtos")}finally{b(!1)}};e.useEffect((()=>{C()}),[]),e.useEffect((()=>{g.length>0&&C()}),[w]);const R=async e=>{e.qrCodeData&&(await m.copyValidationUrl(e.qrCodeData.validationUrl)?n.success("URL copiada para a \xe1rea de transfer\xeancia"):n.error("Erro ao copiar URL"))},D=e=>{switch(e){case"VALIDATED":return"bg-green-100 text-green-800";case"PENDING":return"bg-yellow-100 text-yellow-800";case"REJECTED":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return u?a.jsx("div",{className:"flex items-center justify-center min-h-screen",children:a.jsx("div",{className:"loading-spinner w-8 h-8"})}):a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"flex justify-between items-center",children:a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"QR Codes"}),a.jsx("p",{className:"text-gray-600",children:"Gerencie QR Codes dos seus produtos"})]})}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[a.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(t,{className:"w-8 h-8 text-blue-600 mr-3"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Total de Produtos"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:g.length})]})]})}),a.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(r,{className:"w-8 h-8 text-green-600 mr-3"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Com QR Code"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:g.filter((e=>e.hasQRCode)).length})]})]})}),a.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(s,{className:"w-8 h-8 text-purple-600 mr-3"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Validados"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:g.filter((e=>"VALIDATED"===e.status)).length})]})]})})]}),a.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:g.map((e=>a.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[a.jsxs("div",{className:"flex items-start justify-between mb-4",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:e.name}),a.jsx("p",{className:"text-sm text-gray-600",children:e.brand}),a.jsxs("p",{className:"text-xs text-gray-500",children:["SKU: ",e.sku]})]}),a.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${D(e.status)}`,children:["VALIDATED"===e.status&&"Validado","PENDING"===e.status&&"Pendente","REJECTED"===e.status&&"Rejeitado"]})]}),e.hasQRCode&&e.qrCodeData?a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"flex justify-center",children:a.jsx("img",{src:e.qrCodeData.qrCodeImage,alt:`QR Code - ${e.name}`,className:"w-32 h-32 border rounded-lg"})}),a.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[a.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"URL de Valida\xe7\xe3o:"}),a.jsx("p",{className:"text-xs font-mono text-gray-800 break-all",children:e.qrCodeData.validationUrl})]}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsxs("button",{onClick:()=>(e=>{e.qrCodeData&&(m.downloadQRCodeImage(e.qrCodeData.qrCodeImage,e.name),n.success("Download iniciado"))})(e),className:"flex-1 btn btn-outline text-sm",title:"Download QR Code",children:[a.jsx(l,{className:"w-4 h-4 mr-1"}),"Download"]}),a.jsxs("button",{onClick:()=>R(e),className:"flex-1 btn btn-outline text-sm",title:"Copiar URL",children:[a.jsx(d,{className:"w-4 h-4 mr-1"}),"Copiar"]}),a.jsx("button",{onClick:()=>(async e=>{e.qrCodeData&&(await m.shareQRCode(e.qrCodeData)||await R(e))})(e),className:"btn btn-outline text-sm px-3",title:"Compartilhar",children:a.jsx(i,{className:"w-4 h-4"})})]})]}):a.jsxs("div",{className:"text-center py-8",children:[a.jsx(r,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),a.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"VALIDATED"===e.status?"QR Code n\xe3o gerado":"Produto precisa ser validado primeiro"}),"VALIDATED"===e.status&&a.jsx("button",{onClick:()=>(async e=>{var a,t,r;try{v(e);const a=await m.generateQRCode(e);N((t=>t.map((t=>t.id===e?{...t,qrCodeData:a,hasQRCode:!0}:t)))),n.success("QR Code gerado com sucesso!")}catch(s){401===(null==(a=s.response)?void 0:a.status)?n.error("Sess\xe3o expirada. Fa\xe7a login novamente."):404===(null==(t=s.response)?void 0:t.status)?n.error("Produto n\xe3o encontrado ou n\xe3o validado."):403===(null==(r=s.response)?void 0:r.status)?n.error("Voc\xea n\xe3o tem permiss\xe3o para gerar QR Code para este produto."):n.error("Erro ao gerar QR Code. Tente novamente.")}finally{v(null)}})(e.id),disabled:y===e.id,className:"btn btn-primary text-sm",children:y===e.id?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"loading-spinner w-4 h-4 mr-2"}),"Gerando..."]}):a.jsxs(a.Fragment,{children:[a.jsx(r,{className:"w-4 h-4 mr-2"}),"Gerar QR Code"]})})]}),e.hasQRCode&&a.jsx("div",{className:"mt-4 pt-4 border-t",children:a.jsxs("button",{className:"w-full btn btn-outline text-sm",onClick:()=>p(`/dashboard/qr-codes/${e.id}/analytics`),children:[a.jsx(o,{className:"w-4 h-4 mr-2"}),"Ver Analytics"]})})]},e.id)))}),0===g.length&&!u&&a.jsxs("div",{className:"text-center py-12",children:[a.jsx(r,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nenhum produto encontrado"}),a.jsx("p",{className:"text-gray-600 mb-4",children:"Cadastre produtos para gerar QR Codes"})]})]})};export{p as QRCodesPage,p as default};
