import{r as e,ay as a,j as t,e as s,af as r,z as l,ae as d,T as i,a8 as c,Y as o}from"./react-core-XCdXHkeW.js";import{q as n}from"./qrService-BwD7nkbO.js";import{p as m}from"./productService-CHIPryK1.js";import{L as h}from"./index-D7IercYq.js";import{d as x,b as p}from"./react-router-G9IXNjIc.js";import"./vendor-BcMaAnXF.js";import"./state-QrSTFgAv.js";import"./react-dom-BslC4xag.js";import"./utils-BtzqxagS.js";import"./forms-Bk6aQ3xQ.js";const g=()=>{const{productId:g}=x(),N=p(),[y,f]=e.useState(null),[b,u]=e.useState([]),[w,v]=e.useState({total:0,today:0,thisWeek:0,thisMonth:0}),[j,k]=e.useState(!0);e.useEffect((()=>{g&&C()}),[g]);const C=async()=>{var e;if(g)try{k(!0);const a=await m.getProduct(g);f(a.product);try{const e=await n.getQRCodeAccesses(g);u(e.accesses||[]),v(e.statistics||w)}catch(t){if(404!==(null==(e=t.response)?void 0:e.status))throw t;u([]),v({total:0,today:0,thisWeek:0,thisMonth:0})}}catch(t){a.error("Erro ao carregar dados de analytics")}finally{k(!1)}},D=e=>new Date(e).toLocaleString("pt-BR"),R=e=>e.includes("Mobile")?"Mobile":e.includes("Tablet")?"Tablet":"Desktop",E=e=>e.includes("Chrome")?"Chrome":e.includes("Firefox")?"Firefox":e.includes("Safari")?"Safari":e.includes("Edge")?"Edge":"Outro";return j?t.jsx("div",{className:"flex justify-center items-center h-64",children:t.jsx(h,{size:"lg"})}):y?t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("button",{onClick:()=>N("/dashboard/qr-codes"),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:t.jsx(s,{className:"w-5 h-5"})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Analytics do QR Code"}),t.jsxs("p",{className:"text-gray-600",children:[y.name," - ",y.sku]})]})]}),t.jsx("div",{className:"flex space-x-3",children:t.jsxs("button",{onClick:()=>{const e=[["Data/Hora","IP","Dispositivo","Navegador","Localiza\xe7\xe3o"],...b.map((e=>[D(e.accessedAt),e.ipAddress,R(e.userAgent),E(e.userAgent),e.location||"N/A"]))].map((e=>e.join(","))).join("\n"),t=new Blob([e],{type:"text/csv"}),s=window.URL.createObjectURL(t),r=document.createElement("a");r.href=s,r.download=`analytics-${(null==y?void 0:y.name)||"produto"}-${(new Date).toISOString().split("T")[0]}.csv`,r.click(),window.URL.revokeObjectURL(s),a.success("Dados exportados com sucesso!")},className:"btn btn-outline flex items-center",children:[t.jsx(r,{className:"w-4 h-4 mr-2"}),"Exportar"]})})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[t.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(l,{className:"w-8 h-8 text-blue-600 mr-3"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Total de Acessos"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:w.total})]})]})}),t.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(d,{className:"w-8 h-8 text-green-600 mr-3"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Hoje"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:w.today})]})]})}),t.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(i,{className:"w-8 h-8 text-purple-600 mr-3"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Esta Semana"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:w.thisWeek})]})]})}),t.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(c,{className:"w-8 h-8 text-orange-600 mr-3"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Este M\xeas"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:w.thisMonth})]})]})})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Informa\xe7\xf5es do QR Code"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium text-gray-600",children:"C\xf3digo QR"}),t.jsx("p",{className:"font-mono text-sm bg-gray-50 p-2 rounded",children:y.qrCode})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium text-gray-600",children:"URL de Valida\xe7\xe3o"}),t.jsx("p",{className:"text-sm bg-gray-50 p-2 rounded break-all",children:`${window.location.origin}/validation/${y.qrCode}`})]})]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border",children:[t.jsx("div",{className:"p-6 border-b",children:t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Hist\xf3rico de Acessos"})}),0===b.length?t.jsxs("div",{className:"p-12 text-center",children:[t.jsx(l,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),t.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nenhum acesso registrado"}),t.jsx("p",{className:"text-gray-600",children:"O QR Code ainda n\xe3o foi escaneado por nenhum usu\xe1rio."})]}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data/Hora"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"IP"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Dispositivo"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Navegador"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Localiza\xe7\xe3o"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:b.map((e=>t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:D(e.accessedAt)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-600",children:e.ipAddress}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(c,{className:"w-4 h-4 mr-2 text-gray-400"}),R(e.userAgent)]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:E(e.userAgent)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(o,{className:"w-4 h-4 mr-2 text-gray-400"}),e.location||"N/A"]})})]},e.id)))})]})})]})]}):t.jsxs("div",{className:"text-center py-12",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Produto n\xe3o encontrado"}),t.jsx("button",{onClick:()=>N("/dashboard/qr-codes"),className:"btn btn-primary",children:"Voltar para QR Codes"})]})};export{g as default};
