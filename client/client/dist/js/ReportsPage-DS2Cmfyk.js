import{r as e,j as a,K as t,F as l,n as r,o as s,au as i,an as n,aT as o,G as c,ae as d,z as m,af as h,aS as p,ay as u}from"./react-core-XCdXHkeW.js";import{L as x}from"./index-D7IercYq.js";import"./vendor-BcMaAnXF.js";import"./state-QrSTFgAv.js";import"./react-dom-BslC4xag.js";import"./react-router-G9IXNjIc.js";import"./utils-BtzqxagS.js";import"./forms-Bk6aQ3xQ.js";const g=()=>{const[g,v]=e.useState([]),[y,b]=e.useState(!0),[f,w]=e.useState(""),[A,E]=e.useState("ALL"),[k,P]=e.useState(!1),[C,D]=e.useState(!1);e.useEffect((()=>{(async()=>{try{b(!0);const e=await fetch("http://localhost:3001/api/reports",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(e.ok){const a=((await e.json()).reports||[]).map((e=>{var a,t;return{id:e.id,fileName:e.originalName,productName:(null==(a=e.product)?void 0:a.name)||"Produto n\xe3o encontrado",productId:e.productId,laboratoryName:(null==(t=e.laboratory)?void 0:t.name)||"Laborat\xf3rio n\xe3o encontrado",laboratoryId:e.laboratoryId,status:e.isVerified?"APPROVED":"PENDING",uploadedAt:e.createdAt,fileSize:e.fileSize,fileType:e.mimeType,downloadUrl:`/api/reports/${e.id}/download`,observations:e.results||""}}));v(a)}else v([])}catch(e){v([])}finally{b(!1)}})()}),[]);const j=e=>{const t={PENDING:{color:"bg-yellow-100 text-yellow-800",icon:s,text:"Pendente"},APPROVED:{color:"bg-green-100 text-green-800",icon:r,text:"Aprovado"},REJECTED:{color:"bg-red-100 text-red-800",icon:i,text:"Rejeitado"}}[e],l=t.icon;return a.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${t.color}`,children:[a.jsx(l,{className:"w-3 h-3 mr-1"}),t.text]})},R=e=>{if(0===e)return"0 Bytes";const a=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,a)).toFixed(2))+" "+["Bytes","KB","MB","GB"][a]},T=g.filter((e=>{const a=e.fileName.toLowerCase().includes(f.toLowerCase())||e.productName.toLowerCase().includes(f.toLowerCase())||e.laboratoryName.toLowerCase().includes(f.toLowerCase()),t="ALL"===A||e.status===A;return a&&t})),B={total:g.length,approved:g.filter((e=>"APPROVED"===e.status)).length,pending:g.filter((e=>"PENDING"===e.status)).length,rejected:g.filter((e=>"REJECTED"===e.status)).length};return y?a.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:a.jsx(x,{size:"lg"})}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Relat\xf3rios"}),a.jsx("p",{className:"text-gray-600",children:"Gerencie relat\xf3rios de an\xe1lise"})]}),a.jsxs("button",{onClick:()=>P(!0),className:"btn btn-primary flex items-center",children:[a.jsx(t,{className:"w-4 h-4 mr-2"}),"Enviar Relat\xf3rio"]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[a.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:a.jsx(l,{className:"h-6 w-6 text-blue-600"})}),a.jsxs("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total de Relat\xf3rios"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:B.total})]})]})}),a.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:a.jsx(r,{className:"h-6 w-6 text-green-600"})}),a.jsxs("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Aprovados"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:B.approved})]})]})}),a.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:a.jsx(s,{className:"h-6 w-6 text-yellow-600"})}),a.jsxs("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pendentes"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:B.pending})]})]})}),a.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:a.jsx(i,{className:"h-6 w-6 text-red-600"})}),a.jsxs("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Rejeitados"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:B.rejected})]})]})})]}),a.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:a.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[a.jsx("div",{className:"flex-1",children:a.jsxs("div",{className:"relative",children:[a.jsx(n,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),a.jsx("input",{type:"text",placeholder:"Buscar relat\xf3rios...",value:f,onChange:e=>w(e.target.value),className:"input pl-10 w-full"})]})}),a.jsx("div",{className:"sm:w-48",children:a.jsxs("select",{value:A,onChange:e=>E(e.target.value),className:"input w-full",children:[a.jsx("option",{value:"ALL",children:"Todos os status"}),a.jsx("option",{value:"PENDING",children:"Pendentes"}),a.jsx("option",{value:"APPROVED",children:"Aprovados"}),a.jsx("option",{value:"REJECTED",children:"Rejeitados"})]})})]})}),a.jsx("div",{className:"bg-white rounded-lg shadow-sm border overflow-hidden",children:0===T.length?a.jsxs("div",{className:"text-center py-12",children:[a.jsx(l,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nenhum relat\xf3rio encontrado"}),a.jsx("p",{className:"text-gray-600 mb-4",children:0===g.length?"Comece enviando o primeiro relat\xf3rio":"Tente ajustar os filtros de busca"}),a.jsxs("button",{onClick:()=>P(!0),className:"btn btn-primary",children:[a.jsx(o,{className:"w-4 h-4 mr-2"}),"Enviar Relat\xf3rio"]})]}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Arquivo"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Produto"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Laborat\xf3rio"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"A\xe7\xf5es"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:T.map((e=>{return a.jsxs("tr",{className:"hover:bg-gray-50",children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(l,{className:"h-5 w-5 text-gray-400 mr-3"}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.fileName}),a.jsx("div",{className:"text-sm text-gray-500",children:R(e.fileSize)})]})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.productName})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(c,{className:"h-4 w-4 text-gray-400 mr-2"}),a.jsx("div",{className:"text-sm text-gray-900",children:e.laboratoryName})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:j(e.status)}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(d,{className:"h-4 w-4 text-gray-400 mr-2"}),a.jsx("div",{className:"text-sm text-gray-900",children:(t=e.uploadedAt,new Date(t).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}))})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:a.jsxs("div",{className:"flex items-center space-x-2",children:[e.downloadUrl&&a.jsx("button",{onClick:()=>window.open(e.downloadUrl,"_blank"),className:"text-blue-600 hover:text-blue-900",title:"Visualizar",children:a.jsx(m,{className:"h-4 w-4"})}),e.downloadUrl&&a.jsx("button",{onClick:()=>window.open(e.downloadUrl,"_blank"),className:"text-green-600 hover:text-green-900",title:"Download",children:a.jsx(h,{className:"h-4 w-4"})}),a.jsx("button",{onClick:()=>(async e=>{if(confirm("Tem certeza que deseja excluir este relat\xf3rio?"))try{v((a=>a.filter((a=>a.id!==e)))),u.success("Relat\xf3rio exclu\xeddo com sucesso!")}catch(a){u.error("Erro ao excluir relat\xf3rio")}})(e.id),className:"text-red-600 hover:text-red-900",title:"Excluir",children:a.jsx(p,{className:"h-4 w-4"})})]})})]},e.id);var t}))})]})})}),k&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Enviar Relat\xf3rio"}),a.jsx(N,{onUpload:async e=>{try{D(!0);const a=new FormData;a.append("file",e.file),a.append("productId",e.productId),a.append("laboratoryId",e.laboratoryId),a.append("analysisType",e.analysisType);const t=await fetch("http://localhost:3001/api/reports",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},body:a});if(!t.ok){const e=await t.json();throw new Error(e.error||"Erro no upload")}await t.json();const l=await fetch("http://localhost:3001/api/reports",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(l.ok){const e=await l.json();v(e.reports||[])}P(!1),u.success("Relat\xf3rio enviado com sucesso!")}catch(a){u.error(a.message||"Erro ao enviar relat\xf3rio")}finally{D(!1)}},uploading:C,onCancel:()=>P(!1)})]})})]})},N=({onUpload:t,uploading:r,onCancel:s})=>{const[i,n]=e.useState(!1),[c,d]=e.useState(null),[m,h]=e.useState([]),[x,g]=e.useState([]),[N,v]=e.useState({productId:"",laboratoryId:"",analysisType:""});e.useEffect((()=>{(async()=>{try{const[e,a]=await Promise.all([fetch("http://localhost:3001/api/products",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),fetch("http://localhost:3001/api/laboratories",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})]);if(e.ok){const a=await e.json();h(a.products||[])}if(a.ok){const e=await a.json();g(e.laboratories||[])}}catch(e){}})()}),[]);const y=e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?n(!0):"dragleave"===e.type&&n(!1)},b=c&&N.productId&&N.laboratoryId&&N.analysisType;return a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Produto *"}),a.jsxs("select",{value:N.productId,onChange:e=>v((a=>({...a,productId:e.target.value}))),className:"input w-full",disabled:r,children:[a.jsx("option",{value:"",children:"Selecione um produto"}),m.map((e=>a.jsxs("option",{value:e.id,children:[e.name," - ",e.brand]},e.id)))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Laborat\xf3rio *"}),a.jsxs("select",{value:N.laboratoryId,onChange:e=>v((a=>({...a,laboratoryId:e.target.value}))),className:"input w-full",disabled:r,children:[a.jsx("option",{value:"",children:"Selecione um laborat\xf3rio"}),x.map((e=>a.jsxs("option",{value:e.id,children:[e.name," - ",e.accreditation]},e.id)))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de An\xe1lise *"}),a.jsxs("select",{value:N.analysisType,onChange:e=>v((a=>({...a,analysisType:e.target.value}))),className:"input w-full",disabled:r,children:[a.jsx("option",{value:"",children:"Selecione o tipo de an\xe1lise"}),a.jsx("option",{value:"nutritional",children:"An\xe1lise Nutricional"}),a.jsx("option",{value:"microbiological",children:"An\xe1lise Microbiol\xf3gica"}),a.jsx("option",{value:"contaminants",children:"An\xe1lise de Contaminantes"}),a.jsx("option",{value:"allergens",children:"An\xe1lise de Al\xe9rgenos"}),a.jsx("option",{value:"protein",children:"An\xe1lise de Prote\xednas"}),a.jsx("option",{value:"gluten",children:"An\xe1lise de Gl\xfaten"}),a.jsx("option",{value:"other",children:"Outros"})]})]}),a.jsxs("div",{className:"border-2 border-dashed rounded-lg p-6 text-center transition-colors "+(i?"border-blue-400 bg-blue-50":"border-gray-300 hover:border-gray-400"),onDragEnter:y,onDragLeave:y,onDragOver:y,onDrop:e=>{if(e.preventDefault(),e.stopPropagation(),n(!1),e.dataTransfer.files&&e.dataTransfer.files[0]){const a=e.dataTransfer.files[0];"application/pdf"===a.type||a.type.startsWith("image/")?d(a):u.error("Apenas arquivos PDF e imagens s\xe3o aceitos")}},children:[a.jsx(o,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),a.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Arraste e solte um arquivo aqui, ou"}),a.jsxs("label",{className:"cursor-pointer",children:[a.jsx("span",{className:"text-blue-600 hover:text-blue-700 font-medium",children:"clique para selecionar"}),a.jsx("input",{type:"file",className:"hidden",accept:".pdf,image/*",onChange:e=>{if(e.target.files&&e.target.files[0]){const a=e.target.files[0];"application/pdf"===a.type||a.type.startsWith("image/")?d(a):u.error("Apenas arquivos PDF e imagens s\xe3o aceitos")}},disabled:r})]}),a.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"PDF ou imagens at\xe9 10MB"})]}),c&&a.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(l,{className:"h-5 w-5 text-gray-400 mr-3"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm font-medium text-gray-900",children:c.name}),a.jsxs("p",{className:"text-xs text-gray-500",children:[(c.size/1024/1024).toFixed(2)," MB"]})]}),a.jsx("button",{onClick:()=>d(null),className:"text-red-600 hover:text-red-700",disabled:r,children:a.jsx(p,{className:"h-4 w-4"})})]})}),a.jsxs("div",{className:"flex justify-end space-x-3",children:[a.jsx("button",{onClick:s,className:"btn btn-secondary",disabled:r,children:"Cancelar"}),a.jsx("button",{onClick:()=>{c&&N.productId&&N.laboratoryId&&N.analysisType?t({file:c,productId:N.productId,laboratoryId:N.laboratoryId,analysisType:N.analysisType}):u.error("Preencha todos os campos obrigat\xf3rios")},className:"btn btn-primary",disabled:!b||r,children:r?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"loading-spinner w-4 h-4 mr-2"}),"Enviando..."]}):a.jsxs(a.Fragment,{children:[a.jsx(o,{className:"w-4 h-4 mr-2"}),"Enviar"]})})]})]})};export{g as default};
