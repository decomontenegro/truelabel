const t=t=>{let e;const n=new Set,r=(t,r)=>{const o="function"==typeof t?t(e):t;if(!Object.is(o,e)){const t=e;e=(null!=r?r:"object"!=typeof o||null===o)?o:Object.assign({},e,o),n.forEach((n=>n(e,t)))}},o=()=>e,s={setState:r,getState:o,getInitialState:()=>i,subscribe:t=>(n.add(t),()=>n.delete(t))},i=e=t(r,o,s);return s},e=e=>e?t(e):t;function n(t,e){let n;try{n=t()}catch(r){return}return{getItem:t=>{var e;const r=t=>null===t?null:JSON.parse(t,void 0),o=null!=(e=n.getItem(t))?e:null;return o instanceof Promise?o.then(r):r(o)},setItem:(t,e)=>n.setItem(t,JSON.stringify(e,void 0)),removeItem:t=>n.removeItem(t)}}const r=t=>e=>{try{const n=t(e);return n instanceof Promise?n:{then:t=>r(t)(n),catch(t){return this}}}catch(n){return{then(t){return this},catch:t=>r(t)(n)}}},o=(t,e)=>(o,s,i)=>{let l={storage:n((()=>localStorage)),partialize:t=>t,version:0,merge:(t,e)=>({...e,...t}),...e},c=!1;const u=new Set,a=new Set;let f=l.storage;if(!f)return t(((...t)=>{o(...t)}),s,i);const v=()=>{const t=l.partialize({...s()});return f.setItem(l.name,{state:t,version:l.version})},d=i.setState;i.setState=(t,e)=>{d(t,e),v()};const h=t(((...t)=>{o(...t),v()}),s,i);let S;i.getInitialState=()=>h;const m=()=>{var t,e;if(!f)return;c=!1,u.forEach((t=>{var e;return t(null!=(e=s())?e:h)}));const n=(null==(e=l.onRehydrateStorage)?void 0:e.call(l,null!=(t=s())?t:h))||void 0;return r(f.getItem.bind(f))(l.name).then((t=>{if(t){if("number"!=typeof t.version||t.version===l.version)return[!1,t.state];if(l.migrate){const e=l.migrate(t.state,t.version);return e instanceof Promise?e.then((t=>[!0,t])):[!0,e]}}return[!1,void 0]})).then((t=>{var e;const[n,r]=t;if(S=l.merge(r,null!=(e=s())?e:h),o(S,!0),n)return v()})).then((()=>{null==n||n(S,void 0),S=s(),c=!0,a.forEach((t=>t(S)))})).catch((t=>{null==n||n(void 0,t)}))};return i.persist={setOptions:t=>{l={...l,...t},t.storage&&(f=t.storage)},clearStorage:()=>{null==f||f.removeItem(l.name)},getOptions:()=>l,rehydrate:()=>m(),hasHydrated:()=>c,onHydrate:t=>(u.add(t),()=>{u.delete(t)}),onFinishHydration:t=>(a.add(t),()=>{a.delete(t)})},l.skipHydration||m(),S||h};export{n as a,e as c,o as p};
