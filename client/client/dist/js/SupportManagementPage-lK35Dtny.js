import{r as e,y as t,j as a,bd as s,be as r,n as i,au as l,f as n,s as c,k as o,an as d,C as m,o as p,T as u}from"./react-core-XCdXHkeW.js";import{b as h,D as x}from"./index-D7IercYq.js";import{u as g}from"./useAsyncAction-DPqA4CQG.js";import{b as y}from"./react-router-G9IXNjIc.js";import{f as b,p as N}from"./utils-BtzqxagS.js";import"./vendor-BcMaAnXF.js";import"./state-QrSTFgAv.js";import"./react-dom-BslC4xag.js";import"./forms-Bk6aQ3xQ.js";const f=new class{async createTicket(e){const t=new FormData;return Object.entries(e).forEach((([e,a])=>{void 0!==a&&"attachments"!==e&&t.append(e,a.toString())})),e.attachments&&e.attachments.forEach((e=>{t.append("attachments",e)})),(await h.post("/support/tickets",t,{headers:{"Content-Type":"multipart/form-data"}})).data}async getTickets(e){return(await h.get("/support/tickets",{params:e})).data}async getTicket(e){return(await h.get(`/support/tickets/${e}`)).data}async updateTicket(e,t){return(await h.put(`/support/tickets/${e}`,t)).data}async addTicketResponse(e,t,a){const s=new FormData;return s.append("message",t),a&&a.forEach((e=>{s.append("attachments",e)})),(await h.post(`/support/tickets/${e}/responses`,s,{headers:{"Content-Type":"multipart/form-data"}})).data}async sendWhatsAppMessage(e,t,a){return(await h.post("/support/whatsapp/send",{phoneNumber:e,message:t,templateName:a})).data}async getWhatsAppTemplates(){return(await h.get("/support/whatsapp/templates")).data}async configureWhatsApp(e){await h.post("/support/whatsapp/configure",e)}async getWhatsAppStatus(){return(await h.get("/support/whatsapp/status")).data}async getFAQs(e,t){return(await h.get("/support/faqs",{params:{category:e,productId:t}})).data}async createFAQ(e){return(await h.post("/support/faqs",e)).data}async updateFAQ(e,t){return(await h.put(`/support/faqs/${e}`,t)).data}async deleteFAQ(e){await h.delete(`/support/faqs/${e}`)}async getSupportAnalytics(e){return(await h.get("/support/analytics",{params:e})).data}async getChatHistory(e,t=50){return(await h.get("/support/chat/history",{params:{userId:e,limit:t}})).data}async saveChatMessage(e){await h.post("/support/chat/messages",e)}},w=({onConfigured:c})=>{const[o,d]=e.useState({connected:!1}),[m,p]=e.useState(!1),[u,h]=e.useState([]),{register:x,handleSubmit:y,formState:{errors:b}}=t(),{execute:N,loading:w}=g((async()=>{const e=await f.getWhatsAppStatus();if(d(e),e.connected){const e=await f.getWhatsAppTemplates();h(e)}})),{execute:v,loading:k}=g((async e=>{await f.configureWhatsApp(e),await N(),p(!1),null==c||c()}));return e.useEffect((()=>{N()}),[]),a.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx(s,{className:"text-green-600",size:24}),a.jsx("h3",{className:"text-lg font-semibold",children:"WhatsApp Business Integration"})]}),a.jsx("button",{onClick:()=>p(!m),className:"text-gray-600 hover:text-gray-900",children:a.jsx(r,{size:20})})]}),a.jsxs("div",{className:"mb-6",children:[a.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[o.connected?a.jsxs(a.Fragment,{children:[a.jsx(i,{className:"text-green-500",size:20}),a.jsx("span",{className:"text-green-700 font-medium",children:"Conectado"})]}):a.jsxs(a.Fragment,{children:[a.jsx(l,{className:"text-red-500",size:20}),a.jsx("span",{className:"text-red-700 font-medium",children:"Desconectado"})]}),a.jsx("button",{onClick:()=>N(),disabled:w,className:"ml-auto text-blue-600 hover:text-blue-700",children:a.jsx(n,{size:16,className:w?"animate-spin":""})})]}),o.connected&&a.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[a.jsxs("p",{children:["N\xfamero: ",o.phoneNumber]}),a.jsxs("p",{children:["Empresa: ",o.businessName]})]})]}),m&&a.jsxs("form",{onSubmit:y((e=>{v(e)})),className:"space-y-4 border-t pt-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Business ID"}),a.jsx("input",{type:"text",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",placeholder:"Ex: 123456789012345",...x("businessId",{required:"Business ID \xe9 obrigat\xf3rio"})}),b.businessId&&a.jsx("p",{className:"text-red-500 text-xs mt-1",children:b.businessId.message})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number ID"}),a.jsx("input",{type:"text",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",placeholder:"Ex: 987654321098765",...x("phoneNumberId",{required:"Phone Number ID \xe9 obrigat\xf3rio"})}),b.phoneNumberId&&a.jsx("p",{className:"text-red-500 text-xs mt-1",children:b.phoneNumberId.message})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Access Token"}),a.jsx("input",{type:"password",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",placeholder:"Token de acesso da API",...x("accessToken",{required:"Access Token \xe9 obrigat\xf3rio"})}),b.accessToken&&a.jsx("p",{className:"text-red-500 text-xs mt-1",children:b.accessToken.message})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Verify Token"}),a.jsx("input",{type:"text",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",placeholder:"Token de verifica\xe7\xe3o do webhook",...x("verifyToken",{required:"Verify Token \xe9 obrigat\xf3rio"})}),b.verifyToken&&a.jsx("p",{className:"text-red-500 text-xs mt-1",children:b.verifyToken.message})]}),a.jsxs("div",{className:"flex space-x-3",children:[a.jsx("button",{type:"submit",disabled:k,className:"flex-1 bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50",children:k?"Salvando...":"Salvar Configura\xe7\xe3o"}),a.jsx("button",{type:"button",onClick:()=>p(!1),className:"flex-1 bg-gray-200 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-300 transition-colors",children:"Cancelar"})]})]}),o.connected&&u.length>0&&!m&&a.jsxs("div",{className:"border-t pt-4",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Templates Dispon\xedveis"}),a.jsx("div",{className:"space-y-2",children:u.map(((e,t)=>a.jsxs("div",{className:"text-sm bg-gray-50 p-2 rounded",children:[a.jsx("p",{className:"font-medium",children:e.name}),a.jsx("p",{className:"text-gray-600 text-xs",children:e.language})]},t)))})]}),a.jsxs("div",{className:"mt-6 bg-blue-50 p-4 rounded-lg",children:[a.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:"Como configurar:"}),a.jsxs("ol",{className:"text-sm text-blue-800 space-y-1 list-decimal list-inside",children:[a.jsx("li",{children:"Acesse o Meta Business Suite"}),a.jsx("li",{children:"V\xe1 para WhatsApp \u2192 Configura\xe7\xf5es da API"}),a.jsx("li",{children:"Copie os IDs e tokens necess\xe1rios"}),a.jsxs("li",{children:["Configure o webhook URL: ",window.location.origin,"/api/whatsapp/webhook"]})]})]})]})},v=()=>{const t=y(),[s,r]=e.useState([]),[n,h]=e.useState([]),[v,k]=e.useState(""),[A,T]=e.useState({status:"all",priority:"all",category:"all"}),[C,j]=e.useState(null),[z,D]=e.useState("tickets"),{execute:I,loading:S}=g((async()=>{const[e,t]=await Promise.all([f.getTickets(),f.getSupportAnalytics()]);r(e),h(e),j(t)}));e.useEffect((()=>{I()}),[]),e.useEffect((()=>{let e=s;v&&(e=e.filter((e=>e.subject.toLowerCase().includes(v.toLowerCase())||e.description.toLowerCase().includes(v.toLowerCase())||e.userEmail.toLowerCase().includes(v.toLowerCase())))),"all"!==A.status&&(e=e.filter((e=>e.status===A.status))),"all"!==A.priority&&(e=e.filter((e=>e.priority===A.priority))),"all"!==A.category&&(e=e.filter((e=>e.category===A.category))),h(e)}),[s,v,A]);const q=e=>{switch(e){case"open":return a.jsx(m,{className:"text-yellow-500",size:16});case"in_progress":return a.jsx(p,{className:"text-blue-500",size:16});case"resolved":return a.jsx(i,{className:"text-green-500",size:16});case"closed":return a.jsx(l,{className:"text-gray-500",size:16});default:return null}},F=e=>{switch(e){case"high":return"text-red-600 bg-red-50";case"medium":return"text-yellow-600 bg-yellow-50";case"low":return"text-green-600 bg-green-50";default:return"text-gray-600 bg-gray-50"}},M={open:"Aberto",in_progress:"Em Andamento",resolved:"Resolvido",closed:"Fechado"},B={authentication:"Autentica\xe7\xe3o",quality:"Qualidade",delivery:"Entrega",warranty:"Garantia",counterfeit:"Falsifica\xe7\xe3o",technical:"T\xe9cnico",other:"Outro"};return a.jsx(x,{children:a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gerenciamento de Suporte"}),a.jsx("p",{className:"text-gray-600 mt-1",children:"Gerencie tickets de suporte e configura\xe7\xf5es de atendimento"})]}),a.jsx("div",{className:"border-b border-gray-200",children:a.jsx("nav",{className:"-mb-px flex space-x-8",children:[{key:"tickets",label:"Tickets",icon:c},{key:"whatsapp",label:"WhatsApp",icon:c},{key:"analytics",label:"Analytics",icon:o}].map((e=>a.jsxs("button",{onClick:()=>D(e.key),className:"py-2 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 "+(z===e.key?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[a.jsx(e.icon,{size:18}),a.jsx("span",{children:e.label})]},e.key)))})}),"tickets"===z&&a.jsxs("div",{children:[a.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border mb-6",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsxs("div",{className:"relative",children:[a.jsx(d,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),a.jsx("input",{type:"text",placeholder:"Buscar tickets...",value:v,onChange:e=>k(e.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),a.jsxs("select",{value:A.status,onChange:e=>T({...A,status:e.target.value}),className:"px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[a.jsx("option",{value:"all",children:"Todos os Status"}),a.jsx("option",{value:"open",children:"Aberto"}),a.jsx("option",{value:"in_progress",children:"Em Andamento"}),a.jsx("option",{value:"resolved",children:"Resolvido"}),a.jsx("option",{value:"closed",children:"Fechado"})]}),a.jsxs("select",{value:A.priority,onChange:e=>T({...A,priority:e.target.value}),className:"px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[a.jsx("option",{value:"all",children:"Todas as Prioridades"}),a.jsx("option",{value:"high",children:"Alta"}),a.jsx("option",{value:"medium",children:"M\xe9dia"}),a.jsx("option",{value:"low",children:"Baixa"})]}),a.jsxs("select",{value:A.category,onChange:e=>T({...A,category:e.target.value}),className:"px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[a.jsx("option",{value:"all",children:"Todas as Categorias"}),Object.entries(B).map((([e,t])=>a.jsx("option",{value:e,children:t},e)))]})]})}),a.jsx("div",{className:"bg-white rounded-lg shadow-sm border overflow-hidden",children:S?a.jsxs("div",{className:"p-8 text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),a.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando tickets..."})]}):0===n.length?a.jsxs("div",{className:"p-8 text-center",children:[a.jsx(c,{className:"mx-auto text-gray-300 mb-4",size:48}),a.jsx("p",{className:"text-gray-500",children:"Nenhum ticket encontrado"})]}):a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ticket"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Usu\xe1rio"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Categoria"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Prioridade"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data"}),a.jsx("th",{className:"relative px-6 py-3",children:a.jsx("span",{className:"sr-only",children:"A\xe7\xf5es"})})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:n.map((e=>a.jsxs("tr",{className:"hover:bg-gray-50",children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{children:[a.jsxs("p",{className:"text-sm font-medium text-gray-900",children:["#",e.id.slice(0,8)]}),a.jsx("p",{className:"text-sm text-gray-500 truncate max-w-xs",children:e.subject})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-900",children:e.userName||"An\xf4nimo"}),a.jsx("p",{className:"text-sm text-gray-500",children:e.userEmail})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsx("span",{className:"text-sm text-gray-900",children:B[e.category]||e.category})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${F(e.priority)}`,children:"high"===e.priority?"Alta":"medium"===e.priority?"M\xe9dia":"Baixa"})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"flex items-center space-x-2",children:[q(e.status),a.jsx("span",{className:"text-sm text-gray-900",children:M[e.status]})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:b(new Date(e.createdAt),"dd/MM/yyyy HH:mm",{locale:N})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:a.jsx("button",{onClick:()=>t(`/admin/support/tickets/${e.id}`),className:"text-blue-600 hover:text-blue-900",children:"Ver detalhes"})})]},e.id)))})]})})]}),"whatsapp"===z&&a.jsx("div",{className:"max-w-4xl",children:a.jsx(w,{onConfigured:I})}),"analytics"===z&&C&&a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Total de Tickets"}),a.jsx(c,{className:"text-gray-400",size:20})]}),a.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:C.totalTickets}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Todos os tempos"})]}),a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Tickets Abertos"}),a.jsx(m,{className:"text-yellow-400",size:20})]}),a.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:C.openTickets}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Aguardando resposta"})]}),a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Tempo de Resposta"}),a.jsx(p,{className:"text-blue-400",size:20})]}),a.jsxs("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:[C.avgResponseTime,"h"]}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"M\xe9dia"})]}),a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Satisfa\xe7\xe3o"}),a.jsx(u,{className:"text-green-400",size:20})]}),a.jsxs("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:[C.satisfactionRate,"%"]}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Taxa de satisfa\xe7\xe3o"})]})]})]})})};export{v as default};
