import{r as e,j as a,i as t,C as r,e as l,m as s,av as i}from"./react-core-XCdXHkeW.js";import{p as n}from"./productService-CHIPryK1.js";import{h as o,t as c}from"./index-D7IercYq.js";import{a4 as d}from"./vendor-BcMaAnXF.js";import{N as m,C as u}from"./ClaimsValidator-D1SNUT0e.js";import{b as h}from"./react-router-G9IXNjIc.js";import"./state-QrSTFgAv.js";import"./react-dom-BslC4xag.js";import"./utils-BtzqxagS.js";import"./forms-Bk6aQ3xQ.js";import"./useAsyncAction-DPqA4CQG.js";const p=e=>d.sanitize(e,{ALLOWED_TAGS:["b","i","em","strong","a","p","br"],ALLOWED_ATTR:["href","target"]}),x=e=>!(e.length<3||e.length>50)&&/^[A-Za-z0-9_-]+$/.test(e),g=e.forwardRef((({label:l,error:s,helperText:i,validate:n,sanitize:c=!0,showValidIcon:m=!1,onValidatedChange:u,onChange:h,onBlur:p,value:x,className:g,required:b,...N},v)=>{const[f,y]=e.useState(""),[w,C]=e.useState(!1),[I,S]=e.useState(!1),A=s||f;return e.useEffect((()=>{if(n&&x&&I){const e=n(String(x));"string"==typeof e?(y(e),C(!1)):(y(""),C(e))}}),[x,n,I]),a.jsxs("div",{className:"space-y-1",children:[l&&a.jsxs("label",{className:"block text-sm font-medium text-neutral-700 transition-colors duration-200 hover:text-neutral-900",children:[l,b&&a.jsx("span",{className:"text-error-500 ml-1",children:"*"})]}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{ref:v,value:x,onChange:e=>{let a=e.target.value;var t;if(c&&a&&(t=a,a=d.sanitize(t,{ALLOWED_TAGS:[]}),e.target.value=a),n&&I){const e=n(a);"string"==typeof e?(y(e),C(!1)):(y(""),C(e))}null==h||h(e),null==u||u(a,w)},onBlur:e=>{if(S(!0),n&&e.target.value){const a=n(e.target.value);"string"==typeof a?(y(a),C(!1)):(y(""),C(a))}null==p||p(e)},className:o("input",A&&"input-error",w&&I&&!A&&"input-success",w&&m&&"pr-10",g),required:b,"aria-invalid":!!A,"aria-describedby":A?`${N.id}-error`:i?`${N.id}-helper`:void 0,...N}),m&&w&&I&&!A&&a.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:a.jsx(t,{className:"h-5 w-5 text-success-500 animate-scale-in"})}),A&&a.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:a.jsx(r,{className:"h-5 w-5 text-error-500 animate-scale-in"})})]}),A&&a.jsx("p",{id:`${N.id}-error`,className:"text-sm text-error-600 animate-slide-down",role:"alert",children:A}),i&&!A&&a.jsx("p",{id:`${N.id}-helper`,className:"text-sm text-neutral-500",children:i})]})}));g.displayName="ValidatedInput";const b=()=>{const t=h(),[o,d]=e.useState(!1),[b,N]=e.useState(!1),[v,f]=e.useState(null),[y,w]=e.useState([]),[C,I]=e.useState([]),[S,A]=e.useState({name:"",brand:"",category:"",sku:"",description:"",claims:"",nutritionalInfo:"",imageUrl:""}),j=e=>{const{name:a,value:t}=e.target;A((e=>({...e,[a]:t})))};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsxs("button",{onClick:()=>t("/dashboard/products"),className:"btn btn-outline btn-sm flex items-center",children:[a.jsx(l,{className:"h-4 w-4 mr-2"}),"Voltar"]}),a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Novo Produto"})]}),a.jsxs("form",{onSubmit:async e=>{var a,r,l;if(e.preventDefault(),S.name&&S.brand&&S.category&&S.sku)if(x(S.sku))try{d(!0);const e={...S,description:p(S.description),nutritionalInfo:p(S.nutritionalInfo)};let a=null;if(e.nutritionalInfo.trim())try{a=JSON.parse(e.nutritionalInfo)}catch(s){return void c.error("Formato JSON inv\xe1lido nas informa\xe7\xf5es nutricionais")}const r={...e,nutritionalInfo:a};await n.createProduct(r),c.success("Produto criado com sucesso!"),t("/dashboard/products")}catch(i){400===(null==(a=i.response)?void 0:a.status)?c.error("Dados inv\xe1lidos. Verifique os campos."):409===(null==(r=i.response)?void 0:r.status)?c.error("SKU j\xe1 existe. Use um SKU \xfanico."):401===(null==(l=i.response)?void 0:l.status)?c.error("Sess\xe3o expirada. Fa\xe7a login novamente."):c.error("Erro ao criar produto. Tente novamente.")}finally{d(!1)}else c.error("SKU inv\xe1lido");else c.error("Preencha todos os campos obrigat\xf3rios")},className:"space-y-6",children:[a.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Informa\xe7\xf5es B\xe1sicas"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsx(g,{id:"name",name:"name",label:"Nome do Produto",required:!0,value:S.name,onChange:j,placeholder:"Ex: Whey Protein Premium",validate:e=>e.length<3?"Nome deve ter pelo menos 3 caracteres":!(e.length>100)||"Nome deve ter no m\xe1ximo 100 caracteres",showValidIcon:!0}),a.jsx(g,{id:"brand",name:"brand",label:"Marca",required:!0,value:S.brand,onChange:j,placeholder:"Ex: NutriMax",validate:e=>e.length<2?"Marca deve ter pelo menos 2 caracteres":!(e.length>50)||"Marca deve ter no m\xe1ximo 50 caracteres",showValidIcon:!0}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"category",className:"block text-sm font-medium text-gray-700 mb-2",children:"Categoria *"}),a.jsxs("select",{id:"category",name:"category",required:!0,value:S.category,onChange:j,className:"input w-full",children:[a.jsx("option",{value:"",children:"Selecione uma categoria"}),["Alimentos","Bebidas","Suplementos","Cosm\xe9ticos","Higiene Pessoal","Produtos Naturais","Outros"].map((e=>a.jsx("option",{value:e,children:e},e)))]})]}),a.jsx(g,{id:"sku",name:"sku",label:"SKU",required:!0,value:S.sku,onChange:j,placeholder:"Ex: WP-001-VAN",validate:e=>!!x(e)||"SKU deve conter apenas letras, n\xfameros, h\xedfens e underscores (3-50 caracteres)",showValidIcon:!0})]}),a.jsxs("div",{className:"mt-6",children:[a.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-2",children:"Descri\xe7\xe3o"}),a.jsx("textarea",{id:"description",name:"description",rows:4,value:S.description,onChange:j,className:"input w-full",placeholder:"Descreva o produto, seus benef\xedcios e caracter\xedsticas..."})]}),a.jsxs("div",{className:"mt-6",children:[a.jsx("label",{htmlFor:"imageUrl",className:"block text-sm font-medium text-gray-700 mb-2",children:"URL da Imagem"}),a.jsx("input",{type:"url",id:"imageUrl",name:"imageUrl",value:S.imageUrl,onChange:j,className:"input w-full",placeholder:"https://exemplo.com/imagem-produto.jpg"})]})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Informa\xe7\xf5es Nutricionais"}),a.jsxs("button",{type:"button",onClick:()=>N(!b),className:"btn-outline text-sm flex items-center",children:[a.jsx(s,{className:"h-4 w-4 mr-2"}),b?"Editor Simples":"Editor Avan\xe7ado"]})]}),b?a.jsxs(a.Fragment,{children:[a.jsx(m,{initialData:v||void 0,onChange:e=>{f(e),A((a=>({...a,nutritionalInfo:JSON.stringify(e,null,2)})))},onValidate:e=>{w(e)},targetMarket:"BRAZIL"}),y.length>0&&a.jsx("div",{className:"mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:a.jsxs("div",{className:"flex items-start",children:[a.jsx(r,{className:"h-5 w-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0"}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-medium text-yellow-800 mb-2",children:"Avisos de Valida\xe7\xe3o"}),a.jsx("ul",{className:"text-sm text-yellow-700 space-y-1",children:y.map(((e,t)=>a.jsxs("li",{className:"flex items-start",children:[a.jsx("span",{className:"text-yellow-600 mr-2",children:"\u2022"}),e.message]},t)))})]})]})})]}):a.jsxs("div",{children:[a.jsx("label",{htmlFor:"nutritionalInfo",className:"block text-sm font-medium text-gray-700 mb-2",children:"Informa\xe7\xf5es Nutricionais (JSON)"}),a.jsx("textarea",{id:"nutritionalInfo",name:"nutritionalInfo",rows:6,value:S.nutritionalInfo,onChange:j,className:"input w-full font-mono text-sm",placeholder:'{\n  "calorias": "120 kcal",\n  "proteinas": "25g",\n  "carboidratos": "2g",\n  "gorduras": "1g",\n  "fibras": "0g",\n  "sodio": "50mg"\n}'}),a.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Formato JSON v\xe1lido. Deixe em branco se n\xe3o aplic\xe1vel."})]})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Claims e Alega\xe7\xf5es"}),b&&v?a.jsx(u,{nutritionFacts:v,initialClaims:S.claims.split(",").map((e=>e.trim())).filter(Boolean),onChange:e=>{A((a=>({...a,claims:e.join(", ")})))},onValidation:e=>{I(e)},targetMarket:"BRAZIL"}):a.jsxs("div",{children:[a.jsx("label",{htmlFor:"claims",className:"block text-sm font-medium text-gray-700 mb-2",children:"Claims do Produto"}),a.jsx("textarea",{id:"claims",name:"claims",rows:4,value:S.claims,onChange:j,className:"input w-full",placeholder:"Ex: Rico em prote\xednas, Sem a\xe7\xfacar adicionado, Fonte de vitaminas..."}),a.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Separe m\xfaltiplos claims por v\xedrgula"})]}),b&&C.length>0&&a.jsxs("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Status de Conformidade"}),a.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-2xl font-bold text-green-600",children:C.filter((e=>"VALID"===e.status)).length}),a.jsx("p",{className:"text-xs text-gray-600",children:"V\xe1lidas"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:C.filter((e=>"WARNING"===e.status)).length}),a.jsx("p",{className:"text-xs text-gray-600",children:"Avisos"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-2xl font-bold text-red-600",children:C.filter((e=>"INVALID"===e.status)).length}),a.jsx("p",{className:"text-xs text-gray-600",children:"Inv\xe1lidas"})]})]})]})]}),a.jsxs("div",{className:"flex justify-end space-x-4",children:[a.jsx("button",{type:"button",onClick:()=>t("/dashboard/products"),className:"btn btn-secondary",disabled:o,children:"Cancelar"}),a.jsx("button",{type:"submit",className:"btn btn-primary",disabled:o,children:o?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"loading-spinner w-4 h-4 mr-2"}),"Criando..."]}):a.jsxs(a.Fragment,{children:[a.jsx(i,{className:"w-4 h-4 mr-2"}),"Criar Produto"]})})]})]})]})};export{b as default};
