import{c as e,j as s,d as a,R as t,C as l,O as r}from"./index-DeKtUJAc.js";import{r as i,e as d}from"./vendor-BDxjXY-2.js";import{v as n,r as c}from"./validationService-DFgyIoZu.js";import{p as o}from"./productService-DtNiporo.js";import{V as x}from"./ValidationQueue-DE28fGK8.js";import{P as m}from"./plus-DeicFfk_.js";import{U as h}from"./users-CICDFuQM.js";import{F as u}from"./funnel-BfqhAz3v.js";import{C as p}from"./circle-x-DPkhpEGr.js";import{T as j}from"./triangle-alert-CiFJGrB3.js";import{B as g}from"./bot-BfCmKRaZ.js";import{E as N}from"./eye-CKGr823U.js";import"./charts-C38Ohhsz.js";import"./fallbackService-D-6NybDe.js";import"./qrService-BZ_OVWnh.js";
/**
 * @license lucide-react v0.513.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b=e("chart-no-axes-column",[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]]),y=e("list",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]),v=()=>{const[e,c]=i.useState([]),[o,v]=i.useState(!0),[w,A]=i.useState("all"),[R,E]=i.useState(!1),[P,T]=i.useState("list"),[k,D]=i.useState([]),[S,I]=i.useState(null),O=d(),C=async()=>{try{v(!0);const e={limit:100};"all"!==w&&(e.status=w);const s=await n.getValidations(e);c(s.data)}catch(e){r.error("Erro ao carregar validações")}finally{v(!1)}},V=async()=>{try{const e=await n.getValidationQueue();D(e.data||[])}catch(e){}};i.useEffect((()=>{C(),V(),(async()=>{try{const e=await n.getValidationMetrics();I(e.data)}catch(e){}})()}),[w]),i.useEffect((()=>{const e=setInterval((()=>{"queue"===P&&V()}),3e4);return()=>clearInterval(e)}),[P]);const M=e=>{switch(e){case"APPROVED":return s.jsx(l,{className:"w-5 h-5 text-green-500"});case"REJECTED":return s.jsx(p,{className:"w-5 h-5 text-red-500"});case"PARTIAL":return s.jsx(j,{className:"w-5 h-5 text-orange-500"});case"IN_PROGRESS":return s.jsx(t,{className:"w-5 h-5 text-blue-500 animate-spin"});default:return s.jsx(a,{className:"w-5 h-5 text-yellow-500"})}},L=e=>{switch(e){case"APPROVED":return"bg-green-100 text-green-800";case"REJECTED":return"bg-red-100 text-red-800";case"PARTIAL":return"bg-orange-100 text-orange-800";case"IN_PROGRESS":return"bg-blue-100 text-blue-800";default:return"bg-yellow-100 text-yellow-800"}};return o?s.jsx("div",{className:"flex items-center justify-center min-h-screen",children:s.jsx("div",{className:"loading-spinner w-8 h-8"})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Validações"}),s.jsx("p",{className:"text-gray-600",children:"Gerencie validações de produtos"})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("button",{onClick:()=>O("/admin/validations/queue"),className:"btn btn-secondary",children:[s.jsx(y,{className:"w-4 h-4 mr-2"}),"Fila"]}),s.jsxs("button",{onClick:()=>E(!0),className:"btn btn-primary",children:[s.jsx(m,{className:"w-4 h-4 mr-2"}),"Nova Validação"]})]})]}),s.jsx("div",{className:"border-b border-gray-200",children:s.jsxs("nav",{className:"-mb-px flex space-x-8",children:[s.jsxs("button",{onClick:()=>T("list"),className:"py-2 px-1 border-b-2 font-medium text-sm "+("list"===P?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[s.jsx(h,{className:"w-4 h-4 inline-block mr-2"}),"Lista de Validações"]}),s.jsxs("button",{onClick:()=>T("queue"),className:"py-2 px-1 border-b-2 font-medium text-sm "+("queue"===P?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[s.jsx(y,{className:"w-4 h-4 inline-block mr-2"}),"Fila de Processamento",k.filter((e=>"QUEUED"===e.status||"PROCESSING"===e.status)).length>0&&s.jsx("span",{className:"ml-2 inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:k.filter((e=>"QUEUED"===e.status||"PROCESSING"===e.status)).length})]}),s.jsxs("button",{onClick:()=>T("metrics"),className:"py-2 px-1 border-b-2 font-medium text-sm "+("metrics"===P?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[s.jsx(b,{className:"w-4 h-4 inline-block mr-2"}),"Métricas e Análises"]})]})}),"list"===P&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx(u,{className:"w-4 h-4 text-gray-400"}),s.jsxs("select",{value:w,onChange:e=>A(e.target.value),className:"input w-48",children:[s.jsx("option",{value:"all",children:"Todos os status"}),s.jsx("option",{value:"PENDING",children:"Pendentes"}),s.jsx("option",{value:"IN_PROGRESS",children:"Em Processamento"}),s.jsx("option",{value:"APPROVED",children:"Aprovados"}),s.jsx("option",{value:"REJECTED",children:"Rejeitados"}),s.jsx("option",{value:"PARTIAL",children:"Parciais"})]})]})}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-6",children:[s.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(a,{className:"w-8 h-8 text-yellow-600 mr-3"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Pendentes"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:e.filter((e=>"PENDING"===e.status)).length})]})]})}),s.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(t,{className:"w-8 h-8 text-blue-600 mr-3"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Processando"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:e.filter((e=>"IN_PROGRESS"===e.status)).length})]})]})}),s.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(l,{className:"w-8 h-8 text-green-600 mr-3"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Aprovados"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:e.filter((e=>"APPROVED"===e.status)).length})]})]})}),s.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(p,{className:"w-8 h-8 text-red-600 mr-3"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Rejeitados"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:e.filter((e=>"REJECTED"===e.status)).length})]})]})}),s.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(j,{className:"w-8 h-8 text-orange-600 mr-3"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Parciais"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:e.filter((e=>"PARTIAL"===e.status)).length})]})]})})]}),s.jsx("div",{className:"bg-white rounded-lg shadow-sm border overflow-hidden",children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Produto"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tipo"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Confiança"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Validador"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ações"})]})}),s.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:e.map((e=>{var a,t,l,r,i;return s.jsxs("tr",{className:"hover:bg-gray-50",children:[s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-gray-900",children:null==(a=e.product)?void 0:a.name}),s.jsxs("div",{className:"text-sm text-gray-500",children:[null==(t=e.product)?void 0:t.brand," • ",null==(l=e.product)?void 0:l.sku]})]})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsxs("div",{className:"flex items-center",children:["AUTOMATED"===e.type&&s.jsx(g,{className:"w-4 h-4 text-blue-600 mr-2"}),s.jsxs("span",{className:"text-sm text-gray-900",children:["AUTOMATED"===e.type&&"Automatizada","MANUAL"===e.type&&"Manual","LABORATORY"===e.type&&"Laboratorial","HYBRID"===e.type&&"Híbrida"]})]})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsxs("div",{className:"flex items-center",children:[M(e.status),s.jsxs("span",{className:`ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${L(e.status)}`,children:["APPROVED"===e.status&&"Aprovado","REJECTED"===e.status&&"Rejeitado","PARTIAL"===e.status&&"Parcial","PENDING"===e.status&&"Pendente","IN_PROGRESS"===e.status&&"Processando"]})]})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:void 0!==e.confidence&&s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2 mr-2",children:s.jsx("div",{className:"h-2 rounded-full "+(e.confidence>=80?"bg-green-600":e.confidence>=60?"bg-yellow-600":"bg-red-600"),style:{width:`${e.confidence}%`}})}),s.jsxs("span",{className:"text-sm text-gray-600",children:[e.confidence,"%"]})]})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(null==(r=e.user)?void 0:r.name)||"Sistema"}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(i=e.createdAt,new Date(i).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}))}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:s.jsx("button",{onClick:()=>O(`/admin/validations/${e.id}/review`),className:"text-blue-600 hover:text-blue-900",title:"Ver detalhes",children:s.jsx(N,{className:"w-4 h-4"})})})]},e.id)}))})]})})}),0===e.length&&!o&&s.jsxs("div",{className:"text-center py-12",children:[s.jsx(l,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nenhuma validação encontrada"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"all"!==w?"Tente ajustar os filtros de busca":"Comece criando a primeira validação"}),"all"===w&&s.jsxs("button",{onClick:()=>E(!0),className:"btn btn-primary",children:[s.jsx(m,{className:"w-4 h-4 mr-2"}),"Nova Validação"]})]})]}),"queue"===P&&s.jsx(x,{queue:k,onRefresh:V}),"metrics"===P&&S&&s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Métricas de Automação"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Taxa de Automação"}),s.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[S.automatedPercentage.toFixed(1),"%"]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Tempo Médio de Processamento"}),s.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[(S.averageProcessingTime/1e3).toFixed(1),"s"]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Taxa de Precisão"}),s.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[S.accuracyRate.toFixed(1),"%"]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Taxa de Revalidação"}),s.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[S.revalidationRate.toFixed(1),"%"]})]})]})]}),s.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Distribuição por Tipo"}),s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Object.entries(S.byType).map((([e,a])=>s.jsxs("div",{className:"text-center",children:[s.jsxs("p",{className:"text-sm text-gray-600",children:["AUTOMATED"===e&&"Automatizada","MANUAL"===e&&"Manual","LABORATORY"===e&&"Laboratorial","HYBRID"===e&&"Híbrida"]}),s.jsx("p",{className:"text-xl font-bold text-gray-900",children:a})]},e)))})]}),s.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Tendência dos Últimos 30 Dias"}),s.jsx("div",{className:"space-y-2",children:S.trendsLast30Days.map(((e,a)=>s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm text-gray-600",children:e.date}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("span",{className:"text-sm",children:[s.jsx(g,{className:"w-4 h-4 inline text-blue-600 mr-1"}),e.automated]}),s.jsxs("span",{className:"text-sm",children:[s.jsx(h,{className:"w-4 h-4 inline text-gray-600 mr-1"}),e.manual]}),s.jsxs("span",{className:"text-sm font-medium",children:["Total: ",e.total]})]})]},a)))})]})]}),R&&s.jsx(f,{onClose:()=>E(!1),onSuccess:()=>{E(!1),C()}})]})},f=({onClose:e,onSuccess:a})=>{const[t,l]=i.useState({productId:"",reportId:"",type:"MANUAL",status:"APPROVED",claimsValidated:{},summary:"",notes:"",useAutomation:!1}),[d,x]=i.useState([]),[m,h]=i.useState([]),[u,p]=i.useState(!1);i.useEffect((()=>{(async()=>{try{const[e,s]=await Promise.all([o.getProducts({limit:100}),c.getReports({limit:100})]);x(e.data),h(s.data)}catch(e){}})()}),[]);return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[s.jsx("h2",{className:"text-xl font-bold mb-4",children:"Nova Validação"}),s.jsxs("form",{onSubmit:async e=>{var s,l,i,d;e.preventDefault(),p(!0);try{const e={...t,claimsValidated:t.claimsValidated||{}};await n.createValidation(e),r.success("Validação criada com sucesso!"),a()}catch(c){const e=(null==(l=null==(s=c.response)?void 0:s.data)?void 0:l.error)||(null==(d=null==(i=c.response)?void 0:i.data)?void 0:d.message)||"Erro ao criar validação";r.error(e)}finally{p(!1)}},className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Produto *"}),s.jsxs("select",{value:t.productId,onChange:e=>l((s=>({...s,productId:e.target.value}))),className:"input w-full",required:!0,children:[s.jsx("option",{value:"",children:"Selecione um produto"}),d.map((e=>s.jsxs("option",{value:e.id,children:[e.name," - ",e.brand]},e.id)))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Validação *"}),s.jsxs("select",{value:t.type,onChange:e=>l((s=>({...s,type:e.target.value,reportId:"MANUAL"===e.target.value?"":s.reportId}))),className:"input w-full",required:!0,children:[s.jsx("option",{value:"MANUAL",children:"Manual (sem relatório)"}),s.jsx("option",{value:"LABORATORY",children:"Laboratorial (com relatório)"}),s.jsx("option",{value:"AUTOMATED",children:"Automatizada (IA)"}),s.jsx("option",{value:"HYBRID",children:"Híbrida (IA + Revisão)"})]})]}),("AUTOMATED"===t.type||"HYBRID"===t.type)&&s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx(g,{className:"w-5 h-5 text-blue-600 mr-2 mt-0.5"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm font-medium text-blue-900",children:"Validação Automatizada"}),s.jsxs("p",{className:"text-sm text-blue-700 mt-1",children:["O sistema irá analisar automaticamente o relatório usando IA para extrair e validar os dados.","HYBRID"===t.type&&" Os resultados serão revisados antes da aprovação final."]})]})]})}),("LABORATORY"===t.type||"AUTOMATED"===t.type||"HYBRID"===t.type)&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Relatório *"}),s.jsxs("select",{value:t.reportId,onChange:e=>l((s=>({...s,reportId:e.target.value}))),className:"input w-full",required:"MANUAL"!==t.type,children:[s.jsx("option",{value:"",children:"Selecione um relatório"}),m.map((e=>{var a;return s.jsxs("option",{value:e.id,children:[e.originalName," - ",null==(a=e.laboratory)?void 0:a.name]},e.id)}))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status *"}),s.jsxs("select",{value:t.status,onChange:e=>l((s=>({...s,status:e.target.value}))),className:"input w-full",required:!0,children:[s.jsx("option",{value:"PENDING",children:"Pendente"}),s.jsx("option",{value:"APPROVED",children:"Aprovado"}),s.jsx("option",{value:"REJECTED",children:"Rejeitado"}),s.jsx("option",{value:"PARTIAL",children:"Parcial"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Resumo"}),s.jsx("textarea",{value:t.summary,onChange:e=>l((s=>({...s,summary:e.target.value}))),className:"input w-full",rows:3,placeholder:"Resumo da validação..."})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Observações"}),s.jsx("textarea",{value:t.notes,onChange:e=>l((s=>({...s,notes:e.target.value}))),className:"input w-full",rows:3,placeholder:"Observações adicionais..."})]}),s.jsxs("div",{className:"flex space-x-3 pt-4",children:[s.jsx("button",{type:"button",onClick:e,className:"btn btn-secondary flex-1",disabled:u,children:"Cancelar"}),s.jsx("button",{type:"submit",className:"btn btn-primary flex-1",disabled:u,children:u?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"loading-spinner w-4 h-4 mr-2"}),"Criando..."]}):"Criar Validação"})]})]})]})})};export{v as ValidationsPage,v as default};
