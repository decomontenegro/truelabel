import{O as e,j as s,L as t,J as a}from"./index-DeKtUJAc.js";import{i as r,e as i,r as c}from"./vendor-BDxjXY-2.js";import{q as d}from"./qrService-BZ_OVWnh.js";import{p as l}from"./productService-DtNiporo.js";import{D as o}from"./download-B9M2FoM6.js";import{E as n}from"./eye-CKGr823U.js";import{C as x}from"./calendar-DT4riflN.js";import{T as m}from"./trending-up-B5q99a19.js";import{S as h}from"./smartphone-CejEQKCi.js";import{M as p}from"./map-pin-CYFbGecx.js";import"./charts-C38Ohhsz.js";const j=()=>{const{productId:j}=r(),g=i(),[N,u]=c.useState(null),[y,f]=c.useState([]),[w,b]=c.useState({total:0,today:0,thisWeek:0,thisMonth:0}),[v,k]=c.useState(!0);c.useEffect((()=>{j&&A()}),[j]);const A=async()=>{var s;if(j)try{k(!0);const e=await l.getProduct(j);u(e.product);try{const e=await d.getQRCodeAccesses(j);f(e.accesses||[]),b(e.statistics||w)}catch(t){if(404!==(null==(s=t.response)?void 0:s.status))throw t;f([]),b({total:0,today:0,thisWeek:0,thisMonth:0})}}catch(t){e.error("Erro ao carregar dados de analytics")}finally{k(!1)}},C=e=>new Date(e).toLocaleString("pt-BR"),S=e=>e.includes("Mobile")?"Mobile":e.includes("Tablet")?"Tablet":"Desktop",R=e=>e.includes("Chrome")?"Chrome":e.includes("Firefox")?"Firefox":e.includes("Safari")?"Safari":e.includes("Edge")?"Edge":"Outro";return v?s.jsx("div",{className:"flex justify-center items-center h-64",children:s.jsx(t,{size:"lg"})}):N?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx("button",{onClick:()=>g("/dashboard/qr-codes"),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:s.jsx(a,{className:"w-5 h-5"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Analytics do QR Code"}),s.jsxs("p",{className:"text-gray-600",children:[N.name," - ",N.sku]})]})]}),s.jsx("div",{className:"flex space-x-3",children:s.jsxs("button",{onClick:()=>{const s=[["Data/Hora","IP","Dispositivo","Navegador","Localização"],...y.map((e=>[C(e.accessedAt),e.ipAddress,S(e.userAgent),R(e.userAgent),e.location||"N/A"]))].map((e=>e.join(","))).join("\n"),t=new Blob([s],{type:"text/csv"}),a=window.URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download=`analytics-${(null==N?void 0:N.name)||"produto"}-${(new Date).toISOString().split("T")[0]}.csv`,r.click(),window.URL.revokeObjectURL(a),e.success("Dados exportados com sucesso!")},className:"btn btn-outline flex items-center",children:[s.jsx(o,{className:"w-4 h-4 mr-2"}),"Exportar"]})})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[s.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(n,{className:"w-8 h-8 text-blue-600 mr-3"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Total de Acessos"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:w.total})]})]})}),s.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(x,{className:"w-8 h-8 text-green-600 mr-3"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Hoje"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:w.today})]})]})}),s.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(m,{className:"w-8 h-8 text-purple-600 mr-3"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Esta Semana"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:w.thisWeek})]})]})}),s.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(h,{className:"w-8 h-8 text-orange-600 mr-3"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Este Mês"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:w.thisMonth})]})]})})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Informações do QR Code"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Código QR"}),s.jsx("p",{className:"font-mono text-sm bg-gray-50 p-2 rounded",children:N.qrCode})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-gray-600",children:"URL de Validação"}),s.jsx("p",{className:"text-sm bg-gray-50 p-2 rounded break-all",children:`${window.location.origin}/validation/${N.qrCode}`})]})]})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow-sm border",children:[s.jsx("div",{className:"p-6 border-b",children:s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Histórico de Acessos"})}),0===y.length?s.jsxs("div",{className:"p-12 text-center",children:[s.jsx(n,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),s.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nenhum acesso registrado"}),s.jsx("p",{className:"text-gray-600",children:"O QR Code ainda não foi escaneado por nenhum usuário."})]}):s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data/Hora"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"IP"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Dispositivo"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Navegador"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Localização"})]})}),s.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:y.map((e=>s.jsxs("tr",{className:"hover:bg-gray-50",children:[s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:C(e.accessedAt)}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-600",children:e.ipAddress}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(h,{className:"w-4 h-4 mr-2 text-gray-400"}),S(e.userAgent)]})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:R(e.userAgent)}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(p,{className:"w-4 h-4 mr-2 text-gray-400"}),e.location||"N/A"]})})]},e.id)))})]})})]})]}):s.jsxs("div",{className:"text-center py-12",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Produto não encontrado"}),s.jsx("button",{onClick:()=>g("/dashboard/qr-codes"),className:"btn btn-primary",children:"Voltar para QR Codes"})]})};export{j as default};
