import{M as e,Y as s,j as a,N as t,T as l,X as r,b as i,C as d,Z as c,d as n}from"./index-DVDeh87x.js";import{i as o,e as m,r as x}from"./vendor-BDxjXY-2.js";import{v as h}from"./validationService-Cq-h27RQ.js";import{c as g}from"./certificationService-I2yBLTx2.js";import{C as j}from"./circle-x-DtLsNPzF.js";import{T as u}from"./triangle-alert-COMyvNYA.js";import{S as p}from"./shield-Ca2y9FOx.js";import"./charts-C38Ohhsz.js";import"./fallbackService-D-6NybDe.js";import"./qrService-c0XzpkI8.js";const N=()=>{var N,v,b,y,f,w;const{id:E}=o(),D=m(),[A,P]=x.useState(null),[R,V]=x.useState(null),[C,S]=x.useState([]),[O,T]=x.useState(!0),[k,I]=x.useState(!1),[L,J]=x.useState({});x.useEffect((()=>{E&&q()}),[E]);const q=async()=>{var a,t;if(E)try{T(!0);const s=await h.getValidation(E);if(P(s.validation),null==(a=s.validation)?void 0:a.productId)try{const a=await e.getProduct(s.validation.productId);if(V(a.product),null==(t=a.product)?void 0:t.claims){const e="string"==typeof a.product.claims?a.product.claims.split(",").map((e=>e.trim())):Object.keys(a.product.claims),t={};e.forEach((e=>{var a,l;t[e]=(null==(l=null==(a=s.validation)?void 0:a.claimsValidated)?void 0:l[e])?"APPROVED":"PENDING"})),J(t)}try{const e=await g.getProductCertifications(s.validation.productId);S(e)}catch(l){}}catch(r){}}catch(i){s.error("Erro ao carregar validação"),D("/dashboard/validations")}finally{T(!1)}},B=(e,s)=>{J((a=>({...a,[e]:s})))},G=async e=>{if(E&&A){I(!0);try{const a={};Object.entries(L).forEach((([e,s])=>{"APPROVED"===s&&(a[e]=!0)}));const t=await h.updateValidation(E,{status:e,claimsValidated:a});P(t.validation),s.success(`Validação ${"APPROVED"===e?"aprovada":"rejeitada"} com sucesso!`)}catch(a){s.error("Erro ao atualizar status")}finally{I(!1)}}},M=e=>e?"string"==typeof e?e.split(",").map((e=>e.trim())).filter((e=>e.length>0)):"object"==typeof e?Object.keys(e):[]:[];return O?a.jsx("div",{className:"flex items-center justify-center min-h-64",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),a.jsx("p",{className:"mt-2 text-gray-600",children:"Carregando validação..."})]})}):A?a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("button",{onClick:()=>D("/dashboard/validations"),className:"mr-4 p-2 hover:bg-gray-100 rounded-lg transition-colors",children:a.jsx(t,{className:"w-5 h-5"})}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Revisar Validação"}),a.jsxs("p",{className:"text-gray-600 mt-1",children:[(null==(N=A.product)?void 0:N.name)||"Produto"," - ",(null==(v=A.product)?void 0:v.brand)||"Marca"]})]})]}),a.jsxs("div",{className:"flex items-center gap-3",children:["APPROVED"!==A.status&&a.jsxs("button",{onClick:()=>G("APPROVED"),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 transition-colors",disabled:k,children:[a.jsx(l,{className:"w-4 h-4 mr-1 inline"}),"Aprovar"]}),"REJECTED"!==A.status&&a.jsxs("button",{onClick:()=>G("REJECTED"),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 transition-colors",disabled:k,children:[a.jsx(r,{className:"w-4 h-4 mr-1 inline"}),"Rejeitar"]})]})]})}),a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Status da Validação"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Status Atual"}),a.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium mt-1 "+("APPROVED"===A.status?"bg-green-100 text-green-800":"REJECTED"===A.status?"bg-red-100 text-red-800":"PENDING"===A.status?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"),children:"APPROVED"===A.status?"Aprovado":"REJECTED"===A.status?"Rejeitado":"PENDING"===A.status?"Pendente":A.status})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Tipo de Validação"}),a.jsx("p",{className:"text-gray-900 mt-1",children:A.type||"MANUAL"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Data de Criação"}),a.jsx("p",{className:"text-gray-900 mt-1",children:new Date(A.createdAt).toLocaleDateString("pt-BR")})]})]}),A.validatedAt&&a.jsx("div",{className:"mt-4 p-3 bg-green-50 rounded-lg",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(l,{className:"w-5 h-5 text-green-600 mr-2"}),a.jsxs("span",{className:"text-sm text-green-800",children:["Validado em ",new Date(A.validatedAt).toLocaleDateString("pt-BR")," às ",new Date(A.validatedAt).toLocaleTimeString("pt-BR")]})]})})]}),a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Informações do Produto"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Nome do Produto"}),a.jsx("p",{className:"text-gray-900 font-medium",children:(null==(b=A.product)?void 0:b.name)||"N/A"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Marca"}),a.jsx("p",{className:"text-gray-900 font-medium",children:(null==(y=A.product)?void 0:y.brand)||"N/A"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"SKU"}),a.jsx("p",{className:"text-gray-900 font-medium",children:(null==(f=A.product)?void 0:f.sku)||"N/A"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Categoria"}),a.jsx("p",{className:"text-gray-900 font-medium",children:(null==(w=A.product)?void 0:w.category)||"N/A"})]})]})]}),R&&M(R.claims).length>0&&a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[a.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[a.jsx(i,{className:"w-5 h-5 mr-2"}),"Claims do Produto para Validação"]}),a.jsx("div",{className:"space-y-3",children:M(R.claims).map(((e,s)=>a.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:"font-medium text-gray-900",children:e}),a.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Status:",a.jsx("span",{className:"ml-1 px-2 py-1 rounded-full text-xs font-medium "+("APPROVED"===L[e]?"bg-green-100 text-green-800":"REJECTED"===L[e]?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"),children:"APPROVED"===L[e]?"Aprovado":"REJECTED"===L[e]?"Rejeitado":"Pendente"})]})]}),"PENDING"===A.status&&a.jsxs("div",{className:"flex space-x-2 ml-4",children:[a.jsx("button",{onClick:()=>B(e,"APPROVED"),className:"p-2 rounded-lg transition-colors "+("APPROVED"===L[e]?"bg-green-100 text-green-700":"bg-gray-100 text-gray-600 hover:bg-green-50 hover:text-green-600"),title:"Aprovar claim",children:a.jsx(d,{className:"w-4 h-4"})}),a.jsx("button",{onClick:()=>B(e,"REJECTED"),className:"p-2 rounded-lg transition-colors "+("REJECTED"===L[e]?"bg-red-100 text-red-700":"bg-gray-100 text-gray-600 hover:bg-red-50 hover:text-red-600"),title:"Rejeitar claim",children:a.jsx(j,{className:"w-4 h-4"})})]})]})},s)))}),a.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:a.jsxs("div",{className:"flex items-start",children:[a.jsx(u,{className:"w-5 h-5 text-blue-600 mr-2 mt-0.5"}),a.jsxs("div",{className:"text-sm text-blue-800",children:[a.jsx("p",{className:"font-medium",children:"Instruções para Validação:"}),a.jsx("p",{className:"mt-1",children:"Revise cada claim individualmente. Aprove apenas claims que possuem documentação adequada e atendem aos padrões de qualidade. Claims rejeitados não aparecerão na validação final do produto."})]})]})})]}),C.length>0&&a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[a.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[a.jsx(p,{className:"w-5 h-5 mr-2"}),"Certificações do Produto"]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:C.map(((e,s)=>{var t;return a.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:"font-medium text-gray-900",children:(null==(t=e.certification)?void 0:t.name)||"Certificação"}),a.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Número: ",e.certificateNumber||"N/A"]}),a.jsxs("p",{className:"text-sm text-gray-600",children:["Validade: ",e.expiryDate?new Date(e.expiryDate).toLocaleDateString("pt-BR"):"N/A"]})]}),a.jsx("div",{className:"px-2 py-1 rounded-full text-xs font-medium "+("ACTIVE"===e.status?"bg-green-100 text-green-800":"EXPIRED"===e.status?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"),children:"ACTIVE"===e.status?"Ativa":"EXPIRED"===e.status?"Expirada":e.status})]})},s)}))})]}),a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Detalhes da Validação"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"ID da Validação"}),a.jsx("p",{className:"text-gray-900 font-mono text-sm",children:A.id})]}),A.summary&&a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Resumo"}),a.jsx("p",{className:"text-gray-900",children:A.summary})]}),A.notes&&a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Observações"}),a.jsx("p",{className:"text-gray-700",children:A.notes})]}),A.laboratory&&a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Laboratório"}),a.jsx("p",{className:"text-gray-900",children:A.laboratory})]}),A.validator&&a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Validador"}),a.jsxs("div",{className:"flex items-center mt-1",children:[a.jsx(c,{className:"w-4 h-4 text-gray-400 mr-2"}),a.jsx("p",{className:"text-gray-900",children:A.validator})]})]})]})]}),a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Timeline da Validação"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:a.jsx(n,{className:"w-4 h-4 text-blue-600"})}),a.jsxs("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Validação Criada"}),a.jsx("p",{className:"text-sm text-gray-600",children:new Date(A.createdAt).toLocaleString("pt-BR")})]})]}),A.requestedAt&&a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center",children:a.jsx(n,{className:"w-4 h-4 text-yellow-600"})}),a.jsxs("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Validação Solicitada"}),a.jsx("p",{className:"text-sm text-gray-600",children:new Date(A.requestedAt).toLocaleString("pt-BR")})]})]}),A.validatedAt&&a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:a.jsx(l,{className:"w-4 h-4 text-green-600"})}),a.jsxs("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Validação Concluída"}),a.jsx("p",{className:"text-sm text-gray-600",children:new Date(A.validatedAt).toLocaleString("pt-BR")})]})]})]})]})]}):a.jsxs("div",{className:"text-center py-12",children:[a.jsx("p",{className:"text-gray-600",children:"Validação não encontrada"}),a.jsx("button",{onClick:()=>D("/dashboard/validations"),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Voltar para Validações"})]})};export{N as default};
