import{c as e,j as s,P as a,Q as t,e as r,O as d}from"./index-DeKtUJAc.js";import{e as o,r as l}from"./vendor-BDxjXY-2.js";import{p as i}from"./productService-DtNiporo.js";import{q as n}from"./qrService-BZ_OVWnh.js";import{u as c}from"./qrStore-DmEC1IPf.js";import{D as m}from"./download-B9M2FoM6.js";import{S as x}from"./share-2-eyNSeTcJ.js";import{E as h}from"./eye-CKGr823U.js";import"./charts-C38Ohhsz.js";
/**
 * @license lucide-react v0.513.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u=e("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),p=()=>{const e=o(),[p,j]=l.useState([]),[g,N]=l.useState(!0),[b,C]=l.useState(null),{qrCodes:y,getQRCode:f,lastUpdate:v}=c(),w=async()=>{try{N(!0);const e=(await i.getProducts({limit:100})).data.map((e=>{const s=!!e.qrCode,a=f(e.id);let t=null;if(a)t=a;else if(s){const s=`${window.location.origin}/validation/${e.qrCode}`;t={qrCode:e.qrCode,validationUrl:s,qrCodeImage:`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(s)}`,product:{id:e.id,name:e.name,brand:e.brand,sku:e.sku}}}return{...e,hasQRCode:s||!!a,qrCodeData:t}}));j(e)}catch(e){d.error("Erro ao carregar produtos")}finally{N(!1)}};l.useEffect((()=>{w()}),[]),l.useEffect((()=>{p.length>0&&w()}),[v]);const D=async e=>{if(e.qrCodeData){await n.copyValidationUrl(e.qrCodeData.validationUrl)?d.success("URL copiada para a área de transferência"):d.error("Erro ao copiar URL")}},R=e=>{switch(e){case"VALIDATED":return"bg-green-100 text-green-800";case"PENDING":return"bg-yellow-100 text-yellow-800";case"REJECTED":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return g?s.jsx("div",{className:"flex items-center justify-center min-h-screen",children:s.jsx("div",{className:"loading-spinner w-8 h-8"})}):s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"flex justify-between items-center",children:s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"QR Codes"}),s.jsx("p",{className:"text-gray-600",children:"Gerencie QR Codes dos seus produtos"})]})}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(a,{className:"w-8 h-8 text-blue-600 mr-3"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Total de Produtos"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:p.length})]})]})}),s.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(t,{className:"w-8 h-8 text-green-600 mr-3"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Com QR Code"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:p.filter((e=>e.hasQRCode)).length})]})]})}),s.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(r,{className:"w-8 h-8 text-purple-600 mr-3"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Validados"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:p.filter((e=>"VALIDATED"===e.status)).length})]})]})})]}),s.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:p.map((a=>s.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[s.jsxs("div",{className:"flex items-start justify-between mb-4",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:a.name}),s.jsx("p",{className:"text-sm text-gray-600",children:a.brand}),s.jsxs("p",{className:"text-xs text-gray-500",children:["SKU: ",a.sku]})]}),s.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${R(a.status)}`,children:["VALIDATED"===a.status&&"Validado","PENDING"===a.status&&"Pendente","REJECTED"===a.status&&"Rejeitado"]})]}),a.hasQRCode&&a.qrCodeData?s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"flex justify-center",children:s.jsx("img",{src:a.qrCodeData.qrCodeImage,alt:`QR Code - ${a.name}`,className:"w-32 h-32 border rounded-lg"})}),s.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[s.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"URL de Validação:"}),s.jsx("p",{className:"text-xs font-mono text-gray-800 break-all",children:a.qrCodeData.validationUrl})]}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsxs("button",{onClick:()=>(e=>{e.qrCodeData&&(n.downloadQRCodeImage(e.qrCodeData.qrCodeImage,e.name),d.success("Download iniciado"))})(a),className:"flex-1 btn btn-outline text-sm",title:"Download QR Code",children:[s.jsx(m,{className:"w-4 h-4 mr-1"}),"Download"]}),s.jsxs("button",{onClick:()=>D(a),className:"flex-1 btn btn-outline text-sm",title:"Copiar URL",children:[s.jsx(u,{className:"w-4 h-4 mr-1"}),"Copiar"]}),s.jsx("button",{onClick:()=>(async e=>{e.qrCodeData&&(await n.shareQRCode(e.qrCodeData)||await D(e))})(a),className:"btn btn-outline text-sm px-3",title:"Compartilhar",children:s.jsx(x,{className:"w-4 h-4"})})]})]}):s.jsxs("div",{className:"text-center py-8",children:[s.jsx(t,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),s.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"VALIDATED"===a.status?"QR Code não gerado":"Produto precisa ser validado primeiro"}),"VALIDATED"===a.status&&s.jsx("button",{onClick:()=>(async e=>{var s,a,t;try{C(e);const s=await n.generateQRCode(e);j((a=>a.map((a=>a.id===e?{...a,qrCodeData:s,hasQRCode:!0}:a)))),d.success("QR Code gerado com sucesso!")}catch(r){401===(null==(s=r.response)?void 0:s.status)?d.error("Sessão expirada. Faça login novamente."):404===(null==(a=r.response)?void 0:a.status)?d.error("Produto não encontrado ou não validado."):403===(null==(t=r.response)?void 0:t.status)?d.error("Você não tem permissão para gerar QR Code para este produto."):d.error("Erro ao gerar QR Code. Tente novamente.")}finally{C(null)}})(a.id),disabled:b===a.id,className:"btn btn-primary text-sm",children:b===a.id?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"loading-spinner w-4 h-4 mr-2"}),"Gerando..."]}):s.jsxs(s.Fragment,{children:[s.jsx(t,{className:"w-4 h-4 mr-2"}),"Gerar QR Code"]})})]}),a.hasQRCode&&s.jsx("div",{className:"mt-4 pt-4 border-t",children:s.jsxs("button",{className:"w-full btn btn-outline text-sm",onClick:()=>e(`/dashboard/qr-codes/${a.id}/analytics`),children:[s.jsx(h,{className:"w-4 h-4 mr-2"}),"Ver Analytics"]})})]},a.id)))}),0===p.length&&!g&&s.jsxs("div",{className:"text-center py-12",children:[s.jsx(t,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nenhum produto encontrado"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"Cadastre produtos para gerar QR Codes"})]})]})};export{p as QRCodesPage,p as default};
