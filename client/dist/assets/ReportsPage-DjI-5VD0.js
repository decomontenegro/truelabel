import{j as e,L as s,b as a,C as t,d as r,D as l,Y as i}from"./index--pVY8JWu.js";import{r as o}from"./vendor-BDxjXY-2.js";import{P as n}from"./plus-CGEZeKeG.js";import{C as d}from"./circle-x-Clc4I5eS.js";import{S as c}from"./search-HjzIlawk.js";import{U as x}from"./upload-BKdPYP5t.js";import{B as m}from"./building-RDXTSiLk.js";import{C as p}from"./calendar-CskR4dPT.js";import{E as h}from"./eye-BwaTJlPp.js";import{T as u}from"./trash-2-CpdeicjR.js";import"./charts-C38Ohhsz.js";const j=()=>{const[j,y]=o.useState([]),[N,f]=o.useState(!0),[b,v]=o.useState(""),[w,A]=o.useState("ALL"),[C,E]=o.useState(!1),[I,k]=o.useState(!1);o.useEffect((()=>{(async()=>{try{f(!0);const e=await fetch("http://localhost:3001/api/reports",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(e.ok){const s=((await e.json()).reports||[]).map((e=>{var s,a;return{id:e.id,fileName:e.originalName,productName:(null==(s=e.product)?void 0:s.name)||"Produto não encontrado",productId:e.productId,laboratoryName:(null==(a=e.laboratory)?void 0:a.name)||"Laboratório não encontrado",laboratoryId:e.laboratoryId,status:e.isVerified?"APPROVED":"PENDING",uploadedAt:e.createdAt,fileSize:e.fileSize,fileType:e.mimeType,downloadUrl:`/api/reports/${e.id}/download`,observations:e.results||""}}));y(s)}else y([])}catch(e){y([])}finally{f(!1)}})()}),[]);const P=s=>{const a={PENDING:{color:"bg-yellow-100 text-yellow-800",icon:r,text:"Pendente"},APPROVED:{color:"bg-green-100 text-green-800",icon:t,text:"Aprovado"},REJECTED:{color:"bg-red-100 text-red-800",icon:d,text:"Rejeitado"}}[s],l=a.icon;return e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${a.color}`,children:[e.jsx(l,{className:"w-3 h-3 mr-1"}),a.text]})},D=e=>{if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]},S=j.filter((e=>{const s=e.fileName.toLowerCase().includes(b.toLowerCase())||e.productName.toLowerCase().includes(b.toLowerCase())||e.laboratoryName.toLowerCase().includes(b.toLowerCase()),a="ALL"===w||e.status===w;return s&&a})),T={total:j.length,approved:j.filter((e=>"APPROVED"===e.status)).length,pending:j.filter((e=>"PENDING"===e.status)).length,rejected:j.filter((e=>"REJECTED"===e.status)).length};return N?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx(s,{size:"lg"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Relatórios"}),e.jsx("p",{className:"text-gray-600",children:"Gerencie relatórios de análise"})]}),e.jsxs("button",{onClick:()=>E(!0),className:"btn btn-primary flex items-center",children:[e.jsx(n,{className:"w-4 h-4 mr-2"}),"Enviar Relatório"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(a,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total de Relatórios"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:T.total})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(t,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Aprovados"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:T.approved})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:e.jsx(r,{className:"h-6 w-6 text-yellow-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pendentes"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:T.pending})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(d,{className:"h-6 w-6 text-red-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Rejeitados"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:T.rejected})]})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(c,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx("input",{type:"text",placeholder:"Buscar relatórios...",value:b,onChange:e=>v(e.target.value),className:"input pl-10 w-full"})]})}),e.jsx("div",{className:"sm:w-48",children:e.jsxs("select",{value:w,onChange:e=>A(e.target.value),className:"input w-full",children:[e.jsx("option",{value:"ALL",children:"Todos os status"}),e.jsx("option",{value:"PENDING",children:"Pendentes"}),e.jsx("option",{value:"APPROVED",children:"Aprovados"}),e.jsx("option",{value:"REJECTED",children:"Rejeitados"})]})})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border overflow-hidden",children:0===S.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(a,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nenhum relatório encontrado"}),e.jsx("p",{className:"text-gray-600 mb-4",children:0===j.length?"Comece enviando o primeiro relatório":"Tente ajustar os filtros de busca"}),e.jsxs("button",{onClick:()=>E(!0),className:"btn btn-primary",children:[e.jsx(x,{className:"w-4 h-4 mr-2"}),"Enviar Relatório"]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Arquivo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Produto"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Laboratório"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ações"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:S.map((s=>{return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(a,{className:"h-5 w-5 text-gray-400 mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.fileName}),e.jsx("div",{className:"text-sm text-gray-500",children:D(s.fileSize)})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.productName})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(m,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("div",{className:"text-sm text-gray-900",children:s.laboratoryName})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:P(s.status)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(p,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("div",{className:"text-sm text-gray-900",children:(t=s.uploadedAt,new Date(t).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}))})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[s.downloadUrl&&e.jsx("button",{onClick:()=>window.open(s.downloadUrl,"_blank"),className:"text-blue-600 hover:text-blue-900",title:"Visualizar",children:e.jsx(h,{className:"h-4 w-4"})}),s.downloadUrl&&e.jsx("button",{onClick:()=>window.open(s.downloadUrl,"_blank"),className:"text-green-600 hover:text-green-900",title:"Download",children:e.jsx(l,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>(async e=>{if(confirm("Tem certeza que deseja excluir este relatório?"))try{y((s=>s.filter((s=>s.id!==e)))),i.success("Relatório excluído com sucesso!")}catch(s){i.error("Erro ao excluir relatório")}})(s.id),className:"text-red-600 hover:text-red-900",title:"Excluir",children:e.jsx(u,{className:"h-4 w-4"})})]})})]},s.id);var t}))})]})})}),C&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Enviar Relatório"}),e.jsx(g,{onUpload:async e=>{try{k(!0);const s=new FormData;s.append("file",e.file),s.append("productId",e.productId),s.append("laboratoryId",e.laboratoryId),s.append("analysisType",e.analysisType);const a=await fetch("http://localhost:3001/api/reports",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},body:s});if(!a.ok){const e=await a.json();throw new Error(e.error||"Erro no upload")}await a.json();const t=await fetch("http://localhost:3001/api/reports",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(t.ok){const e=await t.json();y(e.reports||[])}E(!1),i.success("Relatório enviado com sucesso!")}catch(s){i.error(s.message||"Erro ao enviar relatório")}finally{k(!1)}},uploading:I,onCancel:()=>E(!1)})]})})]})},g=({onUpload:s,uploading:t,onCancel:r})=>{const[l,n]=o.useState(!1),[d,c]=o.useState(null),[m,p]=o.useState([]),[h,j]=o.useState([]),[g,y]=o.useState({productId:"",laboratoryId:"",analysisType:""});o.useEffect((()=>{(async()=>{try{const[e,s]=await Promise.all([fetch("http://localhost:3001/api/products",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),fetch("http://localhost:3001/api/laboratories",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})]);if(e.ok){const s=await e.json();p(s.products||[])}if(s.ok){const e=await s.json();j(e.laboratories||[])}}catch(e){}})()}),[]);const N=e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?n(!0):"dragleave"===e.type&&n(!1)},f=d&&g.productId&&g.laboratoryId&&g.analysisType;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Produto *"}),e.jsxs("select",{value:g.productId,onChange:e=>y((s=>({...s,productId:e.target.value}))),className:"input w-full",disabled:t,children:[e.jsx("option",{value:"",children:"Selecione um produto"}),m.map((s=>e.jsxs("option",{value:s.id,children:[s.name," - ",s.brand]},s.id)))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Laboratório *"}),e.jsxs("select",{value:g.laboratoryId,onChange:e=>y((s=>({...s,laboratoryId:e.target.value}))),className:"input w-full",disabled:t,children:[e.jsx("option",{value:"",children:"Selecione um laboratório"}),h.map((s=>e.jsxs("option",{value:s.id,children:[s.name," - ",s.accreditation]},s.id)))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Análise *"}),e.jsxs("select",{value:g.analysisType,onChange:e=>y((s=>({...s,analysisType:e.target.value}))),className:"input w-full",disabled:t,children:[e.jsx("option",{value:"",children:"Selecione o tipo de análise"}),e.jsx("option",{value:"nutritional",children:"Análise Nutricional"}),e.jsx("option",{value:"microbiological",children:"Análise Microbiológica"}),e.jsx("option",{value:"contaminants",children:"Análise de Contaminantes"}),e.jsx("option",{value:"allergens",children:"Análise de Alérgenos"}),e.jsx("option",{value:"protein",children:"Análise de Proteínas"}),e.jsx("option",{value:"gluten",children:"Análise de Glúten"}),e.jsx("option",{value:"other",children:"Outros"})]})]}),e.jsxs("div",{className:"border-2 border-dashed rounded-lg p-6 text-center transition-colors "+(l?"border-blue-400 bg-blue-50":"border-gray-300 hover:border-gray-400"),onDragEnter:N,onDragLeave:N,onDragOver:N,onDrop:e=>{if(e.preventDefault(),e.stopPropagation(),n(!1),e.dataTransfer.files&&e.dataTransfer.files[0]){const s=e.dataTransfer.files[0];"application/pdf"===s.type||s.type.startsWith("image/")?c(s):i.error("Apenas arquivos PDF e imagens são aceitos")}},children:[e.jsx(x,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Arraste e solte um arquivo aqui, ou"}),e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("span",{className:"text-blue-600 hover:text-blue-700 font-medium",children:"clique para selecionar"}),e.jsx("input",{type:"file",className:"hidden",accept:".pdf,image/*",onChange:e=>{if(e.target.files&&e.target.files[0]){const s=e.target.files[0];"application/pdf"===s.type||s.type.startsWith("image/")?c(s):i.error("Apenas arquivos PDF e imagens são aceitos")}},disabled:t})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"PDF ou imagens até 10MB"})]}),d&&e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(a,{className:"h-5 w-5 text-gray-400 mr-3"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:d.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[(d.size/1024/1024).toFixed(2)," MB"]})]}),e.jsx("button",{onClick:()=>c(null),className:"text-red-600 hover:text-red-700",disabled:t,children:e.jsx(u,{className:"h-4 w-4"})})]})}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:r,className:"btn btn-secondary",disabled:t,children:"Cancelar"}),e.jsx("button",{onClick:()=>{d&&g.productId&&g.laboratoryId&&g.analysisType?s({file:d,productId:g.productId,laboratoryId:g.laboratoryId,analysisType:g.analysisType}):i.error("Preencha todos os campos obrigatórios")},className:"btn btn-primary",disabled:!f||t,children:t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"loading-spinner w-4 h-4 mr-2"}),"Enviando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"w-4 h-4 mr-2"}),"Enviar"]})})]})]})};export{j as default};
