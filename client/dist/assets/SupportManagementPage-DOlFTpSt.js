import{c as e,U as t,j as s,C as a,R as r,a8 as i,e as c,G as n,d as o}from"./index--pVY8JWu.js";import{r as l,e as d}from"./vendor-BDxjXY-2.js";import{u as m}from"./index.esm-kuqD8XAN.js";import{u as p}from"./useAsyncAction-CAXDwRpP.js";import{S as u}from"./settings-p6qY8jAy.js";import{C as x}from"./circle-x-Clc4I5eS.js";import{S as h}from"./search-HjzIlawk.js";import{T as g}from"./trending-up-B9b3qhRR.js";import{f as y}from"./format-BDzt1qre.js";import{p as j}from"./pt-BR-C6g8RSf9.js";import"./charts-C38Ohhsz.js";import"./en-US-pqY3htb7.js";
/**
 * @license lucide-react v0.513.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f=e("message-circle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);const b=new class{async createTicket(e){try{const s=new FormData;Object.entries(e).forEach((([e,t])=>{void 0!==t&&"attachments"!==e&&s.append(e,t.toString())})),e.attachments&&e.attachments.forEach((e=>{s.append("attachments",e)}));return(await t.post("/support/tickets",s,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(s){return this.createMockTicket(e)}}async createMockTicket(e){var t;await new Promise((e=>setTimeout(e,1e3)));const s={id:`ticket-${Date.now()}`,subject:e.subject,category:e.category,priority:e.priority,description:e.description,status:"open",productCode:e.productCode,orderNumber:e.orderNumber,userId:e.userId,userEmail:e.userEmail,userName:e.userName,attachments:(null==(t=e.attachments)?void 0:t.map((e=>e.name)))||[],createdAt:new Date,updatedAt:new Date,responses:[]},a=JSON.parse(localStorage.getItem("mockSupportTickets")||"[]");return a.push(s),localStorage.setItem("mockSupportTickets",JSON.stringify(a)),s}async getTickets(e){try{return(await t.get("/support/tickets",{params:e})).data}catch(s){return this.getMockTickets()}}async getTicket(e){try{return(await t.get(`/support/tickets/${e}`)).data}catch(s){const t=this.getMockTickets().find((t=>t.id===e));if(!t)throw new Error("Ticket not found");return t}}getMockTickets(){const e=localStorage.getItem("mockSupportTickets");if(e)return JSON.parse(e);const t=[{id:"ticket-1",subject:"Problema com validação de produto",category:"technical",priority:"high",description:"Não consigo validar meu produto orgânico",status:"open",productCode:"ORG-001",userId:"user-1",userEmail:"usuario@exemplo.com",userName:"Usuário Exemplo",createdAt:new Date(Date.now()-1728e5),updatedAt:new Date(Date.now()-1728e5),responses:[]},{id:"ticket-2",subject:"Dúvida sobre QR Code",category:"quality",priority:"medium",description:"Como gerar QR Code para meu produto?",status:"resolved",userId:"user-2",userEmail:"marca@exemplo.com",userName:"Marca Exemplo",createdAt:new Date(Date.now()-432e6),updatedAt:new Date(Date.now()-864e5),responses:[{id:"response-1",ticketId:"ticket-2",message:'Para gerar um QR Code, acesse a página do produto e clique em "Gerar QR Code".',author:"Suporte True Label",authorRole:"support",createdAt:new Date(Date.now()-864e5)}]}];return localStorage.setItem("mockSupportTickets",JSON.stringify(t)),t}async updateTicket(e,s){return(await t.put(`/support/tickets/${e}`,s)).data}async addTicketResponse(e,s,a){const r=new FormData;r.append("message",s),a&&a.forEach((e=>{r.append("attachments",e)}));return(await t.post(`/support/tickets/${e}/responses`,r,{headers:{"Content-Type":"multipart/form-data"}})).data}async sendWhatsAppMessage(e,s,a){try{return(await t.post("/support/whatsapp/send",{phoneNumber:e,message:s,templateName:a})).data}catch(r){return await new Promise((e=>setTimeout(e,1e3))),{success:!0,messageId:`mock-${Date.now()}`,message:"Mensagem enviada (simulação)"}}}async getWhatsAppTemplates(){try{return(await t.get("/support/whatsapp/templates")).data}catch(e){return[{id:"1",name:"welcome",content:"Bem-vindo ao True Label!"},{id:"2",name:"support",content:"Como podemos ajudar você?"}]}}async configureWhatsApp(e){try{await t.post("/support/whatsapp/configure",e)}catch(s){await new Promise((e=>setTimeout(e,1e3)))}}async getWhatsAppStatus(){try{return(await t.get("/support/whatsapp/status")).data}catch(e){return{connected:!1,phoneNumber:"+55 11 99999-9999",businessName:"True Label Demo"}}}async getFAQs(e,s){return(await t.get("/support/faqs",{params:{category:e,productId:s}})).data}async createFAQ(e){return(await t.post("/support/faqs",e)).data}async updateFAQ(e,s){return(await t.put(`/support/faqs/${e}`,s)).data}async deleteFAQ(e){await t.delete(`/support/faqs/${e}`)}async getSupportAnalytics(e){try{return(await t.get("/support/analytics",{params:e})).data}catch(s){return this.getMockAnalytics()}}getMockAnalytics(){const e=this.getMockTickets();return{totalTickets:e.length,openTickets:e.filter((e=>"open"===e.status)).length,avgResponseTime:4.5,satisfactionRate:92.5,ticketsByCategory:{technical:e.filter((e=>"technical"===e.category)).length,quality:e.filter((e=>"quality"===e.category)).length,delivery:e.filter((e=>"delivery"===e.category)).length,warranty:e.filter((e=>"warranty"===e.category)).length,counterfeit:e.filter((e=>"counterfeit"===e.category)).length,authentication:e.filter((e=>"authentication"===e.category)).length,other:e.filter((e=>"other"===e.category)).length},ticketsByPriority:{low:e.filter((e=>"low"===e.priority)).length,medium:e.filter((e=>"medium"===e.priority)).length,high:e.filter((e=>"high"===e.priority)).length}}}async getChatHistory(e,s=50){return(await t.get("/support/chat/history",{params:{userId:e,limit:s}})).data}async saveChatMessage(e){await t.post("/support/chat/messages",e)}},N=({onConfigured:e})=>{const[t,i]=l.useState({connected:!1}),[c,n]=l.useState(!1),[o,d]=l.useState([]),{register:h,handleSubmit:g,formState:{errors:y}}=m(),{execute:j,loading:N}=p((async()=>{const e=await b.getWhatsAppStatus();if(i(e),e.connected){const e=await b.getWhatsAppTemplates();d(e)}})),{execute:w,loading:v}=p((async t=>{await b.configureWhatsApp(t),await j(),n(!1),null==e||e()}));l.useEffect((()=>{j()}),[]);return s.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(f,{className:"text-green-600",size:24}),s.jsx("h3",{className:"text-lg font-semibold",children:"WhatsApp Business Integration"})]}),s.jsx("button",{onClick:()=>n(!c),className:"text-gray-600 hover:text-gray-900",children:s.jsx(u,{size:20})})]}),s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.connected?s.jsxs(s.Fragment,{children:[s.jsx(a,{className:"text-green-500",size:20}),s.jsx("span",{className:"text-green-700 font-medium",children:"Conectado"})]}):s.jsxs(s.Fragment,{children:[s.jsx(x,{className:"text-red-500",size:20}),s.jsx("span",{className:"text-red-700 font-medium",children:"Desconectado"})]}),s.jsx("button",{onClick:()=>j(),disabled:N,className:"ml-auto text-blue-600 hover:text-blue-700",children:s.jsx(r,{size:16,className:N?"animate-spin":""})})]}),t.connected&&s.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[s.jsxs("p",{children:["Número: ",t.phoneNumber]}),s.jsxs("p",{children:["Empresa: ",t.businessName]})]})]}),c&&s.jsxs("form",{onSubmit:g((e=>{w(e)})),className:"space-y-4 border-t pt-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Business ID"}),s.jsx("input",{type:"text",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",placeholder:"Ex: 123456789012345",...h("businessId",{required:"Business ID é obrigatório"})}),y.businessId&&s.jsx("p",{className:"text-red-500 text-xs mt-1",children:y.businessId.message})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number ID"}),s.jsx("input",{type:"text",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",placeholder:"Ex: 987654321098765",...h("phoneNumberId",{required:"Phone Number ID é obrigatório"})}),y.phoneNumberId&&s.jsx("p",{className:"text-red-500 text-xs mt-1",children:y.phoneNumberId.message})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Access Token"}),s.jsx("input",{type:"password",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",placeholder:"Token de acesso da API",...h("accessToken",{required:"Access Token é obrigatório"})}),y.accessToken&&s.jsx("p",{className:"text-red-500 text-xs mt-1",children:y.accessToken.message})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Verify Token"}),s.jsx("input",{type:"text",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",placeholder:"Token de verificação do webhook",...h("verifyToken",{required:"Verify Token é obrigatório"})}),y.verifyToken&&s.jsx("p",{className:"text-red-500 text-xs mt-1",children:y.verifyToken.message})]}),s.jsxs("div",{className:"flex space-x-3",children:[s.jsx("button",{type:"submit",disabled:v,className:"flex-1 bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50",children:v?"Salvando...":"Salvar Configuração"}),s.jsx("button",{type:"button",onClick:()=>n(!1),className:"flex-1 bg-gray-200 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-300 transition-colors",children:"Cancelar"})]})]}),t.connected&&o.length>0&&!c&&s.jsxs("div",{className:"border-t pt-4",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Templates Disponíveis"}),s.jsx("div",{className:"space-y-2",children:o.map(((e,t)=>s.jsxs("div",{className:"text-sm bg-gray-50 p-2 rounded",children:[s.jsx("p",{className:"font-medium",children:e.name}),s.jsx("p",{className:"text-gray-600 text-xs",children:e.language})]},t)))})]}),s.jsxs("div",{className:"mt-6 bg-blue-50 p-4 rounded-lg",children:[s.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:"Como configurar:"}),s.jsxs("ol",{className:"text-sm text-blue-800 space-y-1 list-decimal list-inside",children:[s.jsx("li",{children:"Acesse o Meta Business Suite"}),s.jsx("li",{children:"Vá para WhatsApp → Configurações da API"}),s.jsx("li",{children:"Copie os IDs e tokens necessários"}),s.jsxs("li",{children:["Configure o webhook URL: ",window.location.origin,"/api/whatsapp/webhook"]})]})]})]})},w=()=>{const e=d(),[t,r]=l.useState([]),[m,u]=l.useState([]),[f,w]=l.useState(""),[v,k]=l.useState({status:"all",priority:"all",category:"all"}),[T,A]=l.useState(null),[C,S]=l.useState("tickets"),{execute:D,loading:I}=p((async()=>{const[e,t]=await Promise.all([b.getTickets(),b.getSupportAnalytics()]);r(e),u(e),A(t)}));l.useEffect((()=>{D()}),[]),l.useEffect((()=>{let e=t;f&&(e=e.filter((e=>e.subject.toLowerCase().includes(f.toLowerCase())||e.description.toLowerCase().includes(f.toLowerCase())||e.userEmail.toLowerCase().includes(f.toLowerCase())))),"all"!==v.status&&(e=e.filter((e=>e.status===v.status))),"all"!==v.priority&&(e=e.filter((e=>e.priority===v.priority))),"all"!==v.category&&(e=e.filter((e=>e.category===v.category))),u(e)}),[t,f,v]);const E=e=>{switch(e){case"open":return s.jsx(n,{className:"text-yellow-500",size:16});case"in_progress":return s.jsx(o,{className:"text-blue-500",size:16});case"resolved":return s.jsx(a,{className:"text-green-500",size:16});case"closed":return s.jsx(x,{className:"text-gray-500",size:16});default:return null}},M=e=>{switch(e){case"high":return"text-red-600 bg-red-50";case"medium":return"text-yellow-600 bg-yellow-50";case"low":return"text-green-600 bg-green-50";default:return"text-gray-600 bg-gray-50"}},R={open:"Aberto",in_progress:"Em Andamento",resolved:"Resolvido",closed:"Fechado"},z={authentication:"Autenticação",quality:"Qualidade",delivery:"Entrega",warranty:"Garantia",counterfeit:"Falsificação",technical:"Técnico",other:"Outro"};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gerenciamento de Suporte"}),s.jsx("p",{className:"text-gray-600 mt-1",children:"Gerencie tickets de suporte e configurações de atendimento"})]}),s.jsx("div",{className:"border-b border-gray-200",children:s.jsx("nav",{className:"-mb-px flex space-x-8",children:[{key:"tickets",label:"Tickets",icon:i},{key:"whatsapp",label:"WhatsApp",icon:i},{key:"analytics",label:"Analytics",icon:c}].map((e=>s.jsxs("button",{onClick:()=>S(e.key),className:"py-2 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 "+(C===e.key?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[s.jsx(e.icon,{size:18}),s.jsx("span",{children:e.label})]},e.key)))})}),"tickets"===C&&s.jsxs("div",{children:[s.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border mb-6",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"relative",children:[s.jsx(h,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),s.jsx("input",{type:"text",placeholder:"Buscar tickets...",value:f,onChange:e=>w(e.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("select",{value:v.status,onChange:e=>k({...v,status:e.target.value}),className:"px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[s.jsx("option",{value:"all",children:"Todos os Status"}),s.jsx("option",{value:"open",children:"Aberto"}),s.jsx("option",{value:"in_progress",children:"Em Andamento"}),s.jsx("option",{value:"resolved",children:"Resolvido"}),s.jsx("option",{value:"closed",children:"Fechado"})]}),s.jsxs("select",{value:v.priority,onChange:e=>k({...v,priority:e.target.value}),className:"px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[s.jsx("option",{value:"all",children:"Todas as Prioridades"}),s.jsx("option",{value:"high",children:"Alta"}),s.jsx("option",{value:"medium",children:"Média"}),s.jsx("option",{value:"low",children:"Baixa"})]}),s.jsxs("select",{value:v.category,onChange:e=>k({...v,category:e.target.value}),className:"px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[s.jsx("option",{value:"all",children:"Todas as Categorias"}),Object.entries(z).map((([e,t])=>s.jsx("option",{value:e,children:t},e)))]})]})}),s.jsx("div",{className:"bg-white rounded-lg shadow-sm border overflow-hidden",children:I?s.jsxs("div",{className:"p-8 text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),s.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando tickets..."})]}):0===m.length?s.jsxs("div",{className:"p-8 text-center",children:[s.jsx(i,{className:"mx-auto text-gray-300 mb-4",size:48}),s.jsx("p",{className:"text-gray-500",children:"Nenhum ticket encontrado"})]}):s.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[s.jsx("thead",{className:"bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ticket"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Usuário"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Categoria"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Prioridade"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data"}),s.jsx("th",{className:"relative px-6 py-3",children:s.jsx("span",{className:"sr-only",children:"Ações"})})]})}),s.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:m.map((t=>s.jsxs("tr",{className:"hover:bg-gray-50",children:[s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsxs("div",{children:[s.jsxs("p",{className:"text-sm font-medium text-gray-900",children:["#",t.id.slice(0,8)]}),s.jsx("p",{className:"text-sm text-gray-500 truncate max-w-xs",children:t.subject})]})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-900",children:t.userName||"Anônimo"}),s.jsx("p",{className:"text-sm text-gray-500",children:t.userEmail})]})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsx("span",{className:"text-sm text-gray-900",children:z[t.category]||t.category})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${M(t.priority)}`,children:"high"===t.priority?"Alta":"medium"===t.priority?"Média":"Baixa"})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsxs("div",{className:"flex items-center space-x-2",children:[E(t.status),s.jsx("span",{className:"text-sm text-gray-900",children:R[t.status]})]})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:y(new Date(t.createdAt),"dd/MM/yyyy HH:mm",{locale:j})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:s.jsx("button",{onClick:()=>e(`/admin/support/tickets/${t.id}`),className:"text-blue-600 hover:text-blue-900",children:"Ver detalhes"})})]},t.id)))})]})})]}),"whatsapp"===C&&s.jsx("div",{className:"max-w-4xl",children:s.jsx(N,{onConfigured:D})}),"analytics"===C&&T&&s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[s.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Total de Tickets"}),s.jsx(i,{className:"text-gray-400",size:20})]}),s.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:T.totalTickets}),s.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Todos os tempos"})]}),s.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Tickets Abertos"}),s.jsx(n,{className:"text-yellow-400",size:20})]}),s.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:T.openTickets}),s.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Aguardando resposta"})]}),s.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Tempo de Resposta"}),s.jsx(o,{className:"text-blue-400",size:20})]}),s.jsxs("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:[T.avgResponseTime,"h"]}),s.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Média"})]}),s.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Satisfação"}),s.jsx(g,{className:"text-green-400",size:20})]}),s.jsxs("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:[T.satisfactionRate,"%"]}),s.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Taxa de satisfação"})]})]})]})};export{w as default};
