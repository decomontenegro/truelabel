import{Y as e,j as s,N as t,d as a}from"./index-DVDeh87x.js";import{i as r,e as l,r as c}from"./vendor-BDxjXY-2.js";import{q as d}from"./qrService-c0XzpkI8.js";import{E as n}from"./eye-DSbeFSkK.js";import{U as i}from"./users-CJg_R5cg.js";import{T as o}from"./trending-up--j1uYKf8.js";import{G as m}from"./globe-17OQ4165.js";import"./charts-C38Ohhsz.js";const x=()=>{const{productId:x}=r(),h=l(),[j,g]=c.useState(null),[u,p]=c.useState(!0),[N,b]=c.useState("7d");c.useEffect((()=>{x&&y()}),[x]);const y=async()=>{if(x)try{p(!0);const e=await d.getQRCodeAccesses(x);g(e.analytics)}catch(s){e.error("Erro ao carregar analytics do QR Code")}finally{p(!1)}};if(u)return s.jsx("div",{className:"flex items-center justify-center min-h-64",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),s.jsx("p",{className:"mt-2 text-gray-600",children:"Carregando analytics..."})]})});if(!j)return s.jsxs("div",{className:"text-center py-12",children:[s.jsx("p",{className:"text-gray-600",children:"Nenhum dado de analytics encontrado"}),s.jsx("button",{onClick:()=>h("/dashboard/products"),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Voltar para Produtos"})]});const v=(()=>{if(!j||"all"===N)return j;const{startDate:e}=(()=>{const e=new Date,s="7d"===N?7:"30d"===N?30:365;return{startDate:new Date(e.getTime()-24*s*60*60*1e3),endDate:e}})(),s=Object.entries(j.scansByDate).filter((([s])=>new Date(s)>=e)).reduce(((e,[s,t])=>({...e,[s]:t})),{});return{...j,scansByDate:s}})(),f=Object.values((null==v?void 0:v.scansByDate)||{}).reduce(((e,s)=>e+s),0);return s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("button",{onClick:()=>h("/dashboard/products"),className:"mr-4 p-2 hover:bg-gray-100 rounded-lg",children:s.jsx(t,{className:"w-5 h-5"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Analytics do QR Code"}),s.jsxs("p",{className:"text-gray-600 mt-1",children:["Produto ID: ",x]})]})]}),s.jsx("div",{className:"flex items-center gap-3",children:s.jsxs("select",{value:N,onChange:e=>b(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"7d",children:"Últimos 7 dias"}),s.jsx("option",{value:"30d",children:"Últimos 30 dias"}),s.jsx("option",{value:"all",children:"Todo período"})]})})]})}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[s.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(n,{className:"w-8 h-8 text-blue-600 mr-3"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Total de Escaneamentos"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:j.totalScans})]})]})}),s.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(i,{className:"w-8 h-8 text-green-600 mr-3"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Usuários Únicos"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:j.uniqueIPs})]})]})}),s.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(o,{className:"w-8 h-8 text-purple-600 mr-3"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"No Período"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:f})]})]})}),s.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(a,{className:"w-8 h-8 text-orange-600 mr-3"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Último Escaneamento"}),s.jsx("p",{className:"text-sm font-medium text-gray-900",children:j.lastScan?new Date(j.lastScan).toLocaleDateString("pt-BR"):"Nunca"})]})]})})]}),s.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Escaneamentos por Data"}),s.jsx("div",{className:"space-y-2",children:Object.entries((null==v?void 0:v.scansByDate)||{}).sort((([e],[s])=>new Date(s).getTime()-new Date(e).getTime())).slice(0,10).map((([e,t])=>s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm text-gray-600",children:new Date(e).toLocaleDateString("pt-BR")}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"bg-blue-200 h-4 rounded mr-2",style:{width:`${Math.max(20,t/Math.max(...Object.values((null==v?void 0:v.scansByDate)||{}))*200)}px`}}),s.jsx("span",{className:"text-sm font-medium text-gray-900 w-8 text-right",children:t})]})]},e)))})]}),s.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Escaneamentos por Hora (Últimas 24h)"}),s.jsx("div",{className:"grid grid-cols-12 gap-2",children:Array.from({length:24},((e,t)=>{const a=j.scansByHour[t]||0,r=Math.max(...Object.values(j.scansByHour)),l=r>0?Math.max(20,a/r*100):20;return s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"bg-blue-500 rounded-t mx-auto mb-1",style:{width:"20px",height:`${l}px`,opacity:a>0?1:.2}}),s.jsxs("span",{className:"text-xs text-gray-600",children:[t,"h"]}),s.jsx("div",{className:"text-xs font-medium text-gray-900",children:a})]},t)}))})]}),s.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Escaneamentos Recentes"}),s.jsx("div",{className:"space-y-3",children:j.recentScans.length>0?j.recentScans.map(((e,t)=>{return s.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100 last:border-b-0",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(m,{className:"w-4 h-4 text-gray-400 mr-3"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-900",children:(a=e.userAgent,a.includes("Mobile")?"Mobile":a.includes("Chrome")?"Chrome":a.includes("Firefox")?"Firefox":a.includes("Safari")?"Safari":"Outros")}),s.jsxs("p",{className:"text-xs text-gray-500",children:["IP: ",e.ip]})]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-sm text-gray-600",children:new Date(e.timestamp).toLocaleDateString("pt-BR")}),s.jsx("p",{className:"text-xs text-gray-500",children:new Date(e.timestamp).toLocaleTimeString("pt-BR")})]})]},t);var a})):s.jsx("p",{className:"text-gray-500 text-center py-4",children:"Nenhum escaneamento recente"})})]})]})};export{x as default};
