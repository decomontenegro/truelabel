import{M as a,j as e,C as s,O as t}from"./index-DeKtUJAc.js";import{r}from"./vendor-BDxjXY-2.js";import{P as i}from"./plus-DeicFfk_.js";import{S as o}from"./search-C2yUKuVE.js";import{B as l}from"./building-2-C4k_c8tm.js";import{C as c}from"./circle-x-DPkhpEGr.js";import{M as n}from"./mail-DAwxEWDx.js";import{P as d}from"./phone-DatB7wE1.js";import{M as m}from"./map-pin-CYFbGecx.js";import{S as x}from"./square-pen-DsrxxnjO.js";import{T as h}from"./trash-2-Y40uEru7.js";import"./charts-C38Ohhsz.js";const b={async getLaboratories(e={}){const s=new URLSearchParams;Object.entries(e).forEach((([a,e])=>{void 0!==e&&""!==e&&s.append(a,String(e))}));const t=await a.get(`/laboratories?${s.toString()}`),r=t.data.laboratories||[];return{data:r,pagination:t.data.pagination||{page:1,limit:10,total:r.length,totalPages:1}}},getLaboratory:async e=>(await a.get(`/laboratories/${e}`)).data,createLaboratory:async e=>(await a.post("/laboratories",e)).data,updateLaboratory:async(e,s)=>(await a.put(`/laboratories/${e}`,s)).data,updateLaboratoryStatus:async(e,s)=>(await a.patch(`/laboratories/${e}/status`,{isActive:s})).data,deleteLaboratory:async e=>(await a.delete(`/laboratories/${e}`)).data,getLaboratoryStats:async e=>(await a.get(`/laboratories/${e}/stats`)).data,async getActiveLaboratories(){return(await this.getLaboratories({active:!0,limit:100})).data},async searchLaboratories(a){return(await this.getLaboratories({search:a,active:!0,limit:20})).data},async checkEmailAvailability(a,e){try{const s=(await this.getLaboratories({limit:1e3})).data;return{available:!s.some((s=>s.email.toLowerCase()===a.toLowerCase()&&(!e||s.id!==e)))}}catch(s){return{available:!1}}},async getTopLaboratories(a=5){return(await this.getLaboratories({limit:100})).data.sort(((a,e)=>{var s,t;const r=(null==(s=a._count)?void 0:s.reports)||0;return((null==(t=e._count)?void 0:t.reports)||0)-r})).slice(0,a)},validateLaboratoryData(a){const e=[];return(!a.name||a.name.trim().length<2)&&e.push("Nome deve ter pelo menos 2 caracteres"),(!a.accreditation||a.accreditation.trim().length<1)&&e.push("Acreditação é obrigatória"),a.email&&this.isValidEmail(a.email)||e.push("Email inválido"),a.phone&&!this.isValidPhone(a.phone)&&e.push("Telefone inválido"),{isValid:0===e.length,errors:e}},isValidEmail:a=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a),isValidPhone:a=>/^(\(?\d{2}\)?\s?)?\d{4,5}-?\d{4}$/.test(a.replace(/\s/g,"")),formatPhone(a){const e=a.replace(/\D/g,"");return 10===e.length?`(${e.slice(0,2)}) ${e.slice(2,6)}-${e.slice(6)}`:11===e.length?`(${e.slice(0,2)}) ${e.slice(2,7)}-${e.slice(7)}`:a},getCommonAccreditations:()=>["ISO/IEC 17025:2017","ISO/IEC 17025:2005","ABNT NBR ISO/IEC 17025","INMETRO","ANVISA","MAPA","Rede Brasileira de Laboratórios de Ensaios","CGCRE","Outros"]},u=()=>{const[a,u]=r.useState([]),[g,v]=r.useState(!0),[N,y]=r.useState(""),[f,w]=r.useState(!1),[C,L]=r.useState(null),S=async()=>{try{v(!0);const a=await b.getLaboratories({search:N,limit:100});u(a.data)}catch(a){t.error("Erro ao carregar laboratórios")}finally{v(!1)}};r.useEffect((()=>{S()}),[N]);return g?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"loading-spinner w-8 h-8"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Laboratórios"}),e.jsx("p",{className:"text-gray-600",children:"Gerencie laboratórios certificados"})]}),e.jsxs("button",{onClick:()=>w(!0),className:"btn btn-primary",children:[e.jsx(i,{className:"w-4 h-4 mr-2"}),"Novo Laboratório"]})]}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border",children:e.jsx("div",{className:"flex gap-4",children:e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(o,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Buscar laboratórios...",value:N,onChange:a=>y(a.target.value),className:"input pl-10"})]})})})}),e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:a.map((a=>{var r;return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(l,{className:"w-8 h-8 text-blue-600 mr-3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:a.name}),e.jsx("p",{className:"text-sm text-gray-600",children:a.accreditation})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:a.isActive?e.jsx(s,{className:"w-5 h-5 text-green-500"}):e.jsx(c,{className:"w-5 h-5 text-red-500"})})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(n,{className:"w-4 h-4 mr-2"}),a.email]}),a.phone&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(d,{className:"w-4 h-4 mr-2"}),a.phone]}),a.address&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(m,{className:"w-4 h-4 mr-2"}),a.address]})]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-3 mb-4",children:e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:(null==(r=a._count)?void 0:r.reports)||0})," relatórios enviados"]})}),e.jsx("div",{className:"mb-4",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+(a.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:a.isActive?"Ativo":"Inativo"})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>L(a),className:"flex-1 btn btn-outline text-sm",children:[e.jsx(x,{className:"w-4 h-4 mr-1"}),"Editar"]}),e.jsx("button",{onClick:()=>(async a=>{try{await b.updateLaboratoryStatus(a.id,!a.isActive),t.success(`Laboratório ${a.isActive?"desativado":"ativado"} com sucesso`),S()}catch(e){t.error("Erro ao alterar status do laboratório")}})(a),className:"flex-1 btn text-sm "+(a.isActive?"btn-secondary":"btn-primary"),children:a.isActive?"Desativar":"Ativar"}),e.jsx("button",{onClick:()=>(async a=>{var e,s;if(confirm(`Tem certeza que deseja remover o laboratório "${a.name}"?`))try{await b.deleteLaboratory(a.id),t.success("Laboratório removido com sucesso"),S()}catch(r){t.error((null==(s=null==(e=r.response)?void 0:e.data)?void 0:s.message)||"Erro ao remover laboratório")}})(a),className:"btn btn-outline text-red-600 hover:bg-red-50 text-sm px-3",children:e.jsx(h,{className:"w-4 h-4"})})]})]},a.id)}))}),0===a.length&&!g&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(l,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nenhum laboratório encontrado"}),e.jsx("p",{className:"text-gray-600 mb-4",children:N?"Tente ajustar os filtros de busca":"Comece cadastrando o primeiro laboratório"}),!N&&e.jsxs("button",{onClick:()=>w(!0),className:"btn btn-primary",children:[e.jsx(i,{className:"w-4 h-4 mr-2"}),"Cadastrar Laboratório"]})]}),f&&e.jsx(p,{onClose:()=>w(!1),onSuccess:()=>{w(!1),S()}}),C&&e.jsx(j,{laboratory:C,onClose:()=>L(null),onSuccess:()=>{L(null),S()}})]})},p=({onClose:a,onSuccess:s})=>e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Novo Laboratório"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Modal de criação será implementado na próxima etapa"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:a,className:"btn btn-secondary flex-1",children:"Cancelar"}),e.jsx("button",{onClick:s,className:"btn btn-primary flex-1",children:"Criar (Demo)"})]})]})}),j=({laboratory:a,onClose:s,onSuccess:t})=>e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Editar Laboratório"}),e.jsxs("p",{className:"text-gray-600 mb-2",children:["Editando: ",a.name]}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Modal de edição será implementado na próxima etapa"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:s,className:"btn btn-secondary flex-1",children:"Cancelar"}),e.jsx("button",{onClick:t,className:"btn btn-primary flex-1",children:"Salvar (Demo)"})]})]})});export{u as LaboratoriesPage,u as default};
