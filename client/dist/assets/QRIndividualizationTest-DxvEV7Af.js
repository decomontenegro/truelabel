import{j as e,Q as t,R as a,V as s,M as d,E as n,C as r}from"./index-DeKtUJAc.js";import{r as i}from"./vendor-BDxjXY-2.js";import{p as o}from"./productService-DtNiporo.js";import{S as c}from"./shield-DaRYoi6m.js";import"./charts-C38Ohhsz.js";function l(){const[l,u]=i.useState([{test:"QR Code Uniqueness",status:"pending"},{test:"Permanent QR Code Protection",status:"pending"},{test:"Individual Validation Pages",status:"pending"},{test:"Backend/Frontend Sync",status:"pending"},{test:"Data Field Completeness",status:"pending"},{test:"QR Code Security",status:"pending"}]),[p,m]=i.useState(!1),[g,x]=i.useState([]),h=(e,t,a,s)=>{u((d=>d.map((d=>d.test===e?{...d,status:t,message:a,details:s}:d))))},f=async()=>{h("QR Code Uniqueness","running");try{const e={name:`Test Product ${Date.now()}`,brand:"Test Brand",category:"Test Category",sku:`TEST-SKU-${Date.now()}`,description:"Product for QR uniqueness test"},t={...e,name:`Test Product ${Date.now()+1}`,sku:`TEST-SKU-${Date.now()+1}`},{product:a}=await o.createProduct(e),{product:s}=await o.createProduct(t),n=[a,s];x(n);const r=await d.post("/qr/generate",{productId:a.id}),i=await d.post("/qr/generate",{productId:s.id});return r.data.qrCode===i.data.qrCode?h("QR Code Uniqueness","failed","QR codes não são únicos!",{qr1:r.data.qrCode,qr2:i.data.qrCode}):h("QR Code Uniqueness","passed","QR codes são únicos",{qr1:r.data.qrCode,qr2:i.data.qrCode}),n}catch(e){return h("QR Code Uniqueness","failed",e.message),[]}},y=async e=>{h("Permanent QR Code Protection","running");try{const t=e[0],a=await d.post("/qr/generate",{productId:t.id}),s=await d.post("/qr/generate",{productId:t.id});a.data.qrCode===s.data.qrCode?h("Permanent QR Code Protection","passed","QR code permanece o mesmo após múltiplas tentativas",{qrCode:a.data.qrCode,attempts:2}):h("Permanent QR Code Protection","failed","QR code foi regenerado!",{first:a.data.qrCode,second:s.data.qrCode})}catch(t){h("Permanent QR Code Protection","failed",t.message)}},C=async e=>{h("Individual Validation Pages","running");try{const t=await d.post("/qr/generate",{productId:e[0].id}),a=await d.post("/qr/generate",{productId:e[1].id}),s=await fetch(`${d.defaults.baseURL}/qr/validate/${t.data.qrCode}`),n=await fetch(`${d.defaults.baseURL}/qr/validate/${a.data.qrCode}`),r=await s.json(),i=await n.json();r.product.id!==i.product.id&&r.product.name!==i.product.name?h("Individual Validation Pages","passed","Cada QR code retorna dados únicos do produto",{product1:{id:r.product.id,name:r.product.name},product2:{id:i.product.id,name:i.product.name}}):h("Individual Validation Pages","failed","QR codes retornam o mesmo produto!")}catch(t){h("Individual Validation Pages","failed",t.message)}},j=async e=>{h("Backend/Frontend Sync","running");try{const t=e[0],a=await d.post("/qr/generate",{productId:t.id}),s=await o.getProduct(t.id);s.product.qrCode===a.data.qrCode?h("Backend/Frontend Sync","passed","QR code sincronizado entre backend e frontend",{backendQR:a.data.qrCode,productQR:s.product.qrCode}):h("Backend/Frontend Sync","failed","QR code não está sincronizado!",{backend:a.data.qrCode,product:s.product.qrCode})}catch(t){h("Backend/Frontend Sync","failed",t.message)}},b=async e=>{var t,a,s,n,r;h("Data Field Completeness","running");try{const e=Date.now(),t={name:"Complete Product Test",brand:"Test Brand",category:"Alimentos",sku:`COMPLETE-${e}`,description:"Product with all fields for testing data completeness",claims:"Organic, Non-GMO, Gluten-Free",nutritionalInfo:{servingSize:"100g",calories:250,protein:"10g",carbs:"30g",fat:"12g"},batchNumber:`BATCH-${e}`},{product:a}=await o.createProduct(t),s=await d.post("/qr/generate",{productId:a.id}),n=await fetch(`${d.defaults.baseURL}/qr/validate/${s.data.qrCode}`),r=await n.json(),i=["name","brand","category","sku"],c=["description","claims","nutritionalInfo"],l=i.filter((e=>!r.product[e])),u=c.filter((e=>r.product[e]));0===l.length?h("Data Field Completeness","passed",`Todos os campos obrigatórios presentes. Campos opcionais: ${u.length}/${c.length}`,{requiredFields:i,presentOptional:u,productData:{id:r.product.id,name:r.product.name,brand:r.product.brand,category:r.product.category,sku:r.product.sku,hasDescription:!!r.product.description,hasClaims:!!r.product.claims,hasNutritionalInfo:!!r.product.nutritionalInfo}}):h("Data Field Completeness","failed",`Campos obrigatórios faltando: ${l.join(", ")}`,{missing:l,product:r.product})}catch(i){const e=(null==(a=null==(t=i.response)?void 0:t.data)?void 0:a.error)||i.message,d=(null==(n=null==(s=i.response)?void 0:s.data)?void 0:n.details)||(null==(r=i.response)?void 0:r.data)||{};h("Data Field Completeness","failed",e,d)}},v=async e=>{h("QR Code Security","running");try{const t=e[0],a=(await d.post("/qr/generate",{productId:t.id})).data.qrCode,s=/^[a-f0-9]{16}$/.test(a),n=await o.createProduct({name:"Security Test Product",brand:"Test",category:"Test",sku:`SEC-${Date.now()}`}),r=await d.post("/qr/generate",{productId:n.product.id}),i=a!==r.data.qrCode,c=16===a.length;s&&i&&c?h("QR Code Security","passed","QR codes são seguros e imprevisíveis",{format:"hex 16 caracteres",entropy:"alta",predictable:!1}):h("QR Code Security","failed","Problemas de segurança detectados",{validFormat:s,different:i,length:c})}catch(t){h("QR Code Security","failed",t.message)}},w=t=>{switch(t){case"pending":return e.jsx("div",{className:"w-5 h-5 rounded-full border-2 border-gray-300"});case"running":return e.jsx(a,{className:"w-5 h-5 text-blue-500 animate-spin"});case"passed":return e.jsx(r,{className:"w-5 h-5 text-green-500"});case"failed":return e.jsx(n,{className:"w-5 h-5 text-red-500"})}},q=e=>{switch(e){case"pending":return"bg-gray-50";case"running":return"bg-blue-50";case"passed":return"bg-green-50";case"failed":return"bg-red-50"}};return e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(t,{className:"h-8 w-8 text-primary-600"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"QR Code Individualization Test Suite"})]}),e.jsx("button",{onClick:async()=>{m(!0),u((e=>e.map((e=>({...e,status:"pending",message:void 0,details:void 0})))));try{const e=await f();if(e&&e.length>=2)await y(e),await C(e),await j(e),await b(e),await v(e);else{["Permanent QR Code Protection","Individual Validation Pages","Backend/Frontend Sync","Data Field Completeness","QR Code Security"].forEach((e=>{h(e,"failed","Falha ao criar produtos de teste")}))}}catch(e){s.error("Erro durante os testes")}finally{m(!1)}},disabled:p,className:"btn-primary flex items-center space-x-2",children:p?e.jsxs(e.Fragment,{children:[e.jsx(a,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:"Running Tests..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(c,{className:"w-4 h-4"}),e.jsx("span",{children:"Run All Tests"})]})})]}),e.jsx("p",{className:"text-gray-600",children:"Comprehensive testing of QR code uniqueness, security, and validation system"})]}),e.jsx("div",{className:"space-y-4",children:l.map((t=>e.jsx("div",{className:`p-4 rounded-lg border ${q(t.status)}`,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[w(t.status),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:t.test}),t.message&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:t.message}),t.details&&e.jsx("div",{className:"mt-2 p-2 bg-gray-100 rounded text-xs font-mono",children:e.jsx("pre",{children:JSON.stringify(t.details,null,2)})})]})]})},t.test)))}),!p&&l.some((e=>"pending"!==e.status))&&e.jsxs("div",{className:"mt-8 p-6 bg-white rounded-lg shadow-sm border",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Test Summary"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:l.filter((e=>"passed"===e.status)).length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Passed"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl font-bold text-red-600",children:l.filter((e=>"failed"===e.status)).length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Failed"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl font-bold text-gray-600",children:l.filter((e=>"pending"===e.status)).length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Pending"})]})]})]}),e.jsxs("div",{className:"mt-8 p-6 bg-blue-50 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"Architecture Verification"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("li",{children:"✓ QR codes use SHA256 with random component for unpredictability"}),e.jsx("li",{children:"✓ Backend prevents QR regeneration to protect printed products"}),e.jsx("li",{children:"✓ Each QR code is permanently linked to a specific product instance"}),e.jsx("li",{children:"✓ Validation endpoint tracks access for analytics"}),e.jsx("li",{children:"✓ Frontend syncs with backend to ensure data consistency"})]})]})]})}export{l as default};
