import{d as e,j as t,C as s,R as a,e as i,O as r,L as n}from"./index-DeKtUJAc.js";import{r as l}from"./vendor-BDxjXY-2.js";import{u as d}from"./useAsyncAction-D7sA4Oad.js";import{v as c}from"./validationService-DFgyIoZu.js";import{T as o}from"./triangle-alert-CiFJGrB3.js";import{C as x}from"./circle-x-DPkhpEGr.js";import{t as m}from"./en-US-CLwwsxf7.js";import{f as p}from"./formatDistanceToNow-BYh9opbE.js";import{C as g}from"./calendar-DT4riflN.js";import{T as u}from"./trending-up-B5q99a19.js";import{T as h}from"./trending-down-BKnBlW3G.js";import{D as y}from"./download-B9M2FoM6.js";import{S as j}from"./search-C2yUKuVE.js";import{F as b}from"./funnel-BfqhAz3v.js";import{f}from"./format-BPTC7RkO.js";import"./charts-C38Ohhsz.js";import"./fallbackService-D-6NybDe.js";import"./qrService-BZ_OVWnh.js";import"./endOfDay-BG5xk-_P.js";function v(e){return+m(e)<Date.now()}const N=({expiryDate:s,type:a="validation",showIcon:i=!0,size:r="md"})=>{const n=v(s),l=Math.ceil((s.getTime()-(new Date).getTime())/864e5);let d;d=n?"expired":l<=7?"critical":l<=30?"warning":"info";const c={expired:{bg:"bg-red-100",text:"text-red-800",border:"border-red-200",icon:x},critical:{bg:"bg-red-50",text:"text-red-700",border:"border-red-200",icon:o},warning:{bg:"bg-orange-50",text:"text-orange-700",border:"border-orange-200",icon:o},info:{bg:"bg-blue-50",text:"text-blue-700",border:"border-blue-200",icon:e}}[d],m=c.icon;let g;g=n?`Expired ${p(s,{addSuffix:!0})}`:`Expires in ${p(s)}`;const u=`${{validation:"Validation",certification:"Certificate",qr:"QR Code"}[a]} ${g.toLowerCase()}`;return t.jsxs("div",{className:`\n      inline-flex items-center gap-1.5 \n      ${{sm:"px-2 py-0.5 text-xs",md:"px-3 py-1 text-sm",lg:"px-4 py-2 text-base"}[r]} \n      ${c.bg} ${c.text} \n      border ${c.border} \n      rounded-full font-medium\n    `,children:[i&&t.jsx(m,{className:{sm:"h-3 w-3",md:"h-4 w-4",lg:"h-5 w-5"}[r]}),t.jsx("span",{children:u})]})},w=({metrics:r,previousPeriodMetrics:n})=>{const l=(e,t)=>{if(void 0!==t)return 0===t?e>0?100:0:(e-t)/t*100},d=(e,t)=>null==e?"0":"string"==typeof e?e:"number"!=typeof e||isNaN(e)?"0":"%"===t?`${e}%`:"days"===t?`${e} days`:e.toLocaleString(),c=[{label:"Active Validations",value:r.activeValidations,change:l(r.activeValidations,null==n?void 0:n.activeValidations),trend:n?r.activeValidations>n.activeValidations?"up":"down":"neutral",icon:t.jsx(s,{className:"h-5 w-5 text-green-600"})},{label:"Expiring Soon",value:r.expiringValidations,change:l(r.expiringValidations,null==n?void 0:n.expiringValidations),trend:n?r.expiringValidations>n.expiringValidations?"down":"up":"neutral",icon:t.jsx(e,{className:"h-5 w-5 text-orange-600"})},{label:"Suspended QR Codes",value:r.suspendedQRCodes,change:l(r.suspendedQRCodes,null==n?void 0:n.suspendedQRCodes),trend:n?r.suspendedQRCodes>n.suspendedQRCodes?"down":"up":"neutral",icon:t.jsx(o,{className:"h-5 w-5 text-red-600"})},{label:"Pending Revalidations",value:r.pendingRevalidations,change:l(r.pendingRevalidations,null==n?void 0:n.pendingRevalidations),trend:"neutral",icon:t.jsx(a,{className:"h-5 w-5 text-indigo-600"})}],x=[{label:"Avg. Validity Period",value:d(r.averageValidityPeriod,"days"),icon:t.jsx(g,{className:"h-4 w-4 text-gray-500"})},{label:"Revalidation Success Rate",value:d(r.revalidationSuccessRate,"%"),icon:t.jsx(i,{className:"h-4 w-4 text-gray-500"})},{label:"Avg. Revalidation Time",value:d(r.averageRevalidationTime,"days"),icon:t.jsx(e,{className:"h-4 w-4 text-gray-500"})},{label:"Formula Changes",value:r.formulaChangeCount,icon:t.jsx(o,{className:"h-4 w-4 text-gray-500"})}];return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:c.map(((e,s)=>{return t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.icon,void 0!==e.change&&t.jsxs("div",{className:"flex items-center gap-1",children:[(a=e.trend,a&&"neutral"!==a?"up"===a?t.jsx(u,{className:"h-4 w-4 text-green-600"}):t.jsx(h,{className:"h-4 w-4 text-red-600"}):null),t.jsxs("span",{className:"text-sm font-medium "+("up"===e.trend?"text-green-600":"down"===e.trend?"text-red-600":"text-gray-600"),children:[Math.abs(e.change).toFixed(1),"%"]})]})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:d(e.value??0,e.unit)}),t.jsx("p",{className:"text-sm text-gray-500",children:e.label})]})]},s);var a}))}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Performance Metrics"}),t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:x.map(((e,s)=>t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"flex items-center justify-center mb-2",children:e.icon}),t.jsx("p",{className:"text-xl font-semibold text-gray-900",children:e.value}),t.jsx("p",{className:"text-sm text-gray-500",children:e.label})]},s)))})]}),t.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[t.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Lifecycle Insights"}),t.jsxs("ul",{className:"space-y-2 text-sm text-blue-800",children:[r.expiringValidations>10&&t.jsxs("li",{className:"flex items-start gap-2",children:[t.jsx("span",{className:"text-blue-600 mt-0.5",children:"•"}),t.jsxs("span",{children:[r.expiringValidations," validations expiring in the next 30 days. Consider scheduling revalidations."]})]}),r.revalidationSuccessRate<90&&t.jsxs("li",{className:"flex items-start gap-2",children:[t.jsx("span",{className:"text-blue-600 mt-0.5",children:"•"}),t.jsx("span",{children:"Revalidation success rate is below 90%. Review failed revalidations for common issues."})]}),r.averageRevalidationTime>14&&t.jsxs("li",{className:"flex items-start gap-2",children:[t.jsx("span",{className:"text-blue-600 mt-0.5",children:"•"}),t.jsx("span",{children:"Average revalidation time exceeds 2 weeks. Consider optimizing the revalidation process."})]}),r.formulaChangeCount>5&&t.jsxs("li",{className:"flex items-start gap-2",children:[t.jsx("span",{className:"text-blue-600 mt-0.5",children:"•"}),t.jsx("span",{children:"High number of formula changes detected. Ensure all affected products are revalidated."})]})]})]})]})},C=()=>{const[s,i]=l.useState([]),[x,m]=l.useState([]),[p,g]=l.useState([]),[u,h]=l.useState(null),[C,k]=l.useState(!0),[R,S]=l.useState(new Set),[D,V]=l.useState(30),[M,A]=l.useState(""),[$,q]=l.useState("expiring");l.useEffect((()=>{T()}),[D]);const T=async()=>{try{k(!0);const[e,t,s,a]=await Promise.all([c.getExpiringValidations(D),c.getRevalidationRequests(),c.getFormulaChangeAlerts(),c.getLifecycleMetrics()]);i(e.map((e=>({...e,validatedAt:new Date(e.validatedAt),expiryDate:new Date(e.expiryDate),daysUntilExpiry:Math.ceil((new Date(e.expiryDate).getTime()-(new Date).getTime())/864e5),status:v(new Date(e.expiryDate))?"expired":Math.ceil((new Date(e.expiryDate).getTime()-(new Date).getTime())/864e5)<=7?"expiring_soon":"active"})))),m(t.map((e=>({...e,requestedAt:new Date(e.requestedAt)})))),g(s.map((e=>({...e,changedAt:new Date(e.changedAt)})))),h(a)}catch(e){r.error("Error loading lifecycle data")}finally{k(!1)}},{execute:E,loading:L}=d((async()=>{0!==R.size?(await c.batchRequestRevalidation(Array.from(R)),r.success(`Revalidation requested for ${R.size} products`),S(new Set),T()):r.error("Please select validations to request revalidation")})),{execute:P,loading:U}=d((async()=>{const e=s.map((e=>({Product:e.productName,SKU:e.productSku,Brand:e.brandName,"Validation Type":e.validationType,"Validated Date":f(e.validatedAt,"yyyy-MM-dd"),"Expiry Date":f(e.expiryDate,"yyyy-MM-dd"),"Days Until Expiry":e.daysUntilExpiry,Status:e.status}))),t=[Object.keys(e[0]).join(","),...e.map((e=>Object.values(e).map((e=>`"${e}"`)).join(",")))].join("\n"),a=new Blob([t],{type:"text/csv"}),i=URL.createObjectURL(a),r=document.createElement("a");r.href=i,r.download=`lifecycle-report-${f(new Date,"yyyy-MM-dd")}.csv`,r.click(),URL.revokeObjectURL(i)})),z=()=>{let e=[];switch($){case"expiring":e=s;break;case"requests":e=x;break;case"alerts":e=p}return M&&(e=e.filter((e=>{var t;return e.productName.toLowerCase().includes(M.toLowerCase())||(null==(t=e.productSku)?void 0:t.toLowerCase().includes(M.toLowerCase()))}))),e},Q=e=>{const t={low:"bg-gray-100 text-gray-800",medium:"bg-blue-100 text-blue-800",high:"bg-orange-100 text-orange-800",critical:"bg-red-100 text-red-800"};return t[e]||t.medium},F=e=>{const t={pending:"bg-yellow-100 text-yellow-800",in_progress:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800"};return t[e]||t.pending};return C?t.jsx("div",{className:"flex items-center justify-center min-h-screen",children:t.jsx(n,{size:"lg"})}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Lifecycle Monitoring"}),t.jsx("p",{className:"text-gray-600 mt-1",children:"Monitor and manage validation lifecycles across all products"})]}),t.jsxs("button",{onClick:P,disabled:U,className:"btn btn-outline flex items-center gap-2",children:[t.jsx(y,{className:"h-4 w-4"}),"Export Report"]})]}),u&&t.jsx(w,{metrics:u}),t.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-4",children:t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(j,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),t.jsx("input",{type:"text",value:M,onChange:e=>A(e.target.value),placeholder:"Search products...",className:"pl-10 w-full rounded-lg border-gray-300"})]})}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(b,{className:"h-5 w-5 text-gray-400"}),t.jsxs("select",{value:D,onChange:e=>V(Number(e.target.value)),className:"rounded-lg border-gray-300",children:[t.jsx("option",{value:7,children:"Next 7 days"}),t.jsx("option",{value:14,children:"Next 14 days"}),t.jsx("option",{value:30,children:"Next 30 days"}),t.jsx("option",{value:60,children:"Next 60 days"}),t.jsx("option",{value:90,children:"Next 90 days"})]})]})]})}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border",children:[t.jsxs("div",{className:"flex border-b",children:[t.jsx("button",{onClick:()=>q("expiring"),className:"flex-1 px-4 py-3 text-sm font-medium border-b-2 transition-colors "+("expiring"===$?"text-indigo-600 border-indigo-600":"text-gray-500 border-transparent hover:text-gray-700"),children:t.jsxs("div",{className:"flex items-center justify-center gap-2",children:[t.jsx(e,{className:"h-4 w-4"}),"Expiring Validations (",s.length,")"]})}),t.jsx("button",{onClick:()=>q("requests"),className:"flex-1 px-4 py-3 text-sm font-medium border-b-2 transition-colors "+("requests"===$?"text-indigo-600 border-indigo-600":"text-gray-500 border-transparent hover:text-gray-700"),children:t.jsxs("div",{className:"flex items-center justify-center gap-2",children:[t.jsx(a,{className:"h-4 w-4"}),"Revalidation Requests (",x.filter((e=>"pending"===e.status)).length,")"]})}),t.jsx("button",{onClick:()=>q("alerts"),className:"flex-1 px-4 py-3 text-sm font-medium border-b-2 transition-colors "+("alerts"===$?"text-indigo-600 border-indigo-600":"text-gray-500 border-transparent hover:text-gray-700"),children:t.jsxs("div",{className:"flex items-center justify-center gap-2",children:[t.jsx(o,{className:"h-4 w-4"}),"Formula Change Alerts (",p.length,")"]})})]}),t.jsxs("div",{className:"p-6",children:["expiring"===$&&t.jsxs("div",{className:"space-y-4",children:[R.size>0&&t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("p",{className:"text-sm font-medium text-blue-900",children:[R.size," validation(s) selected"]}),t.jsx("button",{onClick:E,disabled:L,className:"btn btn-primary btn-sm",children:"Request Revalidation"})]})}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-gray-50",children:[t.jsx("th",{className:"px-3 py-3",children:t.jsx("input",{type:"checkbox",onChange:e=>{e.target.checked?S(new Set(z().map((e=>e.id)))):S(new Set)},checked:R.size===z().length&&z().length>0,className:"rounded border-gray-300"})}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Brand"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Validation Type"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Expiry Status"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:z().map((e=>t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-3 py-4",children:t.jsx("input",{type:"checkbox",checked:R.has(e.id),onChange:t=>{const s=new Set(R);t.target.checked?s.add(e.id):s.delete(e.id),S(s)},className:"rounded border-gray-300"})}),t.jsx("td",{className:"px-6 py-4",children:t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-900",children:e.productName}),t.jsxs("p",{className:"text-xs text-gray-500",children:["SKU: ",e.productSku]})]})}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:e.brandName}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:e.validationType}),t.jsx("td",{className:"px-6 py-4",children:t.jsx(N,{expiryDate:e.expiryDate,type:"validation",size:"sm"})}),t.jsx("td",{className:"px-6 py-4",children:t.jsx("button",{onClick:()=>window.location.href=`/dashboard/products/${e.productId}`,className:"text-indigo-600 hover:text-indigo-900 text-sm font-medium",children:"View Details"})})]},e.id)))})]})})]}),"requests"===$&&t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-gray-50",children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Requested By"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Urgency"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:z().map((e=>t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4",children:t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-900",children:e.productName}),e.formulaChanged&&t.jsxs("p",{className:"text-xs text-orange-600 flex items-center gap-1 mt-1",children:[t.jsx(o,{className:"h-3 w-3"}),"Formula changed"]})]})}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:e.requestedBy}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:f(e.requestedAt,"MMM d, yyyy")}),t.jsx("td",{className:"px-6 py-4",children:t.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${Q(e.urgency)}`,children:e.urgency})}),t.jsx("td",{className:"px-6 py-4",children:t.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${F(e.status)}`,children:e.status})}),t.jsx("td",{className:"px-6 py-4",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>window.location.href=`/dashboard/products/${e.productId}`,className:"text-indigo-600 hover:text-indigo-900 text-sm font-medium",children:"View"}),"pending"===e.status&&t.jsx("button",{className:"text-green-600 hover:text-green-900 text-sm font-medium",children:"Process"})]})})]},e.id)))})]})}),"alerts"===$&&t.jsx("div",{className:"space-y-4",children:z().map((e=>t.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx(o,{className:"h-5 w-5 text-orange-600 flex-shrink-0 mt-0.5"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"font-medium text-gray-900",children:e.productName}),t.jsx("p",{className:"text-sm text-gray-600 mt-1",children:e.description}),t.jsxs("div",{className:"flex items-center gap-4 mt-3 text-sm",children:[t.jsxs("span",{className:"text-gray-500",children:["Changed ",f(e.changedAt,"MMM d, yyyy")]}),t.jsxs("span",{className:"text-orange-600 font-medium",children:[e.affectedValidations," validation(s) affected"]})]}),t.jsx("div",{className:"mt-3",children:t.jsx("button",{onClick:()=>window.location.href=`/dashboard/products/${e.productId}`,className:"btn btn-sm btn-outline",children:"Review Product"})})]})]})},e.id)))})]})]})]})};export{C as default};
