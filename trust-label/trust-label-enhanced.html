<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRUST Label - Sistema Avan√ßado de Valida√ß√£o</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-shadow {
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .animate-pulse-slow {
            animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
            100% { transform: translateY(0px); }
        }
        .float-animation {
            animation: float 3s ease-in-out infinite;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <i class="ri-shield-check-fill text-3xl"></i>
                    <h1 class="text-2xl font-bold">TRUST Label</h1>
                </div>
                <nav class="hidden md:flex space-x-6">
                    <a href="#dashboard" class="hover:text-purple-200">Dashboard</a>
                    <a href="#products" class="hover:text-purple-200">Produtos</a>
                    <a href="#validations" class="hover:text-purple-200">Valida√ß√µes</a>
                    <a href="#reports" class="hover:text-purple-200">Relat√≥rios</a>
                    <a href="#ai-insights" class="hover:text-purple-200">IA Insights</a>
                </nav>
                <button class="bg-white text-purple-700 px-4 py-2 rounded-full font-semibold hover:bg-purple-100">
                    <i class="ri-user-line mr-2"></i>Admin
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Dashboard Stats -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white p-6 rounded-xl card-shadow">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">Produtos Validados</p>
                        <p class="text-3xl font-bold text-gray-800">1,234</p>
                        <p class="text-green-500 text-sm">+12% este m√™s</p>
                    </div>
                    <div class="bg-green-100 p-3 rounded-full">
                        <i class="ri-checkbox-circle-fill text-green-500 text-2xl"></i>
                    </div>
                </div>
            </div>
            
            <div class="bg-white p-6 rounded-xl card-shadow">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">QR Codes Escaneados</p>
                        <p class="text-3xl font-bold text-gray-800">45.6K</p>
                        <p class="text-blue-500 text-sm">+23% este m√™s</p>
                    </div>
                    <div class="bg-blue-100 p-3 rounded-full">
                        <i class="ri-qr-code-line text-blue-500 text-2xl"></i>
                    </div>
                </div>
            </div>
            
            <div class="bg-white p-6 rounded-xl card-shadow">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">Laborat√≥rios Ativos</p>
                        <p class="text-3xl font-bold text-gray-800">89</p>
                        <p class="text-purple-500 text-sm">+5 novos</p>
                    </div>
                    <div class="bg-purple-100 p-3 rounded-full">
                        <i class="ri-microscope-line text-purple-500 text-2xl"></i>
                    </div>
                </div>
            </div>
            
            <div class="bg-white p-6 rounded-xl card-shadow">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">Confian√ßa Score</p>
                        <p class="text-3xl font-bold text-gray-800">98.5%</p>
                        <p class="text-orange-500 text-sm">Excelente</p>
                    </div>
                    <div class="bg-orange-100 p-3 rounded-full">
                        <i class="ri-star-fill text-orange-500 text-2xl"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="bg-white rounded-xl card-shadow p-6 mb-8">
            <h2 class="text-xl font-bold mb-4">A√ß√µes R√°pidas</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <button onclick="showNewProduct()" class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-4 rounded-lg hover:shadow-lg transform hover:scale-105 transition">
                    <i class="ri-add-circle-line text-2xl mb-2"></i>
                    <p>Novo Produto</p>
                </button>
                <button onclick="showValidation()" class="bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-lg hover:shadow-lg transform hover:scale-105 transition">
                    <i class="ri-shield-check-line text-2xl mb-2"></i>
                    <p>Nova Valida√ß√£o</p>
                </button>
                <button onclick="generateSmartQR()" class="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-4 rounded-lg hover:shadow-lg transform hover:scale-105 transition">
                    <i class="ri-qr-code-line text-2xl mb-2"></i>
                    <p>Gerar QR Code</p>
                </button>
                <button onclick="showAIInsights()" class="bg-gradient-to-r from-orange-500 to-orange-600 text-white p-4 rounded-lg hover:shadow-lg transform hover:scale-105 transition">
                    <i class="ri-brain-line text-2xl mb-2"></i>
                    <p>IA Insights</p>
                </button>
            </div>
        </div>

        <!-- Products Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="productsGrid">
            <!-- Product cards will be inserted here -->
        </div>
    </main>

    <!-- Modals -->
    <!-- New Product Modal -->
    <div id="newProductModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <h2 class="text-2xl font-bold mb-6">Cadastrar Novo Produto</h2>
            <form id="productForm">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Nome do Produto</label>
                        <input type="text" class="w-full p-3 border rounded-lg" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Marca</label>
                        <input type="text" class="w-full p-3 border rounded-lg" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Categoria</label>
                        <select class="w-full p-3 border rounded-lg">
                            <option>Alimentos</option>
                            <option>Bebidas</option>
                            <option>Cosm√©ticos</option>
                            <option>Suplementos</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Lote</label>
                        <input type="text" class="w-full p-3 border rounded-lg" required>
                    </div>
                </div>
                
                <div class="mt-4">
                    <label class="block text-sm font-medium mb-2">Reivindica√ß√µes (Claims)</label>
                    <div id="claimsContainer">
                        <div class="flex gap-2 mb-2">
                            <input type="text" class="flex-1 p-3 border rounded-lg" placeholder="Ex: 100% Natural">
                            <button type="button" onclick="addClaim()" class="bg-blue-500 text-white px-4 rounded-lg">+</button>
                        </div>
                    </div>
                </div>

                <div class="mt-4">
                    <label class="block text-sm font-medium mb-2">Upload de Imagem</label>
                    <input type="file" accept="image/*" class="w-full p-3 border rounded-lg">
                </div>

                <div class="flex gap-4 mt-6">
                    <button type="submit" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700">
                        Cadastrar Produto
                    </button>
                    <button type="button" onclick="closeModal('newProductModal')" class="bg-gray-300 px-6 py-3 rounded-lg hover:bg-gray-400">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- AI Insights Modal -->
    <div id="aiInsightsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-xl p-8 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <h2 class="text-2xl font-bold mb-6">ü§ñ Insights de IA</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-blue-50 p-6 rounded-lg">
                    <h3 class="font-bold text-lg mb-3">An√°lise de Tend√™ncias</h3>
                    <canvas id="trendsChart"></canvas>
                </div>
                
                <div class="bg-green-50 p-6 rounded-lg">
                    <h3 class="font-bold text-lg mb-3">Previs√£o de Valida√ß√µes</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span>Pr√≥xima Semana:</span>
                            <span class="font-bold">+156 valida√ß√µes</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Pr√≥ximo M√™s:</span>
                            <span class="font-bold">+892 valida√ß√µes</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Taxa de Sucesso Prevista:</span>
                            <span class="font-bold text-green-600">97.3%</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-purple-50 p-6 rounded-lg">
                    <h3 class="font-bold text-lg mb-3">Recomenda√ß√µes</h3>
                    <ul class="space-y-2">
                        <li class="flex items-start">
                            <i class="ri-lightbulb-line text-yellow-500 mr-2"></i>
                            <span>Aumentar valida√ß√µes de produtos org√¢nicos (+34% demanda)</span>
                        </li>
                        <li class="flex items-start">
                            <i class="ri-lightbulb-line text-yellow-500 mr-2"></i>
                            <span>Otimizar processo de cosm√©ticos (tempo m√©dio: 48h)</span>
                        </li>
                        <li class="flex items-start">
                            <i class="ri-lightbulb-line text-yellow-500 mr-2"></i>
                            <span>Expandir laborat√≥rios na regi√£o Sul</span>
                        </li>
                    </ul>
                </div>
                
                <div class="bg-orange-50 p-6 rounded-lg">
                    <h3 class="font-bold text-lg mb-3">Alertas Inteligentes</h3>
                    <div class="space-y-3">
                        <div class="bg-red-100 p-3 rounded">
                            <i class="ri-alert-line text-red-500"></i>
                            <span class="ml-2">3 produtos com valida√ß√£o expirando</span>
                        </div>
                        <div class="bg-yellow-100 p-3 rounded">
                            <i class="ri-time-line text-yellow-600"></i>
                            <span class="ml-2">5 valida√ß√µes pendentes h√° mais de 7 dias</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <button onclick="closeModal('aiInsightsModal')" class="mt-6 bg-gray-300 px-6 py-3 rounded-lg hover:bg-gray-400">
                Fechar
            </button>
        </div>
    </div>

    <!-- QR Code Modal -->
    <div id="qrModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-xl p-8 max-w-lg w-full mx-4">
            <h2 class="text-2xl font-bold mb-6 text-center">QR Code Inteligente Gerado</h2>
            <div class="flex flex-col items-center">
                <div id="qrcode" class="mb-4"></div>
                <div class="bg-gray-100 p-4 rounded-lg w-full">
                    <p class="text-sm text-gray-600 mb-2">Informa√ß√µes do QR Code:</p>
                    <ul class="text-sm space-y-1">
                        <li>‚Ä¢ Rastreamento em tempo real</li>
                        <li>‚Ä¢ An√°lise de localiza√ß√£o</li>
                        <li>‚Ä¢ Hist√≥rico de escaneamentos</li>
                        <li>‚Ä¢ Validade: 2 anos</li>
                    </ul>
                </div>
                <div class="flex gap-4 mt-6">
                    <button class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700">
                        <i class="ri-download-line mr-2"></i>Baixar QR
                    </button>
                    <button onclick="closeModal('qrModal')" class="bg-gray-300 px-6 py-3 rounded-lg hover:bg-gray-400">
                        Fechar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sample data
        let products = [
            {
                id: 1,
                name: '√ìleo de Coco Org√¢nico',
                brand: 'NaturalLife',
                category: 'Alimentos',
                status: 'validated',
                validationDate: '2024-01-15',
                claims: ['100% Org√¢nico', 'Sem Gl√∫ten', 'Prensado a Frio'],
                labReport: 'LAB-2024-001',
                trustScore: 98
            },
            {
                id: 2,
                name: 'Creme Facial Anti-Idade',
                brand: 'BeautyPro',
                category: 'Cosm√©ticos',
                status: 'pending',
                claims: ['Reduz rugas em 30 dias', 'Dermatologicamente testado'],
                trustScore: 0
            },
            {
                id: 3,
                name: 'Whey Protein Premium',
                brand: 'FitSupps',
                category: 'Suplementos',
                status: 'validated',
                validationDate: '2024-01-20',
                claims: ['25g de prote√≠na por dose', 'Zero a√ß√∫car', 'ISO 9001'],
                labReport: 'LAB-2024-045',
                trustScore: 95
            }
        ];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            renderProducts();
        });

        function renderProducts() {
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = products.map(product => `
                <div class="bg-white rounded-xl card-shadow p-6 hover:shadow-xl transition">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="font-bold text-lg">${product.name}</h3>
                            <p class="text-gray-500">${product.brand}</p>
                        </div>
                        <span class="px-3 py-1 rounded-full text-xs font-semibold ${
                            product.status === 'validated' 
                                ? 'bg-green-100 text-green-700' 
                                : 'bg-yellow-100 text-yellow-700'
                        }">
                            ${product.status === 'validated' ? 'Validado' : 'Pendente'}
                        </span>
                    </div>
                    
                    <div class="mb-4">
                        <p class="text-sm text-gray-600 mb-2">Reivindica√ß√µes:</p>
                        <div class="flex flex-wrap gap-2">
                            ${product.claims.map(claim => `
                                <span class="bg-blue-50 text-blue-700 px-2 py-1 rounded text-xs">
                                    ${claim}
                                </span>
                            `).join('')}
                        </div>
                    </div>
                    
                    ${product.trustScore > 0 ? `
                        <div class="mb-4">
                            <div class="flex justify-between text-sm mb-1">
                                <span>Trust Score</span>
                                <span class="font-bold">${product.trustScore}%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-gradient-to-r from-green-400 to-green-600 h-2 rounded-full" 
                                     style="width: ${product.trustScore}%"></div>
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="flex gap-2">
                        <button onclick="viewProduct(${product.id})" 
                                class="flex-1 bg-blue-500 text-white py-2 rounded hover:bg-blue-600">
                            <i class="ri-eye-line mr-1"></i>Ver
                        </button>
                        ${product.status === 'validated' ? `
                            <button onclick="generateSmartQR(${product.id})" 
                                    class="flex-1 bg-purple-500 text-white py-2 rounded hover:bg-purple-600">
                                <i class="ri-qr-code-line mr-1"></i>QR Code
                            </button>
                        ` : `
                            <button onclick="showValidation(${product.id})" 
                                    class="flex-1 bg-green-500 text-white py-2 rounded hover:bg-green-600">
                                <i class="ri-shield-check-line mr-1"></i>Validar
                            </button>
                        `}
                    </div>
                </div>
            `).join('');
        }

        function showNewProduct() {
            document.getElementById('newProductModal').classList.remove('hidden');
        }

        function showValidation(productId) {
            alert('Sistema de valida√ß√£o laboratorial ser√° implementado');
        }

        function showAIInsights() {
            document.getElementById('aiInsightsModal').classList.remove('hidden');
            
            // Create sample chart
            const ctx = document.getElementById('trendsChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'],
                    datasets: [{
                        label: 'Valida√ß√µes',
                        data: [120, 190, 300, 500, 420, 630],
                        borderColor: 'rgb(59, 130, 246)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        async function generateSmartQR(productId) {
            document.getElementById('qrModal').classList.remove('hidden');
            
            // Clear previous QR code
            document.getElementById('qrcode').innerHTML = '';
            
            // Get product data
            const product = products.find(p => p.id === productId) || {
                id: productId || Math.random().toString(36).substr(2, 9),
                name: 'Produto Exemplo',
                brand: 'Marca Exemplo'
            };
            
            try {
                // Call API to generate trackable QR code
                const response = await fetch('http://localhost:5001/api/v1/qr/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        product_id: product.id,
                        product_name: product.name,
                        brand: product.brand,
                        validation_data: {
                            claims: product.claims || [],
                            trust_score: product.trustScore || 95,
                            lab_report: product.labReport || 'LAB-2024-001'
                        }
                    })
                });
                
                const data = await response.json();
                
                // Generate QR code with tracking URL
                const verifyUrl = `http://localhost:8001/verify.html?qr=${data.qr_id}`;
                
                new QRCode(document.getElementById('qrcode'), {
                    text: verifyUrl,
                    width: 256,
                    height: 256,
                    colorDark: '#000000',
                    colorLight: '#ffffff',
                    correctLevel: QRCode.CorrectLevel.H
                });
                
                // Update modal info
                document.querySelector('#qrModal .bg-gray-100').innerHTML = `
                    <p class="text-sm text-gray-600 mb-2">Informa√ß√µes do QR Code:</p>
                    <ul class="text-sm space-y-1">
                        <li>‚Ä¢ ID: ${data.qr_id}</li>
                        <li>‚Ä¢ Rastreamento em tempo real ativado</li>
                        <li>‚Ä¢ URL: ${verifyUrl}</li>
                        <li>‚Ä¢ Blockchain: ${data.qr_data.blockchain.ref}</li>
                    </ul>
                `;
                
            } catch (error) {
                console.error('Error generating QR:', error);
                // Fallback to local generation
                const qrData = {
                    type: 'TRUST_LABEL_PRODUCT',
                    productId: product.id,
                    timestamp: new Date().toISOString(),
                    validationUrl: `http://localhost:8001/verify.html?product=${product.id}`,
                    blockchain: 'ETH_MAINNET',
                    smartContract: '0x742d35Cc6634C0532925a3b844Bc8e70c8B5C4A3'
                };
                
                new QRCode(document.getElementById('qrcode'), {
                    text: JSON.stringify(qrData),
                    width: 256,
                    height: 256,
                    colorDark: '#000000',
                    colorLight: '#ffffff',
                    correctLevel: QRCode.CorrectLevel.H
                });
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        function addClaim() {
            const container = document.getElementById('claimsContainer');
            const newClaim = document.createElement('div');
            newClaim.className = 'flex gap-2 mb-2';
            newClaim.innerHTML = `
                <input type="text" class="flex-1 p-3 border rounded-lg" placeholder="Nova reivindica√ß√£o">
                <button type="button" onclick="this.parentElement.remove()" class="bg-red-500 text-white px-4 rounded-lg">-</button>
            `;
            container.appendChild(newClaim);
        }

        function viewProduct(productId) {
            const product = products.find(p => p.id === productId);
            alert(`Visualizando produto: ${product.name}`);
        }

        // Form submission
        document.getElementById('productForm').addEventListener('submit', function(e) {
            e.preventDefault();
            alert('Produto cadastrado com sucesso!');
            closeModal('newProductModal');
            // Add new product logic here
        });
    </script>
</body>
</html>