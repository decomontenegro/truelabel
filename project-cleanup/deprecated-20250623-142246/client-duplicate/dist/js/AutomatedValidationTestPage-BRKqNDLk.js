import{r as e,j as a,f as i,bq as l,o as s,au as t,n,a3 as r,k as c,N as d}from"./react-core-XCdXHkeW.js";import{r as o,v as m,W as u}from"./validationService-Ds-ci427.js";import{p as h}from"./productService-CHIPryK1.js";import{u as p}from"./useAsyncAction-DPqA4CQG.js";import"./vendor-BcMaAnXF.js";import"./state-QrSTFgAv.js";import"./react-dom-BslC4xag.js";import"./index-D7IercYq.js";import"./react-router-G9IXNjIc.js";import"./utils-BtzqxagS.js";import"./forms-Bk6aQ3xQ.js";import"./fallbackService-QR578FZI.js";import"./qrService-BwD7nkbO.js";function g(){const[g,b]=e.useState(null),[v,N]=e.useState(null),[x,f]=e.useState(null);e.useState([]);const[y,w]=e.useState([]),[j,C]=e.useState([]),[k,A]=e.useState(null),{execute:S}=p((async()=>{const[e,a]=await Promise.all([h.getProducts({limit:20}),o.getReports({limit:20})]);w(e.data),C(a.data)})),{execute:I,loading:E}=p((async e=>{if(!v||!g)throw new Error("Please select a product and report");const a=await m.queueAutomatedValidation(v.id,g.id,e);return M(),a}));p((async e=>{await m.cancelAutomatedValidation(e),M()})),p((async e=>{await m.retryAutomatedValidation(e),M()}));const M=async()=>{const e=await m.getAutomatedQueueStatus();f(e)};e.useEffect((()=>{S(),M();const e=setInterval((()=>{M()}),2e3);return A(e),()=>{e&&clearInterval(e)}}),[]);const R=e=>{switch(e){case u.QUEUED:return a.jsx(s,{className:"w-5 h-5 text-gray-500"});case u.ANALYZING:return a.jsx(d,{className:"w-5 h-5 text-blue-500 animate-pulse"});case u.VALIDATING:return a.jsx(c,{className:"w-5 h-5 text-purple-500 animate-pulse"});case u.REVIEW_REQUIRED:return a.jsx(r,{className:"w-5 h-5 text-yellow-500"});case u.COMPLETED:return a.jsx(n,{className:"w-5 h-5 text-green-500"});case u.FAILED:return a.jsx(t,{className:"w-5 h-5 text-red-500"});default:return a.jsx(s,{className:"w-5 h-5 text-gray-400"})}};return a.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[a.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Automated Validation Engine Test"}),a.jsxs("div",{className:"bg-white rounded-lg shadow-sm border",children:[a.jsx("div",{className:"p-6 border-b",children:a.jsxs("h2",{className:"text-xl font-semibold flex items-center justify-between",children:[a.jsx("span",{children:"Queue Status"}),a.jsxs("button",{onClick:M,className:"text-sm text-blue-600 hover:text-blue-700 flex items-center gap-1",children:[a.jsx(i,{className:"w-4 h-4"}),"Refresh"]})]})}),a.jsx("div",{className:"p-6",children:x&&a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[a.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[a.jsx("div",{className:"text-2xl font-bold",children:x.totalItems}),a.jsx("div",{className:"text-sm text-gray-600",children:"Total Items"})]}),Object.entries(x.byState||{}).map((([e,i])=>a.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[a.jsx("div",{className:"flex justify-center mb-2",children:R(e)}),a.jsx("div",{className:"text-xl font-semibold",children:i}),a.jsx("div",{className:"text-sm text-gray-600",children:e})]},e)))]})})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow-sm border",children:[a.jsx("div",{className:"p-6 border-b",children:a.jsx("h2",{className:"text-xl font-semibold",children:"Queue New Validation"})}),a.jsxs("div",{className:"p-6 space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Select Product"}),a.jsxs("select",{className:"w-full p-2 border rounded-lg",value:(null==g?void 0:g.id)||"",onChange:e=>{const a=y.find((a=>a.id===e.target.value));b(a)},children:[a.jsx("option",{value:"",children:"Choose a product..."}),y.map((e=>a.jsxs("option",{value:e.id,children:[e.name," - ",e.brand," (SKU: ",e.sku,")"]},e.id)))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Select Report"}),a.jsxs("select",{className:"w-full p-2 border rounded-lg",value:(null==v?void 0:v.id)||"",onChange:e=>{const a=j.find((a=>a.id===e.target.value));N(a)},children:[a.jsx("option",{value:"",children:"Choose a report..."}),j.map((e=>{var i;return a.jsxs("option",{value:e.id,children:[e.originalName," - ",e.analysisType," (",null==(i=e.laboratory)?void 0:i.name,")"]},e.id)}))]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("button",{onClick:()=>I("URGENT"),disabled:E||!g||!v,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 flex items-center gap-2",children:[a.jsx(l,{className:"w-4 h-4"}),"Queue as Urgent"]}),a.jsxs("button",{onClick:()=>I("HIGH"),disabled:E||!g||!v,className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 disabled:opacity-50 flex items-center gap-2",children:[a.jsx(l,{className:"w-4 h-4"}),"Queue as High"]}),a.jsxs("button",{onClick:()=>I("NORMAL"),disabled:E||!g||!v,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 flex items-center gap-2",children:[a.jsx(l,{className:"w-4 h-4"}),"Queue as Normal"]}),a.jsxs("button",{onClick:()=>I("LOW"),disabled:E||!g||!v,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 disabled:opacity-50 flex items-center gap-2",children:[a.jsx(l,{className:"w-4 h-4"}),"Queue as Low"]})]})]})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow-sm border",children:[a.jsx("div",{className:"p-6 border-b",children:a.jsx("h2",{className:"text-xl font-semibold",children:"Example Analysis Output"})}),a.jsx("div",{className:"p-6",children:a.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg space-y-3",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-semibold mb-2",children:"Analysis Result Structure:"}),a.jsx("pre",{className:"text-xs bg-white p-3 rounded border overflow-x-auto",children:'{\n  "id": "analysis-1234567890",\n  "timestamp": "2024-01-15T10:30:00Z",\n  "algorithm": "TrueLabel-AutoValidator-v1.0",\n  "version": "1.0.0",\n  "confidence": 92.5,\n  "processingTime": 1250,\n  "findings": [\n    {\n      "category": "COMPLIANCE",\n      "severity": "HIGH",\n      "dataPoint": "sodium",\n      "description": "Value 2500mg/100g exceeds maximum limit",\n      "evidence": {"value": 2500, "unit": "mg/100g"},\n      "suggestedAction": "Review product formulation"\n    },\n    {\n      "category": "CONSISTENCY",\n      "severity": "MEDIUM",\n      "dataPoint": "calories",\n      "description": "Caloric value deviates 12% from expected",\n      "evidence": "Reported: 380 kcal, Expected: 425 kcal",\n      "suggestedAction": "Verify caloric calculation method"\n    }\n  ],\n  "recommendations": [\n    "Address 1 critical compliance issue before approval",\n    "Review 2 moderate issues for potential improvement",\n    "Implement data validation checks"\n  ]\n}'})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-semibold mb-2",children:"Validation Rules Applied:"}),a.jsxs("ul",{className:"text-sm space-y-1",children:[a.jsx("li",{children:"\u2022 Nutritional limits (protein, fat, carbs, sodium, etc.)"}),a.jsx("li",{children:"\u2022 Microbiological safety (coliforms, salmonella, listeria)"}),a.jsx("li",{children:"\u2022 Data consistency checks (macronutrient sum, caloric calculation)"}),a.jsx("li",{children:"\u2022 Anomaly detection (placeholder values, precision errors)"})]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-semibold mb-2",children:"Confidence Score Calculation:"}),a.jsxs("ul",{className:"text-sm space-y-1",children:[a.jsx("li",{children:"\u2022 Base score: 100%"}),a.jsx("li",{children:"\u2022 HIGH severity finding: -20 points each"}),a.jsx("li",{children:"\u2022 MEDIUM severity finding: -10 points each"}),a.jsx("li",{children:"\u2022 LOW severity finding: -5 points each"}),a.jsx("li",{children:"\u2022 Minimum threshold for auto-approval: 85%"})]})]})]})})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow-sm border",children:[a.jsx("div",{className:"p-6 border-b",children:a.jsx("h2",{className:"text-xl font-semibold",children:"Workflow States"})}),a.jsx("div",{className:"p-6",children:a.jsx("div",{className:"space-y-3",children:Object.entries(u).map((([e,i])=>a.jsxs("div",{className:"flex items-center gap-3",children:[R(i),a.jsxs("div",{children:[a.jsx("div",{className:"font-medium",children:i}),a.jsxs("div",{className:"text-sm text-gray-600",children:[i===u.QUEUED&&"Waiting in queue for processing",i===u.ANALYZING&&"Parsing and analyzing report data",i===u.VALIDATING&&"Applying validation rules and scoring",i===u.REVIEW_REQUIRED&&"Manual review needed (confidence < 85%)",i===u.COMPLETED&&"Validation created successfully",i===u.FAILED&&"Processing failed after max attempts"]})]})]},e)))})})]})]})}export{g as default};
