import{r as e,j as a,K as t,aS as s,C as l,a2 as i,i as n,a3 as r,X as c}from"./react-core-XCdXHkeW.js";import{u as o}from"./useAsyncAction-DPqA4CQG.js";import{b as d,h as m}from"./index-D7IercYq.js";const u={validateNutrition:async e=>(await d.post("/nutrition/validate",e)).data,calculateScores:async e=>(await d.post("/nutrition/scores",{nutritionFacts:e})).data,validateHealthClaims:async(e,a,t)=>(await d.post("/nutrition/claims/validate",{claims:e,nutritionFacts:a,targetMarket:t})).data,getCategoryAverages:async e=>(await d.get(`/nutrition/categories/${encodeURIComponent(e)}/averages`)).data,compareProducts:async e=>(await d.post("/nutrition/compare",{productIds:e})).data,generateReport:async(e,a)=>(await d.post(`/products/${e}/nutrition-report`,a)).data,async getReports(e={}){const a=new URLSearchParams;return Object.entries(e).forEach((([e,t])=>{void 0!==t&&""!==t&&a.append(e,String(t))})),(await d.get(`/nutrition/reports?${a.toString()}`)).data},getReport:async e=>(await d.get(`/nutrition/reports/${e}`)).data,checkRegulationCompliance:async(e,a)=>(await d.post("/nutrition/compliance/check",{nutritionFacts:e,regulation:a})).data,async getValidationWarnings(e){try{return(await d.post("/nutrition/warnings",{nutritionFacts:e})).data}catch(a){return[]}},calculateNutrition:async(e,a,t)=>(await d.post("/nutrition/calculate",{nutritionFacts:e,servingSize:a,servingUnit:t})).data,getSuggestedClaims:async(e,a)=>(await d.post("/nutrition/claims/suggestions",{nutritionFacts:e,targetMarket:a})).data,exportNutritionData:async(e,a)=>(await d.get(`/products/${e}/nutrition/export`,{params:{format:a},responseType:"blob"})).data,getRegulationRequirements:async e=>(await d.get(`/nutrition/regulations/${e}/requirements`)).data,batchValidate:async e=>(await d.post("/nutrition/batch-validate",{products:e})).data,async getDailyValueReferences(e){try{return(await d.get(`/nutrition/daily-values/${e}`)).data}catch(a){return{energy:{value:2e3,unit:"kcal"},protein:{value:50,unit:"g"},carbohydrates:{value:300,unit:"g"},fat:{value:65,unit:"g"},saturatedFat:{value:20,unit:"g"},fiber:{value:25,unit:"g"},sodium:{value:2300,unit:"mg"},sugars:{value:50,unit:"g"}}}},validateServingSize:(e,a)=>e>0&&["g","ml","oz","cup","tbsp","tsp","piece","unit"].includes(a),calculateDailyValue:(e,a)=>0===a?0:Math.round(e/a*100),isLowIn:(e,a,t)=>a/t*100<={fat:3,saturatedFat:1.5,sodium:120,sugars:5}[e],isHighIn:(e,a,t)=>t>=20},h=({initialData:n,onChange:r,onValidate:c,targetMarket:d="BRAZIL",showValidation:h=!0})=>{const[g,p]=e.useState({servingSize:100,servingUnit:"g",calories:0,totalFat:0,saturatedFat:0,transFat:0,cholesterol:0,sodium:0,totalCarbohydrates:0,dietaryFiber:0,totalSugars:0,protein:0,vitamins:[],minerals:[],...n}),[N,b]=e.useState([]),[x,v]=e.useState({}),{execute:y}=o((async()=>{const e=await u.getValidationWarnings(g);return b(e),null==c||c(e),e}));e.useEffect((()=>{u.getDailyValueReferences(d).then((e=>{const a={};Object.entries(e).forEach((([e,t])=>{const s=g[e];void 0!==s&&"number"==typeof s&&(a[e]=u.calculateDailyValue(s,t.value))})),v(a)}))}),[g,d]),e.useEffect((()=>{if(h){const e=setTimeout((()=>{y()}),500);return()=>clearTimeout(e)}}),[g,h]);const f=(e,a)=>{const t={...g,[e]:a};p(t),r(t)},w=(e,a,t)=>{const s=[...g.vitamins||[]];s[e]={...s[e],[a]:t},f("vitamins",s)},C=(e,a,t)=>{const s=[...g.minerals||[]];s[e]={...s[e],[a]:t},f("minerals",s)},A=(e,t,s,i=!1,n=0,r=.1)=>{const c=Array.isArray(N)?N.find((e=>e.field===t)):void 0,o=g[t]||0,d=x[t];return a.jsxs("div",{className:"space-y-1",children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[e," ",i&&a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("input",{type:"number",value:o,onChange:e=>f(t,parseFloat(e.target.value)||0),min:n,step:r,className:m("input flex-1",c&&"border-red-500 focus:ring-red-500")}),s&&a.jsx("span",{className:"text-sm text-gray-500 w-12",children:s}),void 0!==d&&a.jsxs("span",{className:"text-sm text-gray-500 w-16",children:[d,"% DV"]})]}),c&&a.jsxs("p",{className:"text-sm text-red-600 flex items-center mt-1",children:[a.jsx(l,{className:"h-3 w-3 mr-1"}),c.message]})]},t)};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"card p-6",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Informa\xe7\xf5es da Por\xe7\xe3o"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Tamanho da Por\xe7\xe3o ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"number",value:g.servingSize||0,onChange:e=>f("servingSize",parseFloat(e.target.value)||0),min:0,step:.1,className:"input"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Unidade ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("select",{value:g.servingUnit||"g",onChange:e=>f("servingUnit",e.target.value),className:"select",children:[a.jsx("option",{value:"g",children:"g (gramas)"}),a.jsx("option",{value:"ml",children:"ml (mililitros)"}),a.jsx("option",{value:"cup",children:"x\xedcara"}),a.jsx("option",{value:"tbsp",children:"colher de sopa"}),a.jsx("option",{value:"tsp",children:"colher de ch\xe1"}),a.jsx("option",{value:"piece",children:"unidade"}),a.jsx("option",{value:"unit",children:"por\xe7\xe3o"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Por\xe7\xf5es por Embalagem"}),a.jsx("input",{type:"number",value:g.servingsPerContainer||"",onChange:e=>f("servingsPerContainer",parseFloat(e.target.value)||void 0),min:0,step:.1,className:"input",placeholder:"Opcional"})]})]})]}),a.jsxs("div",{className:"card p-6",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Valor Energ\xe9tico"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[A("Calorias","calories","kcal",!0),A("Calorias da Gordura","caloriesFromFat","kcal")]})]}),a.jsxs("div",{className:"card p-6",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Macronutrientes"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[A("Gorduras Totais","totalFat","g",!0),A("Gorduras Saturadas","saturatedFat","g",!0),A("Gorduras Trans","transFat","g",!0),A("Gorduras Poli-insaturadas","polyunsaturatedFat","g"),A("Gorduras Monoinsaturadas","monounsaturatedFat","g"),A("Colesterol","cholesterol","mg",!0),A("S\xf3dio","sodium","mg",!0),A("Carboidratos Totais","totalCarbohydrates","g",!0),A("Fibra Alimentar","dietaryFiber","g",!0),A("A\xe7\xfacares Totais","totalSugars","g",!0),A("A\xe7\xfacares Adicionados","addedSugars","g"),A("\xc1lcool de A\xe7\xfacar","sugarAlcohol","g"),A("Prote\xednas","protein","g",!0)]})]}),a.jsxs("div",{className:"card p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold",children:"Vitaminas"}),a.jsxs("button",{type:"button",onClick:()=>{const e=[...g.vitamins||[]];e.push({name:"",amount:0,unit:"mg"}),f("vitamins",e)},className:"btn-outline text-sm flex items-center",children:[a.jsx(t,{className:"h-4 w-4 mr-1"}),"Adicionar Vitamina"]})]}),a.jsx("div",{className:"space-y-3",children:(g.vitamins||[]).map(((e,t)=>a.jsxs("div",{className:"flex items-end space-x-2",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome"}),a.jsx("input",{type:"text",value:e.name,onChange:e=>w(t,"name",e.target.value),className:"input",placeholder:"Ex: Vitamina C"})]}),a.jsxs("div",{className:"w-32",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quantidade"}),a.jsx("input",{type:"number",value:e.amount,onChange:e=>w(t,"amount",parseFloat(e.target.value)||0),min:0,step:.1,className:"input"})]}),a.jsxs("div",{className:"w-24",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Unidade"}),a.jsxs("select",{value:e.unit,onChange:e=>w(t,"unit",e.target.value),className:"select",children:[a.jsx("option",{value:"mg",children:"mg"}),a.jsx("option",{value:"mcg",children:"mcg"}),a.jsx("option",{value:"IU",children:"IU"}),a.jsx("option",{value:"g",children:"g"})]})]}),a.jsxs("div",{className:"w-20",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"% VD"}),a.jsx("input",{type:"number",value:e.dailyValue||"",onChange:e=>w(t,"dailyValue",parseFloat(e.target.value)||void 0),min:0,max:9999,className:"input"})]}),a.jsx("button",{type:"button",onClick:()=>(e=>{const a=(g.vitamins||[]).filter(((a,t)=>t!==e));f("vitamins",a)})(t),className:"btn-ghost text-red-600 p-2",children:a.jsx(s,{className:"h-4 w-4"})})]},t)))})]}),a.jsxs("div",{className:"card p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold",children:"Minerais"}),a.jsxs("button",{type:"button",onClick:()=>{const e=[...g.minerals||[]];e.push({name:"",amount:0,unit:"mg"}),f("minerals",e)},className:"btn-outline text-sm flex items-center",children:[a.jsx(t,{className:"h-4 w-4 mr-1"}),"Adicionar Mineral"]})]}),a.jsx("div",{className:"space-y-3",children:(g.minerals||[]).map(((e,t)=>a.jsxs("div",{className:"flex items-end space-x-2",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome"}),a.jsx("input",{type:"text",value:e.name,onChange:e=>C(t,"name",e.target.value),className:"input",placeholder:"Ex: Ferro"})]}),a.jsxs("div",{className:"w-32",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quantidade"}),a.jsx("input",{type:"number",value:e.amount,onChange:e=>C(t,"amount",parseFloat(e.target.value)||0),min:0,step:.1,className:"input"})]}),a.jsxs("div",{className:"w-24",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Unidade"}),a.jsxs("select",{value:e.unit,onChange:e=>C(t,"unit",e.target.value),className:"select",children:[a.jsx("option",{value:"mg",children:"mg"}),a.jsx("option",{value:"mcg",children:"mcg"}),a.jsx("option",{value:"g",children:"g"})]})]}),a.jsxs("div",{className:"w-20",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"% VD"}),a.jsx("input",{type:"number",value:e.dailyValue||"",onChange:e=>C(t,"dailyValue",parseFloat(e.target.value)||void 0),min:0,max:9999,className:"input"})]}),a.jsx("button",{type:"button",onClick:()=>(e=>{const a=(g.minerals||[]).filter(((a,t)=>t!==e));f("minerals",a)})(t),className:"btn-ghost text-red-600 p-2",children:a.jsx(s,{className:"h-4 w-4"})})]},t)))})]}),h&&N.length>0&&a.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start",children:[a.jsx(l,{className:"h-5 w-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0"}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-medium text-yellow-800 mb-2",children:"Avisos de Valida\xe7\xe3o"}),a.jsx("ul",{className:"text-sm text-yellow-700 space-y-1",children:N.map(((e,t)=>a.jsxs("li",{className:"flex items-start",children:[a.jsx("span",{className:"text-yellow-600 mr-2",children:"\u2022"}),e.message]},t)))})]})]})}),a.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start",children:[a.jsx(i,{className:"h-5 w-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),a.jsxs("div",{className:"text-sm text-blue-700",children:[a.jsx("p",{className:"font-medium mb-1",children:"Dicas para Preenchimento:"}),a.jsxs("ul",{className:"space-y-1 text-xs",children:[a.jsx("li",{children:"\u2022 Todos os valores devem ser baseados no tamanho da por\xe7\xe3o especificada"}),a.jsx("li",{children:"\u2022 Campos marcados com * s\xe3o obrigat\xf3rios para conformidade regulat\xf3ria"}),a.jsxs("li",{children:["\u2022 Os valores di\xe1rios (% VD) s\xe3o calculados automaticamente com base nas refer\xeancias do ",d]}),a.jsx("li",{children:"\u2022 Adicione vitaminas e minerais relevantes para seu produto"})]})]})]})})]})},g=({nutritionFacts:l,initialClaims:d=[],onChange:h,onValidation:g,targetMarket:p="BRAZIL"})=>{const[N,b]=e.useState(d),[x,v]=e.useState(""),[y,f]=e.useState([]),[w,C]=e.useState([]),{execute:A,loading:F}=o((async()=>{const e=await u.validateHealthClaims(N,l,p);return f(e),null==g||g(e),e})),{execute:k}=o((async()=>{const e=await u.getSuggestedClaims(l,p);return C(e),e}));e.useEffect((()=>{N.length>0&&A()}),[N,l,p]),e.useEffect((()=>{k()}),[l,p]);const I=()=>{if(x.trim()&&!N.includes(x.trim())){const e=[...N,x.trim()];b(e),null==h||h(e),v("")}},V=e=>{switch(e){case"VALID":return a.jsx(n,{className:"h-4 w-4 text-green-600"});case"INVALID":return a.jsx(c,{className:"h-4 w-4 text-red-600"});case"WARNING":return a.jsx(r,{className:"h-4 w-4 text-yellow-600"})}},R=e=>{switch(e){case"VALID":return"bg-green-50 border-green-200";case"INVALID":return"bg-red-50 border-red-200";case"WARNING":return"bg-yellow-50 border-yellow-200"}},S=y.filter((e=>"VALID"===e.status)).length,D=y.filter((e=>"INVALID"===e.status)).length,T=y.filter((e=>"WARNING"===e.status)).length;return a.jsxs("div",{className:"space-y-6",children:[N.length>0&&a.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[a.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-green-800",children:"V\xe1lidas"}),a.jsx("p",{className:"text-2xl font-bold text-green-900",children:S})]}),a.jsx(n,{className:"h-8 w-8 text-green-600"})]})}),a.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"Avisos"}),a.jsx("p",{className:"text-2xl font-bold text-yellow-900",children:T})]}),a.jsx(r,{className:"h-8 w-8 text-yellow-600"})]})}),a.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-red-800",children:"Inv\xe1lidas"}),a.jsx("p",{className:"text-2xl font-bold text-red-900",children:D})]}),a.jsx(c,{className:"h-8 w-8 text-red-600"})]})})]}),a.jsxs("div",{className:"card p-6",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Adicionar Alega\xe7\xe3o"}),a.jsxs("div",{className:"flex items-start space-x-2",children:[a.jsx("div",{className:"flex-1",children:a.jsx("input",{type:"text",value:x,onChange:e=>v(e.target.value),onKeyPress:e=>"Enter"===e.key&&I(),placeholder:"Digite uma alega\xe7\xe3o nutricional ou de sa\xfade...",className:"input"})}),a.jsxs("button",{onClick:I,disabled:!x.trim(),className:"btn-primary",children:[a.jsx(t,{className:"h-4 w-4 mr-2"}),"Adicionar"]})]})]}),w.length>0&&a.jsxs("div",{className:"card p-6",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Alega\xe7\xf5es Sugeridas"}),a.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Com base nos dados nutricionais fornecidos, as seguintes alega\xe7\xf5es podem ser v\xe1lidas:"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:w.map(((e,s)=>a.jsxs("button",{onClick:()=>(e=>{if(!N.includes(e)){const a=[...N,e];b(a),null==h||h(a)}})(e),disabled:N.includes(e),className:m("px-3 py-1.5 text-sm rounded-full transition-colors",N.includes(e)?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-100 text-blue-700 hover:bg-blue-200"),children:[e,!N.includes(e)&&a.jsx(t,{className:"h-3 w-3 ml-1 inline"})]},s)))})]}),N.length>0&&a.jsxs("div",{className:"card p-6",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Alega\xe7\xf5es Atuais"}),F?a.jsxs("div",{className:"flex items-center justify-center py-8",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"}),a.jsx("span",{className:"ml-3 text-gray-600",children:"Validando alega\xe7\xf5es..."})]}):a.jsx("div",{className:"space-y-3",children:N.map(((e,t)=>{const l=(e=>y.find((a=>a.claim===e)))(e);return a.jsx("div",{className:m("p-4 border rounded-lg transition-colors",l?R(l.status):"bg-gray-50 border-gray-200"),children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[l&&V(l.status),a.jsx("h4",{className:"font-medium text-gray-900",children:e}),l&&a.jsx("span",{className:"text-xs px-2 py-1 bg-gray-100 text-gray-600 rounded",children:(i=l.type,{NUTRIENT_CONTENT:"Conte\xfado Nutricional",HEALTH:"Sa\xfade",FUNCTION:"Funcional",REDUCTION_RISK:"Redu\xe7\xe3o de Risco"}[i]||i)})]}),l&&a.jsxs(a.Fragment,{children:[l.evidence&&a.jsxs("p",{className:"text-sm text-gray-600 mb-1",children:[a.jsx("strong",{children:"Evid\xeancia:"})," ",l.evidence]}),l.warnings&&l.warnings.length>0&&a.jsxs("div",{className:"mt-2",children:[a.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Avisos:"}),a.jsx("ul",{className:"text-sm text-gray-600 space-y-0.5",children:l.warnings.map(((e,t)=>a.jsxs("li",{className:"flex items-start",children:[a.jsx("span",{className:"text-yellow-600 mr-1",children:"\u2022"}),e]},t)))})]}),l.regulation&&a.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Regulamenta\xe7\xe3o: ",l.regulation]})]})]}),a.jsx("button",{onClick:()=>(e=>{const a=N.filter(((a,t)=>t!==e));b(a),null==h||h(a)})(t),className:"btn-ghost text-red-600 p-2 ml-4",children:a.jsx(s,{className:"h-4 w-4"})})]})},t);var i}))})]}),a.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start",children:[a.jsx(i,{className:"h-5 w-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),a.jsxs("div",{className:"text-sm text-blue-700",children:[a.jsxs("p",{className:"font-medium mb-1",children:["Informa\xe7\xf5es Regulat\xf3rias - ",p]}),a.jsxs("ul",{className:"space-y-1 text-xs",children:[a.jsx("li",{children:"\u2022 Alega\xe7\xf5es nutricionais devem ser baseadas em valores por 100g/ml ou por por\xe7\xe3o"}),a.jsx("li",{children:"\u2022 Alega\xe7\xf5es de sa\xfade requerem evid\xeancia cient\xedfica aprovada"}),a.jsx("li",{children:'\u2022 Termos como "light", "zero", "sem" t\xeam crit\xe9rios espec\xedficos'}),a.jsx("li",{children:"\u2022 Algumas alega\xe7\xf5es podem requerer advert\xeancias adicionais"})]})]})]})})]})};export{g as C,h as N,u as n};
