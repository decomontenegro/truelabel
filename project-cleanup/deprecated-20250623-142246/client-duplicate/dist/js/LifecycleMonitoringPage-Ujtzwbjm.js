import{j as e,o as t,a3 as a,au as r,ae as s,k as i,n as l,f as n,T as d,aZ as c,r as o,ay as m,af as x,an as p,aq as h}from"./react-core-XCdXHkeW.js";import{u as g}from"./useAsyncAction-DPqA4CQG.js";import{v as u}from"./validationService-Ds-ci427.js";import{L as y}from"./index-D7IercYq.js";import{i as b,c as N,f}from"./utils-BtzqxagS.js";import"./vendor-BcMaAnXF.js";import"./state-QrSTFgAv.js";import"./react-dom-BslC4xag.js";import"./fallbackService-QR578FZI.js";import"./qrService-BwD7nkbO.js";import"./react-router-G9IXNjIc.js";import"./forms-Bk6aQ3xQ.js";const v=({expiryDate:s,type:i="validation",showIcon:l=!0,size:n="md"})=>{const d=b(s),c=Math.ceil((s.getTime()-(new Date).getTime())/864e5);let o;o=d?"expired":c<=7?"critical":c<=30?"warning":"info";const m={expired:{bg:"bg-red-100",text:"text-red-800",border:"border-red-200",icon:r},critical:{bg:"bg-red-50",text:"text-red-700",border:"border-red-200",icon:a},warning:{bg:"bg-orange-50",text:"text-orange-700",border:"border-orange-200",icon:a},info:{bg:"bg-blue-50",text:"text-blue-700",border:"border-blue-200",icon:t}}[o],x=m.icon;let p;p=d?`Expired ${N(s,{addSuffix:!0})}`:`Expires in ${N(s)}`;const h=`${{validation:"Validation",certification:"Certificate",qr:"QR Code"}[i]} ${p.toLowerCase()}`;return e.jsxs("div",{className:`\n      inline-flex items-center gap-1.5 \n      ${{sm:"px-2 py-0.5 text-xs",md:"px-3 py-1 text-sm",lg:"px-4 py-2 text-base"}[n]} \n      ${m.bg} ${m.text} \n      border ${m.border} \n      rounded-full font-medium\n    `,children:[l&&e.jsx(x,{className:{sm:"h-3 w-3",md:"h-4 w-4",lg:"h-5 w-5"}[n]}),e.jsx("span",{children:h})]})},w=({metrics:r,previousPeriodMetrics:o})=>{const m=(e,t)=>{if(void 0!==t)return 0===t?e>0?100:0:(e-t)/t*100},x=(e,t)=>null==e?"0":"string"==typeof e?e:"number"!=typeof e||isNaN(e)?"0":"%"===t?`${e}%`:"days"===t?`${e} days`:e.toLocaleString(),p=[{label:"Active Validations",value:r.activeValidations,change:m(r.activeValidations,null==o?void 0:o.activeValidations),trend:o?r.activeValidations>o.activeValidations?"up":"down":"neutral",icon:e.jsx(l,{className:"h-5 w-5 text-green-600"})},{label:"Expiring Soon",value:r.expiringValidations,change:m(r.expiringValidations,null==o?void 0:o.expiringValidations),trend:o?r.expiringValidations>o.expiringValidations?"down":"up":"neutral",icon:e.jsx(t,{className:"h-5 w-5 text-orange-600"})},{label:"Suspended QR Codes",value:r.suspendedQRCodes,change:m(r.suspendedQRCodes,null==o?void 0:o.suspendedQRCodes),trend:o?r.suspendedQRCodes>o.suspendedQRCodes?"down":"up":"neutral",icon:e.jsx(a,{className:"h-5 w-5 text-red-600"})},{label:"Pending Revalidations",value:r.pendingRevalidations,change:m(r.pendingRevalidations,null==o?void 0:o.pendingRevalidations),trend:"neutral",icon:e.jsx(n,{className:"h-5 w-5 text-indigo-600"})}],h=[{label:"Avg. Validity Period",value:x(r.averageValidityPeriod,"days"),icon:e.jsx(s,{className:"h-4 w-4 text-gray-500"})},{label:"Revalidation Success Rate",value:x(r.revalidationSuccessRate,"%"),icon:e.jsx(i,{className:"h-4 w-4 text-gray-500"})},{label:"Avg. Revalidation Time",value:x(r.averageRevalidationTime,"days"),icon:e.jsx(t,{className:"h-4 w-4 text-gray-500"})},{label:"Formula Changes",value:r.formulaChangeCount,icon:e.jsx(a,{className:"h-4 w-4 text-gray-500"})}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:p.map(((t,a)=>{return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.icon,void 0!==t.change&&e.jsxs("div",{className:"flex items-center gap-1",children:[(r=t.trend,r&&"neutral"!==r?"up"===r?e.jsx(d,{className:"h-4 w-4 text-green-600"}):e.jsx(c,{className:"h-4 w-4 text-red-600"}):null),e.jsxs("span",{className:"text-sm font-medium "+("up"===t.trend?"text-green-600":"down"===t.trend?"text-red-600":"text-gray-600"),children:[Math.abs(t.change).toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:x(t.value??0,t.unit)}),e.jsx("p",{className:"text-sm text-gray-500",children:t.label})]})]},a);var r}))}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Performance Metrics"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:h.map(((t,a)=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:t.icon}),e.jsx("p",{className:"text-xl font-semibold text-gray-900",children:t.value}),e.jsx("p",{className:"text-sm text-gray-500",children:t.label})]},a)))})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Lifecycle Insights"}),e.jsxs("ul",{className:"space-y-2 text-sm text-blue-800",children:[r.expiringValidations>10&&e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600 mt-0.5",children:"\u2022"}),e.jsxs("span",{children:[r.expiringValidations," validations expiring in the next 30 days. Consider scheduling revalidations."]})]}),r.revalidationSuccessRate<90&&e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600 mt-0.5",children:"\u2022"}),e.jsx("span",{children:"Revalidation success rate is below 90%. Review failed revalidations for common issues."})]}),r.averageRevalidationTime>14&&e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600 mt-0.5",children:"\u2022"}),e.jsx("span",{children:"Average revalidation time exceeds 2 weeks. Consider optimizing the revalidation process."})]}),r.formulaChangeCount>5&&e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600 mt-0.5",children:"\u2022"}),e.jsx("span",{children:"High number of formula changes detected. Ensure all affected products are revalidated."})]})]})]})]})},k=()=>{const[r,s]=o.useState([]),[i,l]=o.useState([]),[d,c]=o.useState([]),[N,k]=o.useState(null),[j,C]=o.useState(!0),[M,D]=o.useState(new Set),[R,S]=o.useState(30),[$,q]=o.useState(""),[A,E]=o.useState("expiring");o.useEffect((()=>{P()}),[R]);const P=async()=>{try{C(!0);const[e,t,a,r]=await Promise.all([u.getExpiringValidations(R),u.getRevalidationRequests(),u.getFormulaChangeAlerts(),u.getLifecycleMetrics()]);s(e.map((e=>({...e,validatedAt:new Date(e.validatedAt),expiryDate:new Date(e.expiryDate),daysUntilExpiry:Math.ceil((new Date(e.expiryDate).getTime()-(new Date).getTime())/864e5),status:b(new Date(e.expiryDate))?"expired":Math.ceil((new Date(e.expiryDate).getTime()-(new Date).getTime())/864e5)<=7?"expiring_soon":"active"})))),l(t.map((e=>({...e,requestedAt:new Date(e.requestedAt)})))),c(a.map((e=>({...e,changedAt:new Date(e.changedAt)})))),k(r)}catch(e){m.error("Error loading lifecycle data")}finally{C(!1)}},{execute:V,loading:U}=g((async()=>{0!==M.size?(await u.batchRequestRevalidation(Array.from(M)),m.success(`Revalidation requested for ${M.size} products`),D(new Set),P()):m.error("Please select validations to request revalidation")})),{execute:L,loading:z}=g((async()=>{const e=r.map((e=>({Product:e.productName,SKU:e.productSku,Brand:e.brandName,"Validation Type":e.validationType,"Validated Date":f(e.validatedAt,"yyyy-MM-dd"),"Expiry Date":f(e.expiryDate,"yyyy-MM-dd"),"Days Until Expiry":e.daysUntilExpiry,Status:e.status}))),t=[Object.keys(e[0]).join(","),...e.map((e=>Object.values(e).map((e=>`"${e}"`)).join(",")))].join("\n"),a=new Blob([t],{type:"text/csv"}),s=URL.createObjectURL(a),i=document.createElement("a");i.href=s,i.download=`lifecycle-report-${f(new Date,"yyyy-MM-dd")}.csv`,i.click(),URL.revokeObjectURL(s)})),B=()=>{let e=[];switch(A){case"expiring":e=r;break;case"requests":e=i;break;case"alerts":e=d}return $&&(e=e.filter((e=>{var t;return e.productName.toLowerCase().includes($.toLowerCase())||(null==(t=e.productSku)?void 0:t.toLowerCase().includes($.toLowerCase()))}))),e},T=e=>{const t={low:"bg-gray-100 text-gray-800",medium:"bg-blue-100 text-blue-800",high:"bg-orange-100 text-orange-800",critical:"bg-red-100 text-red-800"};return t[e]||t.medium},F=e=>{const t={pending:"bg-yellow-100 text-yellow-800",in_progress:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800"};return t[e]||t.pending};return j?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(y,{size:"lg"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Lifecycle Monitoring"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Monitor and manage validation lifecycles across all products"})]}),e.jsxs("button",{onClick:L,disabled:z,className:"btn btn-outline flex items-center gap-2",children:[e.jsx(x,{className:"h-4 w-4"}),"Export Report"]})]}),N&&e.jsx(w,{metrics:N}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(p,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",value:$,onChange:e=>q(e.target.value),placeholder:"Search products...",className:"pl-10 w-full rounded-lg border-gray-300"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"h-5 w-5 text-gray-400"}),e.jsxs("select",{value:R,onChange:e=>S(Number(e.target.value)),className:"rounded-lg border-gray-300",children:[e.jsx("option",{value:7,children:"Next 7 days"}),e.jsx("option",{value:14,children:"Next 14 days"}),e.jsx("option",{value:30,children:"Next 30 days"}),e.jsx("option",{value:60,children:"Next 60 days"}),e.jsx("option",{value:90,children:"Next 90 days"})]})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border",children:[e.jsxs("div",{className:"flex border-b",children:[e.jsx("button",{onClick:()=>E("expiring"),className:"flex-1 px-4 py-3 text-sm font-medium border-b-2 transition-colors "+("expiring"===A?"text-indigo-600 border-indigo-600":"text-gray-500 border-transparent hover:text-gray-700"),children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(t,{className:"h-4 w-4"}),"Expiring Validations (",r.length,")"]})}),e.jsx("button",{onClick:()=>E("requests"),className:"flex-1 px-4 py-3 text-sm font-medium border-b-2 transition-colors "+("requests"===A?"text-indigo-600 border-indigo-600":"text-gray-500 border-transparent hover:text-gray-700"),children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(n,{className:"h-4 w-4"}),"Revalidation Requests (",i.filter((e=>"pending"===e.status)).length,")"]})}),e.jsx("button",{onClick:()=>E("alerts"),className:"flex-1 px-4 py-3 text-sm font-medium border-b-2 transition-colors "+("alerts"===A?"text-indigo-600 border-indigo-600":"text-gray-500 border-transparent hover:text-gray-700"),children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(a,{className:"h-4 w-4"}),"Formula Change Alerts (",d.length,")"]})})]}),e.jsxs("div",{className:"p-6",children:["expiring"===A&&e.jsxs("div",{className:"space-y-4",children:[M.size>0&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm font-medium text-blue-900",children:[M.size," validation(s) selected"]}),e.jsx("button",{onClick:V,disabled:U,className:"btn btn-primary btn-sm",children:"Request Revalidation"})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"px-3 py-3",children:e.jsx("input",{type:"checkbox",onChange:e=>{e.target.checked?D(new Set(B().map((e=>e.id)))):D(new Set)},checked:M.size===B().length&&B().length>0,className:"rounded border-gray-300"})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Brand"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Validation Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Expiry Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:B().map((t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-3 py-4",children:e.jsx("input",{type:"checkbox",checked:M.has(t.id),onChange:e=>{const a=new Set(M);e.target.checked?a.add(t.id):a.delete(t.id),D(a)},className:"rounded border-gray-300"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.productName}),e.jsxs("p",{className:"text-xs text-gray-500",children:["SKU: ",t.productSku]})]})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:t.brandName}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:t.validationType}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(v,{expiryDate:t.expiryDate,type:"validation",size:"sm"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("button",{onClick:()=>window.location.href=`/dashboard/products/${t.productId}`,className:"text-indigo-600 hover:text-indigo-900 text-sm font-medium",children:"View Details"})})]},t.id)))})]})})]}),"requests"===A&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Requested By"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Urgency"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:B().map((t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.productName}),t.formulaChanged&&e.jsxs("p",{className:"text-xs text-orange-600 flex items-center gap-1 mt-1",children:[e.jsx(a,{className:"h-3 w-3"}),"Formula changed"]})]})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:t.requestedBy}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:f(t.requestedAt,"MMM d, yyyy")}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${T(t.urgency)}`,children:t.urgency})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${F(t.status)}`,children:t.status})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>window.location.href=`/dashboard/products/${t.productId}`,className:"text-indigo-600 hover:text-indigo-900 text-sm font-medium",children:"View"}),"pending"===t.status&&e.jsx("button",{className:"text-green-600 hover:text-green-900 text-sm font-medium",children:"Process"})]})})]},t.id)))})]})}),"alerts"===A&&e.jsx("div",{className:"space-y-4",children:B().map((t=>e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(a,{className:"h-5 w-5 text-orange-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:t.productName}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:t.description}),e.jsxs("div",{className:"flex items-center gap-4 mt-3 text-sm",children:[e.jsxs("span",{className:"text-gray-500",children:["Changed ",f(t.changedAt,"MMM d, yyyy")]}),e.jsxs("span",{className:"text-orange-600 font-medium",children:[t.affectedValidations," validation(s) affected"]})]}),e.jsx("div",{className:"mt-3",children:e.jsx("button",{onClick:()=>window.location.href=`/dashboard/products/${t.productId}`,className:"btn btn-sm btn-outline",children:"Review Product"})})]})]})},t.id)))})]})]})]})};export{k as default};
